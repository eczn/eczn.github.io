<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<title>Pinch 捏放手势 | Eczn's Home</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,minimal-ui">
<meta name="format-detection" content="telephone=no">

<style id="CSS_VARS"></style>
<script>
(function() {
console.log('INIT CSS VAR');
function loadCSSVars() {
    const j = localStorage.getItem("CSS_VARS_2" /* STORAGE_KEY.CSS_VARS */);
    const initialVars = initialCSSVars();
    if (!j)
        return initialVars;
    try {
        const result = {
            ...initialVars,
            ...JSON.parse(j)
        };
        console.log('loadCSSVars from storage', result);
        return result;
    }
    catch (error) {
        console.error('load css vars with error', error);
        return initialVars;
    }
}
function renderCSSVars(vars, style) {
    const allDefine = Object.keys(vars).map(k => {
        const v = vars[k];
        const cssValue = typeof v === 'number' ? `${v}px` : v;
        return `--${k}:${cssValue};`;
    }).join('\n');
    if (style) {
        style.innerHTML = `:root { ${allDefine} }`;
    }
    else {
        console.error(`style#CSS_VARS NotFound !`);
    }
}
function initialCSSVars() {
    let rem = 16;
    // 移动端
    if (typeof window !== 'undefined' && window.innerWidth <= 500) {
        rem = Number(((window.innerWidth - 20) / 42).toFixed(1));
        console.log('mobile calculated rem =>', rem);
    }
    return {
        rem,
        enableSmallerFont: false,
        displayToc: 'block',
        fontSmcp: 'source serif pro, serif',
        fontCode: 'consolas, Menlo, monospace',
        fontTitle: 'Noto Serif SC, serif',
        fontArticle: 'source serif pro, LXGW WenKai',
        fontSansSerif: 'sans-serif',
    };
}
window.__initialCSSVars = loadCSSVars();
renderCSSVars(__initialCSSVars, document.querySelector('#CSS_VARS'));
})();
</script>

<link rel="icon" href="/favicon.png"><script defer="defer" src="/js/index.9d1819bc.js"></script><script defer="defer" src="/js/chunk-lib.cbf60312.js"></script><link href="/css/index.80eac14b882774b3688a.css" rel="stylesheet"><link href="/css/chunk-lib.5c7d4887bb8714b00c54.css" rel="stylesheet"></head>
<body x-apple-data-detectors="none">
<noscript>当前浏览器不支持 JavaScript, 建议使用支持 JavaScript 的浏览器来访问此网站 !</noscript>
<div id="rally-bg" style="opacity:0"></div>
<div id="app"><div class="ball-canvas-container"></div><nav class="nav-main --fontSmcp"><div class="_title default-max-width">Eczn&#x27;s Home</div><div class="smcphr"></div><div class="_links default-max-width"><a class="r-link _link clickable r-link" href="/">Home</a><a class="r-link _link clickable r-link" href="/tl/0/">Timeline</a><a class="r-link _link clickable r-link" href="/cate/all/">Category</a><a class="r-link _link clickable r-link" href="/setting/">Setting</a><a class="r-link _link clickable r-link" href="/launchpad/">Launchpad</a></div></nav><div class="std-box rally-page-content default-max-width"><div id="blog-box" class="std-box-content "><div id="start" class="blog-header-main"><div class="_infos"><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg>2024-01-01</div></div><div class="_title --fontTitle">Pinch 捏放手势</div></div><article class="r-article-wrapper"><div class="toc-wrapper"></div><div class="r-article"><style>.rapp-pinch {
  position: relative;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  border: 1px solid #BBB;
  overflow: hidden;
}

.rapp-pinch-file-label {
  position: absolute;
  bottom: 2em;
  width: 80%;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  background-color: #1f61a9;
  border-radius: 4px;
  padding: 0.75em 0;
  color: #FFF;
  max-width: 300px;
}

.rapp-pinch-file-label:active {
  background-color: #0b3969;
}

.rapp-pinch-preview {
  width: 100%;
  height: 100%;
  overflow: hidden;
  cursor: grab;
}
.rapp-pinch-preview ._canvas {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 100%;
  background-repeat: no-repeat;
  background-size: contain;
  background-position: 0% 0%;
  border: 1px solid #555;
  box-sizing: border-box;
}
.rapp-pinch-preview:active {
  cursor: grabbing;
}

.rapp-pinch-preview-bg {
  width: 100%;
  height: 100%;
  position: absolute;
  left: 0;
  top: 0;
}

</style><div class="std-window mode-windowed"><div class="std-window-menus"><div class="std-window-title"><span class="std-window-icon" style="background-image:url(/tsxs-esm/pinch.daef4e8852186e91.svg)"></span><span>Pinch</span></div><div class="std-window-btns"><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div></div></div><div class="std-window-content"><div class="rapp-pinch"><input type="file" id="rapp-pinch-file" hidden=""/><div class="rapp-pinch-preview"><div class="rapp-pinch-preview-bg" id="grid" style="background-size:40px 40px;background-position:0% 0%;background-image:radial-gradient(circle, #000000 1px, rgba(0, 0, 0, 0) 1px)"></div><div class="_canvas_descriptor"><div>缩放: 100.0%</div><div>(0.0,0.0)</div></div><div class="_canvas" style="transform:matrix(1, 0, 0, 1, 0, 0);transform-origin:0% 0%;background-position:center center"><div style="font-size:2rem;text-align:center;max-width:300px;padding:3em 0;margin:0 auto;user-select:none"><div style="margin-bottom:1em">点击下方选择图片进行预览, 要不然就只能预览我这段文字了<br/></div><div style="font-size:50%;color:#BBB"><div>对齐 iOS 相册缩放体验</div><div>鼠标拖拽 / 鼠标滚轮</div><div>单指拖拽 / 多指捏放</div></div></div></div></div><label for="rapp-pinch-file" class="rapp-pinch-file-label">选择本地图片</label></div></div></div><div style="display:none;height:0px;background:#BBB">placeholder</div><h1 id="introduction" class="std-title --fontTitle"><a href="#introduction" class="markdownIt-Anchor">#</a> 说明<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">我这个实现逼近 iOS 相册的那种极致缩放体验，支持双指缩放，而且双指过程中可以抬起一根手指然后再放上去，怎么搞都不会挂的那种</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">具体实现打开 devtools 看吧，主要步骤是：</div><ol class="numbering-main" data-minimap-color="#DDDDDD"><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">1.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">多触点管理, 核心是 <div class="std-inline-code" data-minimap-color="#f5e9e9">e.changedTouches</div> 和 <div class="std-inline-code" data-minimap-color="#f5e9e9">e.touches</div> 以及 <div class="std-inline-code" data-minimap-color="#f5e9e9">Touch.identifier</div></div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">2.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">手势状态的向量化</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">3.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">在移动端 touch 事件组的基础上兼容支持 pc 的鼠标和滚轮</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">4.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">将向量化的手势状态转成变换矩阵，应用到 css matrix 上</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">5.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">将用户选择的本地图片读取成 blob url 并用 backage-image 显示它</div></li></ol></div></article></div></div><div class="smcphr rally-page-smcphr"></div><div class="std-box rally-giscus-wrapper default-max-width"><div class="std-box-content "></div></div></div>
<script>window.__INITIAL_STATE__ = {"CategoryApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"BlogApiState":{"loaded":true,"loading":false,"error":null,"dataMap":{"app-pinch":{"type":"tsx","meta":{"type":"app","id":"app-pinch","title":"Pinch 捏放手势","appTitle":"Pinch 捏放手势","appIcon":"/tsxs-esm/pinch.daef4e8852186e91.svg","author":"eczn","time":"2024-01-01T15:33:00.000Z","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},"tsxDistPath":"./app-pinch/index.blog.js","ssrContent":"<style>.rapp-pinch {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  border: 1px solid #BBB;\n  overflow: hidden;\n}\n\n.rapp-pinch-file-label {\n  position: absolute;\n  bottom: 2em;\n  width: 80%;\n  left: 50%;\n  transform: translateX(-50%);\n  text-align: center;\n  background-color: #1f61a9;\n  border-radius: 4px;\n  padding: 0.75em 0;\n  color: #FFF;\n  max-width: 300px;\n}\n\n.rapp-pinch-file-label:active {\n  background-color: #0b3969;\n}\n\n.rapp-pinch-preview {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  cursor: grab;\n}\n.rapp-pinch-preview ._canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n  height: 100%;\n  width: 100%;\n  background-repeat: no-repeat;\n  background-size: contain;\n  background-position: 0% 0%;\n  border: 1px solid #555;\n  box-sizing: border-box;\n}\n.rapp-pinch-preview:active {\n  cursor: grabbing;\n}\n\n.rapp-pinch-preview-bg {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n</style><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"><span class=\"std-window-icon\" style=\"background-image:url(/tsxs-esm/pinch.daef4e8852186e91.svg)\"></span><span>Pinch</span></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div class=\"std-window-content\"><div class=\"rapp-pinch\"><input type=\"file\" id=\"rapp-pinch-file\" hidden=\"\"/><div class=\"rapp-pinch-preview\"><div class=\"rapp-pinch-preview-bg\" id=\"grid\" style=\"background-size:40px 40px;background-position:0% 0%;background-image:radial-gradient(circle, #000000 1px, rgba(0, 0, 0, 0) 1px)\"></div><div class=\"_canvas_descriptor\"><div>缩放: 100.0%</div><div>(0.0,0.0)</div></div><div class=\"_canvas\" style=\"transform:matrix(1, 0, 0, 1, 0, 0);transform-origin:0% 0%;background-position:center center\"><div style=\"font-size:2rem;text-align:center;max-width:300px;padding:3em 0;margin:0 auto;user-select:none\"><div style=\"margin-bottom:1em\">点击下方选择图片进行预览, 要不然就只能预览我这段文字了<br/></div><div style=\"font-size:50%;color:#BBB\"><div>对齐 iOS 相册缩放体验</div><div>鼠标拖拽 / 鼠标滚轮</div><div>单指拖拽 / 多指捏放</div></div></div></div></div><label for=\"rapp-pinch-file\" class=\"rapp-pinch-file-label\">选择本地图片</label></div></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div><h1 id=\"introduction\" class=\"std-title --fontTitle\"><a href=\"#introduction\" class=\"markdownIt-Anchor\">#</a> 说明<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">我这个实现逼近 iOS 相册的那种极致缩放体验，支持双指缩放，而且双指过程中可以抬起一根手指然后再放上去，怎么搞都不会挂的那种</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">具体实现打开 devtools 看吧，主要步骤是：</div><ol class=\"numbering-main\" data-minimap-color=\"#DDDDDD\"><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">1.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">多触点管理, 核心是 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">e.changedTouches</div> 和 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">e.touches</div> 以及 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">Touch.identifier</div></div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">2.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">手势状态的向量化</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">3.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">在移动端 touch 事件组的基础上兼容支持 pc 的鼠标和滚轮</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">4.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">将向量化的手势状态转成变换矩阵，应用到 css matrix 上</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">5.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">将用户选择的本地图片读取成 blob url 并用 backage-image 显示它</div></li></ol>","props":{},"tocStack":[{"id":"introduction","level":1,"text":"说明"}]}}},"HomeApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"TimeLineApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"SettingApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"LaunchpadApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}}}</script>
<!--SCRIPT-->
</body>
</html>
