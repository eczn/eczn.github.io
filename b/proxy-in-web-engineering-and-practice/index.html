<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<title>Web 工程中的代理以及实际应用 | Eczn's Home</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,minimal-ui">
<meta name="format-detection" content="telephone=no">

<style id="CSS_VARS"></style>
<script>
(function() {
console.log('INIT CSS VAR');
function loadCSSVars() {
    const j = localStorage.getItem("CSS_VARS_2" /* STORAGE_KEY.CSS_VARS */);
    const initialVars = initialCSSVars();
    if (!j)
        return initialVars;
    try {
        const result = {
            ...initialVars,
            ...JSON.parse(j)
        };
        console.log('loadCSSVars from storage', result);
        return result;
    }
    catch (error) {
        console.error('load css vars with error', error);
        return initialVars;
    }
}
function renderCSSVars(vars, style) {
    const allDefine = Object.keys(vars).map(k => {
        const v = vars[k];
        const cssValue = typeof v === 'number' ? `${v}px` : v;
        return `--${k}:${cssValue};`;
    }).join('\n');
    if (style) {
        style.innerHTML = `:root { ${allDefine} }`;
    }
    else {
        console.error(`style#CSS_VARS NotFound !`);
    }
}
function initialCSSVars() {
    let rem = 16;
    // 移动端
    if (typeof window !== 'undefined' && window.innerWidth <= 500) {
        rem = Number(((window.innerWidth - 20) / 42).toFixed(1));
        console.log('mobile calculated rem =>', rem);
    }
    return {
        rem,
        enableSmallerFont: false,
        displayToc: 'block',
        fontSmcp: 'source serif pro, serif',
        fontCode: 'consolas, Menlo, monospace',
        fontTitle: 'Noto Serif SC, serif',
        fontArticle: 'source serif pro, LXGW WenKai',
        fontSansSerif: 'sans-serif',
    };
}
window.__initialCSSVars = loadCSSVars();
renderCSSVars(__initialCSSVars, document.querySelector('#CSS_VARS'));
})();
</script>

<link rel="icon" href="/favicon.png"><script defer="defer" src="/js/index.adf98f3e.js"></script><script defer="defer" src="/js/chunk-lib.cbf60312.js"></script><link href="/css/index.791c12afdb2cecbd8bba.css" rel="stylesheet"><link href="/css/chunk-lib.5c7d4887bb8714b00c54.css" rel="stylesheet"></head>
<body x-apple-data-detectors="none">
<noscript>当前浏览器不支持 JavaScript, 建议使用支持 JavaScript 的浏览器来访问此网站 !</noscript>
<div id="rally-bg" style="opacity:0"></div>
<div id="app"><div class="ball-canvas-container"></div><nav class="nav-main --fontSmcp"><div class="_title default-max-width">Eczn&#x27;s Home</div><div class="smcphr"></div><div class="_links default-max-width"><a class="r-link _link clickable r-link" href="/">Home</a><a class="r-link _link clickable r-link" href="/tl/0/">Timeline</a><a class="r-link _link clickable r-link" href="/cate/all/">Category</a><a class="r-link _link clickable r-link" href="/setting/">Setting</a><a class="r-link _link clickable r-link" href="/launchpad/">Launchpad</a></div></nav><div class="std-box rally-page-content default-max-width"><div id="blog-box" class="std-box-content "><div id="start" class="blog-header-main"><div class="_infos"><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg>2017-12-06</div><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tag" class="svg-inline--fa fa-tag fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg>Proxy</div></div><div class="_title --fontTitle">Web 工程中的代理以及实际应用</div></div><article class="r-article-wrapper"><div class="toc-wrapper"></div><div class="r-article"><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">出于这样或者那样的原因，Web 开发中总是需要代理，即客户端的请求不直接到服务器而是要经过某种途径访问，比如VPN那样的代理。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">对于 Web 开发中的代理主要有两种：一种是正向的，另外一种是反向的。</div>
<h1 id="正向代理" class="std-title --fontTitle"><a target="_blank" href="#正向代理" class="markdownIt-Anchor">#</a> 正向代理<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这个最为直观，比如翻墙就是一种正向代理：境内的电脑需要用 SS 这种代理来访问不存在的网站，即正向代理夹在服务端和客户端之间，客户端访问代理，让代理服务器去请求服务端。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">正向代理源于客户端的网络需求，会隐藏真实的客户端。</div>
<h1 id="反向代理" class="std-title --fontTitle"><a target="_blank" href="#反向代理" class="markdownIt-Anchor">#</a> 反向代理<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">虽说反向代理做的事情跟正向的很像，但还是有所不同的，比如负载均衡就用到了反向代理：单台服务器撑不住，所以搞了很多个服务器，然后让其中一台作为对外显示的服务器，这个服务器吧全部客户端的请求分发给不同内网的服务器来达到负载均衡的目的，对于客户端来说它访问 test.cc 跟原来没有什么不同，而实际上处理客户端请求的服务器在不同时间点上很可能是不同的。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">反向代理源于服务端的网络需求，会隐藏真实的服务端。</div>
<h1 id="区别" class="std-title --fontTitle"><a target="_blank" href="#区别" class="markdownIt-Anchor">#</a> 区别<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">主要还是两句话：</div>
<blockquote lang="en" class="std-quote"><span class="std-quote-text">
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">正向代理源于客户端的网络需求，会隐藏真实的客户端。<br/>
反向代理源于服务端的网络需求，会隐藏真实的服务端。</div>
</span></blockquote>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">再来一张图</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC"><div class="std-img"><img class="std-img-bg r-link" data-minimap="Rect" src="/images/diff-proxy.png" alt="代理靠左点就是正向的，靠右点就是反向的"/><div class="std-img-text">代理靠左点就是正向的，靠右点就是反向的</div></div></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">其实无须过度区分这些，不论正反，请求都会经过中间的代理层，只要配通了、达到目的了就好。</div>
<h1 id="工程应用" class="std-title --fontTitle"><a target="_blank" href="#工程应用" class="markdownIt-Anchor">#</a> 工程应用<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">实际项目中反向代理用得最多，因为反向代理针对的是服务端的真实需求，我在实际使用的时候是利用 Nginx 来完成反向代理的，以下是一些用到代理的例子。</div>
<h2 id="vhost-虚拟站点" class="std-title --fontTitle"><a target="_blank" href="#vhost-虚拟站点" class="markdownIt-Anchor">#</a> vhost 虚拟站点</h2>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">一个服务器有时候需要挂不止一个站点，也就是说有多个域名指向了这个站点，这时候需要用到 Nginx 的虚拟站点配置，别紧张这也是一种反向代理过程，因为这是服务端的需求，而且隐藏了服务器 （多个域名看起来好像不同的服务器提供的网站、而实际上却是同一个服务器提供的）</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">具体的而言，需要编写类似如下配置到你的 nginx 配置中：</div>
<div class="std-code"><pre class="prismjs nginx rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token directive"><span class="token keyword">server_name</span> test.cc</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">02</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token directive"><span class="token keyword">root</span> /xxx/xxx/xx</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">04</span>    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">05</span><span class="token punctuation">}</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">我配置服务器的时候，通常使用 Nginx 作为网关层，让 Nginx 建立不同 VHOST，然后具体的对应 VHOST 上不同路径代理到不同端口上。</div>
<h2 id="跨域的问题" class="std-title --fontTitle"><a target="_blank" href="#跨域的问题" class="markdownIt-Anchor">#</a> 跨域的问题</h2>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">如果静态文件在 test.cc 上，而接口在 test.cc:3000 上，需要通过反向代理的方式来规避跨域，其实只是：</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">将 test.cc/api/<div class="std-inline-em"> 代理到 test.cc:3000/api/</div></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这里需要修改 VHOST 的配置：</div>
<div class="std-code"><pre class="prismjs nginx rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token directive"><span class="token keyword">server_name</span> test.cc</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">02</span>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token directive"><span class="token keyword">root</span> /xxx/xxx/xx</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">04</span>    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">05</span>
<span style="user-select:none" class="line-numbers-rows">06</span>    <span class="token directive"><span class="token keyword">location</span> /api</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">07</span>        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">08</span>        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">09</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">10</span>        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">11</span>        <span class="token directive"><span class="token keyword">proxy_cache_bypass</span> <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">12</span>    <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">13</span><span class="token punctuation">}</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">重启后，访问 test.cc/api 的时候，会返回访问 test.cc:3000/api 的结果，对于前端来说，访问的还是 test.cc/api 但实际上，服务器上的 Nginx 接到请求后将其代理到 3000 端口上了，对于客户端来说，隐藏了真实的服务器（端口）。</div>
<h2 id="https" class="std-title --fontTitle"><a target="_blank" href="#https" class="markdownIt-Anchor">#</a> HTTPS</h2>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">续接上面，3000 端口无须设置 SSL 只需要 test.cc 是 https 的，那么访问 https://test.cc/api/* 的时候依然是 HTTPS 的，即使实际在服务器内部是一次简单的端口转发。</div>
<h2 id="负载均衡" class="std-title --fontTitle"><a target="_blank" href="#负载均衡" class="markdownIt-Anchor">#</a> 负载均衡</h2>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">虽然没有在项目中应用过负载均衡，但是对它的原理比较清楚：</div>
<ol class="std-list">
<li>对于一个服务器</li>
<li>上面起了很多个 Node 实例在不同端口 3000 3001 3002 3003 等</li>
<li>客户端访问它的 80 端口</li>
<li>将 80 端口接到的请求转发到 3000 3001 3002 3003 等端口上完成负载均衡</li>
</ol>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">上述过程就是一次简单的负载均衡 （针对一台服务器、提高多核处理器利用率），不过看过很多文章，一般的负载均衡是用在集群里的，整个集群有一个网关，这个网关就是负载均衡器，用来分发请求。 （详见腾讯云提供的负载均衡服务）</div>
<h2 id="dns-和-cdn" class="std-title --fontTitle"><a target="_blank" href="#dns-和-cdn" class="markdownIt-Anchor">#</a> DNS 和 CDN</h2>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">CDN 中文名是内容分发网络，它可以极大的提高静态资源的分发速度，基本上我还没见过大型网站不用这个的 。。。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">基于如下的考虑：</div>
<ol class="std-list">
<li>服务器离客户端的地理距离越近，加载速度越快</li>
<li>可以在不同地理位置建立静态资源服务器，在广州建一个、深圳建一个、华北建一个等等</li>
<li>不同地理位置的客户端的 DNS 通常是当地的 DNS</li>
<li>联系当地的 DNS 让它们吧 img.test.cc 解析到当地的静态资源站</li>
</ol>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">可以看到深圳地区访问 img.test.cc DNS 解析到位于深圳的静态资源服务器，广州地区访问 img.test.cc DNS 解析到位于广州的静态资源服务器这样。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这是一个典型的反向代理：用户访问 img.test.cc 但是不必知道到底是访问了深圳的那个还是广州的那个，也就是说 DNS 隐藏了真实的服务器，DNS 充当了负载均衡器。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">DNS 在 CDN 中是主角，一旦 DNS 有问题，CDN 的速度可能会比原来直接访问还要慢。</div>
<hr class="std-hr"/>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">CDN 还涉及到很多分布式问题，比如不同地域的静态服务器的增量同步问题，如何通知 DNS 解析中心刷新dns记录等等。。</div>
<h2 id="http-接口代理" class="std-title --fontTitle"><a target="_blank" href="#http-接口代理" class="markdownIt-Anchor">#</a> HTTP 接口代理</h2>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">反向代理除了可以代理到本地的某个端口，甚至可以代理到其他的服务器上。利用这个可以完成如下的需求：</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">访问 http://test.cc/baidu-api/<div class="std-inline-em"> 代理到 http://api.baidu.com/</div> 去，进而解决前端直接访问 api.baidu.com 出现跨域的问题。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">可以用 nginx 做也可以用 express 的 http-proxy-middleware 来做：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;express&#x27;</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token punctuation">,</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;http-proxy-middleware&#x27;</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">02</span>    <span class="token punctuation">,</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">03</span>
<span style="user-select:none" class="line-numbers-rows">04</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#x27;/baidu-api&#x27;</span><span class="token punctuation">,</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">05</span>    <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#x27;http://api.baidu.com&#x27;</span><span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">06</span>    <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">07</span>    <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">08</span>        <span class="token string-property property">&#x27;^/baidu-api&#x27;</span><span class="token operator">:</span> <span class="token string">&#x27;&#x27;</span>
<span style="user-select:none" class="line-numbers-rows">09</span>    <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这样会隐藏真实的 baidu 服务器，属于反向代理，不是正向代理。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">但是，对于 baidu 服务器来说，客户端被node中间价真实地隐藏了，并不是反向代理。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这种情况下其实都对：反向代理客户端的请求，将其正向代理到另外一个服务器上。</div>
</div></article></div></div><div class="smcphr rally-page-smcphr"></div><div class="std-box rally-giscus-wrapper default-max-width"><div class="std-box-content "></div></div></div>
<script>window.__INITIAL_STATE__ = {"CategoryApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"BlogApiState":{"loaded":true,"loading":false,"error":null,"dataMap":{"proxy-in-web-engineering-and-practice":{"type":"markdown","meta":{"id":"proxy-in-web-engineering-and-practice","title":"Web 工程中的代理以及实际应用","intro":"web 开发中遇到的各种代理","date":"Wed Dec 06 2017 10:00:52 GMT+0800 (CST)","category":"code","tags":["Proxy"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"type":"article","appTitle":"","appIcon":"","cateIntro":"该分类暂无介绍 ~","author":"eczn","imgs":[],"time":"2017-12-06T02:00:52.000Z","isDraft":false,"fileDeps":["/images/diff-proxy.png"],"wordCount":3545},"nodes":[{"type":"tag","children":[{"type":"text","data":"出于这样或者那样的原因，Web 开发中总是需要代理，即客户端的请求不直接到服务器而是要经过某种途径访问，比如VPN那样的代理。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"对于 Web 开发中的代理主要有两种：一种是正向的，另外一种是反向的。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#正向代理","className":"markdownIt-Anchor"}},{"type":"text","data":" 正向代理"}],"name":"h1","attribs":{"id":"正向代理"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这个最为直观，比如翻墙就是一种正向代理：境内的电脑需要用 SS 这种代理来访问不存在的网站，即正向代理夹在服务端和客户端之间，客户端访问代理，让代理服务器去请求服务端。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"正向代理源于客户端的网络需求，会隐藏真实的客户端。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#反向代理","className":"markdownIt-Anchor"}},{"type":"text","data":" 反向代理"}],"name":"h1","attribs":{"id":"反向代理"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"虽说反向代理做的事情跟正向的很像，但还是有所不同的，比如负载均衡就用到了反向代理：单台服务器撑不住，所以搞了很多个服务器，然后让其中一台作为对外显示的服务器，这个服务器吧全部客户端的请求分发给不同内网的服务器来达到负载均衡的目的，对于客户端来说它访问 test.cc 跟原来没有什么不同，而实际上处理客户端请求的服务器在不同时间点上很可能是不同的。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"反向代理源于服务端的网络需求，会隐藏真实的服务端。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#区别","className":"markdownIt-Anchor"}},{"type":"text","data":" 区别"}],"name":"h1","attribs":{"id":"区别"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"主要还是两句话："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"正向代理源于客户端的网络需求，会隐藏真实的客户端。"},{"type":"tag","children":[],"name":"br","attribs":{}},{"type":"text","data":"\n反向代理源于服务端的网络需求，会隐藏真实的服务端。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"}],"name":"blockquote","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"再来一张图"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/diff-proxy.png","alt":"代理靠左点就是正向的，靠右点就是反向的"}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"其实无须过度区分这些，不论正反，请求都会经过中间的代理层，只要配通了、达到目的了就好。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#工程应用","className":"markdownIt-Anchor"}},{"type":"text","data":" 工程应用"}],"name":"h1","attribs":{"id":"工程应用"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"实际项目中反向代理用得最多，因为反向代理针对的是服务端的真实需求，我在实际使用的时候是利用 Nginx 来完成反向代理的，以下是一些用到代理的例子。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#vhost-虚拟站点","className":"markdownIt-Anchor"}},{"type":"text","data":" vhost 虚拟站点"}],"name":"h2","attribs":{"id":"vhost-虚拟站点"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"一个服务器有时候需要挂不止一个站点，也就是说有多个域名指向了这个站点，这时候需要用到 Nginx 的虚拟站点配置，别紧张这也是一种反向代理过程，因为这是服务端的需求，而且隐藏了服务器 （多个域名看起来好像不同的服务器提供的网站、而实际上却是同一个服务器提供的）"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"具体的而言，需要编写类似如下配置到你的 nginx 配置中："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"server"}],"name":"span","attribs":{"className":"token keyword"}}],"name":"span","attribs":{"className":"token directive"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"server_name"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" test.cc"}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"listen"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"80"}],"name":"span","attribs":{"className":"token number"}}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"root"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" /xxx/xxx/xx"}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"index"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" index.html index.htm"}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs nginx rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"我配置服务器的时候，通常使用 Nginx 作为网关层，让 Nginx 建立不同 VHOST，然后具体的对应 VHOST 上不同路径代理到不同端口上。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#跨域的问题","className":"markdownIt-Anchor"}},{"type":"text","data":" 跨域的问题"}],"name":"h2","attribs":{"id":"跨域的问题"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"如果静态文件在 test.cc 上，而接口在 test.cc:3000 上，需要通过反向代理的方式来规避跨域，其实只是："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"将 test.cc/api/* 代理到 test.cc:3000/api/*"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这里需要修改 VHOST 的配置："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"server"}],"name":"span","attribs":{"className":"token keyword"}}],"name":"span","attribs":{"className":"token directive"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"server_name"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" test.cc"}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"listen"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"80"}],"name":"span","attribs":{"className":"token number"}}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"root"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" /xxx/xxx/xx"}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"index"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" index.html index.htm"}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"location"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" /api"}],"name":"span","attribs":{"className":"token directive"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"proxy_pass"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" http://127.0.0.1:3000"}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"proxy_http_version"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" 1.1"}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"proxy_set_header"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" Upgrade "},{"type":"tag","children":[{"type":"text","data":"$http_upgrade"}],"name":"span","attribs":{"className":"token variable"}}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"proxy_set_header"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" Host "},{"type":"tag","children":[{"type":"text","data":"$host"}],"name":"span","attribs":{"className":"token variable"}}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"proxy_cache_bypass"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"$http_upgrade"}],"name":"span","attribs":{"className":"token variable"}}],"name":"span","attribs":{"className":"token directive"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs nginx rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"重启后，访问 test.cc/api 的时候，会返回访问 test.cc:3000/api 的结果，对于前端来说，访问的还是 test.cc/api 但实际上，服务器上的 Nginx 接到请求后将其代理到 3000 端口上了，对于客户端来说，隐藏了真实的服务器（端口）。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#https","className":"markdownIt-Anchor"}},{"type":"text","data":" HTTPS"}],"name":"h2","attribs":{"id":"https"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"续接上面，3000 端口无须设置 SSL 只需要 test.cc 是 https 的，那么访问 https://test.cc/api/* 的时候依然是 HTTPS 的，即使实际在服务器内部是一次简单的端口转发。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#负载均衡","className":"markdownIt-Anchor"}},{"type":"text","data":" 负载均衡"}],"name":"h2","attribs":{"id":"负载均衡"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"虽然没有在项目中应用过负载均衡，但是对它的原理比较清楚："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"对于一个服务器"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"上面起了很多个 Node 实例在不同端口 3000 3001 3002 3003 等"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"客户端访问它的 80 端口"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"将 80 端口接到的请求转发到 3000 3001 3002 3003 等端口上完成负载均衡"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"上述过程就是一次简单的负载均衡 （针对一台服务器、提高多核处理器利用率），不过看过很多文章，一般的负载均衡是用在集群里的，整个集群有一个网关，这个网关就是负载均衡器，用来分发请求。 （详见腾讯云提供的负载均衡服务）"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#dns-和-cdn","className":"markdownIt-Anchor"}},{"type":"text","data":" DNS 和 CDN"}],"name":"h2","attribs":{"id":"dns-和-cdn"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"CDN 中文名是内容分发网络，它可以极大的提高静态资源的分发速度，基本上我还没见过大型网站不用这个的 。。。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"基于如下的考虑："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"服务器离客户端的地理距离越近，加载速度越快"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"可以在不同地理位置建立静态资源服务器，在广州建一个、深圳建一个、华北建一个等等"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"不同地理位置的客户端的 DNS 通常是当地的 DNS"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"联系当地的 DNS 让它们吧 img.test.cc 解析到当地的静态资源站"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"可以看到深圳地区访问 img.test.cc DNS 解析到位于深圳的静态资源服务器，广州地区访问 img.test.cc DNS 解析到位于广州的静态资源服务器这样。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这是一个典型的反向代理：用户访问 img.test.cc 但是不必知道到底是访问了深圳的那个还是广州的那个，也就是说 DNS 隐藏了真实的服务器，DNS 充当了负载均衡器。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"DNS 在 CDN 中是主角，一旦 DNS 有问题，CDN 的速度可能会比原来直接访问还要慢。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"hr","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"CDN 还涉及到很多分布式问题，比如不同地域的静态服务器的增量同步问题，如何通知 DNS 解析中心刷新dns记录等等。。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#http-接口代理","className":"markdownIt-Anchor"}},{"type":"text","data":" HTTP 接口代理"}],"name":"h2","attribs":{"id":"http-接口代理"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"反向代理除了可以代理到本地的某个端口，甚至可以代理到其他的服务器上。利用这个可以完成如下的需求："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"访问 http://test.cc/baidu-api/* 代理到 http://api.baidu.com/* 去，进而解决前端直接访问 api.baidu.com 出现跨域的问题。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"可以用 nginx 做也可以用 express 的 http-proxy-middleware 来做："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" express "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'express'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" proxy "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'http-proxy-middleware'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" app "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"express"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"app"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"use"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'/baidu-api'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"proxy"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"target"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'http://api.baidu.com'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"changeOrigin"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"true"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"pathRewrite"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"'^/baidu-api'"}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这样会隐藏真实的 baidu 服务器，属于反向代理，不是正向代理。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"但是，对于 baidu 服务器来说，客户端被node中间价真实地隐藏了，并不是反向代理。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这种情况下其实都对：反向代理客户端的请求，将其正向代理到另外一个服务器上。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"}],"rawContent":""}}},"HomeApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"TimeLineApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"SettingApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"LaunchpadApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}}}</script>
<!--SCRIPT-->
</body>
</html>
