<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<title>Moonbit, 启动 | Eczn's Home</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,minimal-ui">
<meta name="format-detection" content="telephone=no">

<style id="CSS_VARS"></style>
<script>
(function() {
console.log('INIT CSS VAR');
function loadCSSVars() {
    const j = localStorage.getItem("CSS_VARS_2" /* STORAGE_KEY.CSS_VARS */);
    const initialVars = initialCSSVars();
    if (!j)
        return initialVars;
    try {
        const result = {
            ...initialVars,
            ...JSON.parse(j)
        };
        console.log('loadCSSVars from storage', result);
        return result;
    }
    catch (error) {
        console.error('load css vars with error', error);
        return initialVars;
    }
}
function renderCSSVars(vars, style) {
    const allDefine = Object.keys(vars).map(k => {
        const v = vars[k];
        const cssValue = typeof v === 'number' ? `${v}px` : v;
        return `--${k}:${cssValue};`;
    }).join('\n');
    if (style) {
        style.innerHTML = `:root { ${allDefine} }`;
    }
    else {
        console.error(`style#CSS_VARS NotFound !`);
    }
}
function initialCSSVars() {
    let rem = 16;
    // 移动端
    if (typeof window !== 'undefined' && window.innerWidth <= 500) {
        rem = Number(((window.innerWidth - 20) / 42).toFixed(1));
        console.log('mobile calculated rem =>', rem);
    }
    return {
        rem,
        enableSmallerFont: false,
        displayToc: 'block',
        fontSmcp: 'source serif pro, serif',
        fontCode: 'consolas, Menlo, monospace',
        fontTitle: 'Noto Serif SC, serif',
        fontArticle: 'source serif pro, LXGW WenKai',
        fontSansSerif: 'sans-serif',
    };
}
window.__initialCSSVars = loadCSSVars();
renderCSSVars(__initialCSSVars, document.querySelector('#CSS_VARS'));
})();
</script>

<link rel="icon" href="/favicon.png"><script defer="defer" src="/js/index.299ace5b.js"></script><script defer="defer" src="/js/chunk-lib.c90ce4c7.js"></script><link href="/css/index.a1e203ee6781e5bf7bb4.css" rel="stylesheet"><link href="/css/chunk-lib.5c7d4887bb8714b00c54.css" rel="stylesheet"></head>
<body x-apple-data-detectors="none">
<noscript>当前浏览器不支持 JavaScript, 建议使用支持 JavaScript 的浏览器来访问此网站 !</noscript>
<div id="rally-bg" style="opacity:0"></div>
<div id="app"><div class="ball-canvas-container"></div><nav class="nav-main --fontSmcp"><div class="_title default-max-width">Eczn&#x27;s Home</div><div class="smcphr"></div><div class="_links default-max-width"><a class="r-link _link clickable r-link" href="/">Home</a><a class="r-link _link clickable r-link" href="/tl/0/">Timeline</a><a class="r-link _link clickable r-link" href="/cate/all/">Category</a><a class="r-link _link clickable r-link" href="/setting/">Setting</a><a class="r-link _link clickable r-link" href="/launchpad/">Launchpad</a></div></nav><div class="std-box rally-page-content default-max-width"><div id="blog-box" class="std-box-content "><div id="start" class="blog-header-main"><div class="_infos"><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg>2024-05-01</div></div><div class="_title --fontTitle">Moonbit, 启动</div></div><article class="r-article-wrapper"><div class="toc-wrapper"><div class="toc"><div class="toc-item _active" style="padding-left:0em"><a href="#-3870564968" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>非常好安装体验</a></div><div class="toc-item" style="padding-left:0em"><a href="#function" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>一等公民函数</a></div><div class="toc-item" style="padding-left:0em"><a href="#tag-parameter" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>带标签的函数参数</a></div><div class="toc-item" style="padding-left:0em"><a href="#adt-style-loop" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>函数式循环</a></div><div class="toc-item" style="padding-left:0em"><a href="#multi-line-string" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>多行字符串</a></div><div class="toc-item" style="padding-left:0em"><a href="#enum-adt" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>enum adt</a></div><div class="toc-item" style="padding-left:0em"><a href="#no-null" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>没有空值</a></div><div class="toc-item" style="padding-left:0em"><a href="#mooncakes" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>moonckes 包管理</a></div><div class="toc-item" style="padding-left:0em"><a href="#eof" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>EOF</a></div><div class="_index --fontSmcp" data-minimap="Ignore">Indexes</div><div class="smcphr"></div></div></div><div class="r-article"><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">差不多工作了 5 年，现在对 JS/TS 语言构造愈发感到不快了，所以最近都在学点其他的语言调剂一下，不然真的要废内功了。</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">近期看了下由张宏波团队开发的国产编程语言 MoonBit，一眼就爱上了，是 OCaml like 的语言，有股 rust 味，但是没有 rust 生命周期那些烧脑的特性，语言自带 GC。</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">本文介绍一下我感觉很好的地方 (rust with gc 笑)</div><h1 id="-3870564968" class="std-title --fontTitle"><a href="#-3870564968" class="markdownIt-Anchor">#</a> 非常好安装体验<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">查看官网 https://www.moonbitlang.cn/download/ 有详细说明，基本是傻瓜式操作，而且由于是国产的下载速度非常快，我估计不会有人卡在这一步的，在安装完之后就可以用 <div class="std-inline-code" data-minimap-color="#f5e9e9">moon</div> 命令来使用相关工具链了，比如这样新建项目进行开发：</div><div class="std-code"><pre class="prismjs bash rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span>$ moon new myfirst  <span class="token comment"># 创建一个叫做 myfirst 的项目</span>
<span class="line-numbers-rows" style="user-select: none;">01</span>$ <span class="token builtin class-name">cd</span> myfirst        <span class="token comment"># chdir 到项目里</span>
<span class="line-numbers-rows" style="user-select: none;">02</span>$ moon run main     <span class="token comment"># 编译运行</span></pre></div><h1 id="function" class="std-title --fontTitle"><a href="#function" class="markdownIt-Anchor">#</a> 一等公民函数<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">在 moonbit 里函数是一等公民，使用词法作用域，因此会有跟 js 一样的闭包效果：</div><div class="std-code"><pre class="prismjs moonbit rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token comment">// 写在最外面的叫做「顶层函数」</span>
<span class="line-numbers-rows" style="user-select: none;">01</span><span class="token keyword">fn</span> <span class="token function-definition function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Int</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">02</span>  <span class="token keyword">let</span> <span class="token keyword">mut</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 可变值需要带上 mut 标记</span>
<span class="line-numbers-rows" style="user-select: none;">03</span>
<span class="line-numbers-rows" style="user-select: none;">04</span>  <span class="token comment">// 嵌套在内的叫做「局部函数」</span>
<span class="line-numbers-rows" style="user-select: none;">05</span>  <span class="token comment">// 局部函数的签名可以比较简略，编译器会自动推导</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>  <span class="token keyword">fn</span> <span class="token function-definition function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">07</span>    <span class="token comment">// 函数走的是跟 js 一样的词法作用域</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>    <span class="token keyword">let</span> r <span class="token operator">=</span> i
<span class="line-numbers-rows" style="user-select: none;">09</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
<span class="line-numbers-rows" style="user-select: none;">10</span>    <span class="token keyword">return</span> r
<span class="line-numbers-rows" style="user-select: none;">11</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">12</span>
<span class="line-numbers-rows" style="user-select: none;">13</span>  <span class="token keyword">return</span> inc
<span class="line-numbers-rows" style="user-select: none;">14</span><span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">15</span>
<span class="line-numbers-rows" style="user-select: none;">16</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">17</span>  <span class="token comment">// 因此也会有一模一样的闭包效果</span>
<span class="line-numbers-rows" style="user-select: none;">18</span>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="line-numbers-rows" style="user-select: none;">19</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
<span class="line-numbers-rows" style="user-select: none;">20</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="line-numbers-rows" style="user-select: none;">21</span><span class="token punctuation">}</span></pre></div><h1 id="tag-parameter" class="std-title --fontTitle"><a href="#tag-parameter" class="markdownIt-Anchor">#</a> 带标签的函数参数<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">支持标签参数、可选参数等高级特性：</div><div class="std-code"><pre class="prismjs moonbit rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token comment">// 此处的内置类型 Ref 可以理解为 ts: type Ref&lt;T> = { val: T }</span>
<span class="line-numbers-rows" style="user-select: none;">01</span><span class="token comment">// 1. 用 ~counter 的方式来给参数加标签</span>
<span class="line-numbers-rows" style="user-select: none;">02</span><span class="token comment">// 2. 用 = 来给参数带一个默认值使其变成可选参数</span>
<span class="line-numbers-rows" style="user-select: none;">03</span><span class="token comment">// 3. 默认值每次执行都会给一个「新的」</span>
<span class="line-numbers-rows" style="user-select: none;">04</span><span class="token keyword">fn</span> <span class="token function-definition function">incr</span><span class="token punctuation">(</span>~counter <span class="token punctuation">:</span> <span class="token class-name">Ref</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> val<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Ref</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">05</span>  counter<span class="token punctuation">.</span>val <span class="token operator">=</span> counter<span class="token punctuation">.</span>val <span class="token operator">+</span> <span class="token number">1</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>  counter
<span class="line-numbers-rows" style="user-select: none;">07</span><span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>
<span class="line-numbers-rows" style="user-select: none;">09</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">10</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="line-numbers-rows" style="user-select: none;">11</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 依然是 1，因为重新求值了默认表达式，产生了一个新的 Ref</span>
<span class="line-numbers-rows" style="user-select: none;">12</span>  <span class="token keyword">let</span> counter <span class="token punctuation">:</span> <span class="token class-name">Ref</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> val<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">13</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">incr</span><span class="token punctuation">(</span>~counter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="line-numbers-rows" style="user-select: none;">14</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">incr</span><span class="token punctuation">(</span>~counter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2，因为两次调用使用了同一个 Ref</span>
<span class="line-numbers-rows" style="user-select: none;">15</span><span class="token punctuation">}</span></pre></div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">参数默认值每次执行都会执行新的，不会复用，如果想一直复用同一个默认值，那么可以将其提升到全局</div><div class="std-code"><pre class="prismjs moonbit rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token keyword">let</span> default_counter <span class="token punctuation">:</span> <span class="token class-name">Ref</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> val<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">01</span>
<span class="line-numbers-rows" style="user-select: none;">02</span><span class="token keyword">fn</span> <span class="token function-definition function">incr</span><span class="token punctuation">(</span>~conuter <span class="token punctuation">:</span> <span class="token class-name">Ref</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> default_counter<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Int</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">03</span>  counter<span class="token punctuation">.</span>val <span class="token operator">=</span> counter<span class="token punctuation">.</span>val <span class="token operator">+</span> <span class="token number">1</span>
<span class="line-numbers-rows" style="user-select: none;">04</span>  counter<span class="token punctuation">.</span>val
<span class="line-numbers-rows" style="user-select: none;">05</span><span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>
<span class="line-numbers-rows" style="user-select: none;">07</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="line-numbers-rows" style="user-select: none;">09</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="line-numbers-rows" style="user-select: none;">10</span><span class="token punctuation">}</span></pre></div><h1 id="adt-style-loop" class="std-title --fontTitle"><a href="#adt-style-loop" class="markdownIt-Anchor">#</a> 函数式循环<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">看了真过瘾，专门给 ADT 设计的 reduce 循环：</div><div class="std-code"><pre class="prismjs moonbit rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token keyword">fn</span> <span class="token function-definition function">sum</span><span class="token punctuation">(</span>xs<span class="token punctuation">:</span> <span class="token class-name">List</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Int</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">01</span>  <span class="token keyword">loop</span> xs<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">02</span>    <span class="token class-name">Nil</span><span class="token punctuation">,</span> acc <span class="token operator">=></span> <span class="token keyword">break</span> acc <span class="token comment">// break 可以省略</span>
<span class="line-numbers-rows" style="user-select: none;">03</span>    <span class="token class-name">Cons</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> rest<span class="token punctuation">)</span><span class="token punctuation">,</span> acc <span class="token operator">=></span> <span class="token keyword">continue</span> rest<span class="token punctuation">,</span> x <span class="token operator">+</span> acc
<span class="line-numbers-rows" style="user-select: none;">04</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">05</span><span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>
<span class="line-numbers-rows" style="user-select: none;">07</span><span class="token keyword">fn</span> <span class="token function-definition function">init</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">Nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
<span class="line-numbers-rows" style="user-select: none;">09</span><span class="token punctuation">}</span></pre></div><h1 id="multi-line-string" class="std-title --fontTitle"><a href="#multi-line-string" class="markdownIt-Anchor">#</a> 多行字符串<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">字符串底下用 UTF-16 进行编码，除了常用的字符串优秀实践外，还提供了多行字符串（js 的模板字符串在多行的情况下会把缩进也一起编进去，实际使用很蛋疼）</div><div class="std-code"><pre class="prismjs moonbit rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">01</span>  <span class="token keyword">let</span> <span class="token keyword">str</span> <span class="token operator">=</span> 
<span class="line-numbers-rows" style="user-select: none;">02</span>    #<span class="token operator">|</span> <span class="token class-name">Hello</span>
<span class="line-numbers-rows" style="user-select: none;">03</span>    #<span class="token operator">|</span> <span class="token class-name">World</span>
<span class="line-numbers-rows" style="user-select: none;">04</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">str</span><span class="token punctuation">)</span>
<span class="line-numbers-rows" style="user-select: none;">05</span><span class="token punctuation">}</span></pre></div><h1 id="enum-adt" class="std-title --fontTitle"><a href="#enum-adt" class="markdownIt-Anchor">#</a> enum adt<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">爷最爱的 adt</div><div class="std-code"><pre class="prismjs moonbit rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token keyword">enum</span> <span class="token type-definition class-name">DragState</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">01</span>  <span class="token class-name">Invalid</span>
<span class="line-numbers-rows" style="user-select: none;">02</span>  <span class="token class-name">Active</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span>
<span class="line-numbers-rows" style="user-select: none;">03</span><span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">04</span>
<span class="line-numbers-rows" style="user-select: none;">05</span><span class="token keyword">fn</span> <span class="token function-definition function">printDragState</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">DragState</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Unit</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>  <span class="token keyword">match</span> s <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">07</span>    <span class="token class-name">Invalid</span> <span class="token operator">=></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"未激活拖拽"</span><span class="token punctuation">)</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>    <span class="token class-name">Active</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">09</span>      <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"拖拽中 ... dx=(dx) dy=(dy)"</span><span class="token punctuation">)</span>
<span class="line-numbers-rows" style="user-select: none;">10</span>    <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">11</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">12</span><span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">13</span>
<span class="line-numbers-rows" style="user-select: none;">14</span><span class="token keyword">fn</span> <span class="token function-definition function">init</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">15</span>  <span class="token function">printDragState</span><span class="token punctuation">(</span><span class="token class-name">Invalid</span><span class="token punctuation">)</span>      <span class="token comment">// 未激活拖拽</span>
<span class="line-numbers-rows" style="user-select: none;">16</span>  <span class="token function">printDragState</span><span class="token punctuation">(</span><span class="token class-name">Active</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 拖拽中 ... dx=1 dy=2</span>
<span class="line-numbers-rows" style="user-select: none;">17</span><span class="token punctuation">}</span></pre></div><h1 id="no-null" class="std-title --fontTitle"><a href="#no-null" class="markdownIt-Anchor">#</a> 没有空值<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">由于提供了基于 ADT 构造的 Option 和 Result, moonbit 没有额外提供 null 这些空值了，配合 <div class="std-inline-code" data-minimap-color="#f5e9e9">?.</div> 问号操作符能写出更健壮的代码：</div><div class="std-code"><pre class="prismjs moonbit rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token keyword">fn</span> <span class="token function-definition function">may_fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">01</span>
<span class="line-numbers-rows" style="user-select: none;">02</span><span class="token keyword">fn</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">03</span>  <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">may_fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
<span class="line-numbers-rows" style="user-select: none;">04</span>  <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">may_fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">lsr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="line-numbers-rows" style="user-select: none;">05</span>  <span class="token keyword">if</span> y <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">None</span> <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>  <span class="token class-name">Some</span><span class="token punctuation">(</span>x <span class="token operator">/</span> y<span class="token punctuation">)</span>
<span class="line-numbers-rows" style="user-select: none;">07</span><span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>
<span class="line-numbers-rows" style="user-select: none;">09</span><span class="token keyword">fn</span> <span class="token function-definition function">may_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">10</span>
<span class="line-numbers-rows" style="user-select: none;">11</span><span class="token keyword">fn</span> <span class="token function-definition function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">12</span>  <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">may_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
<span class="line-numbers-rows" style="user-select: none;">13</span>  <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">may_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">*</span> <span class="token number">2</span>
<span class="line-numbers-rows" style="user-select: none;">14</span>  <span class="token keyword">if</span> y <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token string">"divide by zero"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">15</span>  <span class="token class-name">Ok</span><span class="token punctuation">(</span>x <span class="token operator">/</span> y<span class="token punctuation">)</span>
<span class="line-numbers-rows" style="user-select: none;">16</span><span class="token punctuation">}</span></pre></div><h1 id="mooncakes" class="std-title --fontTitle"><a href="#mooncakes" class="markdownIt-Anchor">#</a> moonckes 包管理<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">moonbit 提供了 mooncakes.io 作为包管理平台，跟语言深度结合，比 npm 高到不知道哪里去, 下面是我发的一个测试包，自带文档工具</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC"><a href="https://mooncakes.io/docs/#/eczn/eczn-utils/" target="_blank" style="background-color:#f8ece6" class="std-link --fontSansSerif  _block" data-minimap-color="#f8ece6"><span class="std-link-icon r-link" data-src="/get-favicon/mooncakes.io?h=1381796598" style="background-image:url(&quot;/get-favicon/mooncakes.io?h=1381796598&quot;)"></span><span class="std-link-txt">mooncakes - eczn/eczn-utils</span></a></div><h1 id="eof" class="std-title --fontTitle"><a href="#eof" class="markdownIt-Anchor">#</a> EOF<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这门语言是新开发的，目前仍在快速迭代中，从我去年第一次关注以来已经多了非常多功能了，前两天还发布了新的 js 后端 —— 也就是可以编译成 js 使用，试了下非常好，可以充分享受写高级语言的乐趣。</div></div></article></div></div><div class="smcphr rally-page-smcphr"></div><div class="std-box rally-giscus-wrapper default-max-width"><div class="std-box-content "></div></div></div>
<script>window.__INITIAL_STATE__ = {"CategoryApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"BlogApiState":{"loaded":true,"loading":false,"error":null,"dataMap":{"moonbit-start":{"type":"tsx","meta":{"id":"moonbit-start","title":"Moonbit, 启动","author":"eczn","time":"2024-05-01T03:33:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},"tsxDistPath":"./moonbit-start/index.blog.js","ssrContent":"<div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">差不多工作了 5 年，现在对 JS/TS 语言构造愈发感到不快了，所以最近都在学点其他的语言调剂一下，不然真的要废内功了。</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">近期看了下由张宏波团队开发的国产编程语言 MoonBit，一眼就爱上了，是 OCaml like 的语言，有股 rust 味，但是没有 rust 生命周期那些烧脑的特性，语言自带 GC。</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">本文介绍一下我感觉很好的地方 (rust with gc 笑)</div><h1 id=\"-3870564968\" class=\"std-title --fontTitle\"><a href=\"#-3870564968\" class=\"markdownIt-Anchor\">#</a> 非常好安装体验<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">查看官网 https://www.moonbitlang.cn/download/ 有详细说明，基本是傻瓜式操作，而且由于是国产的下载速度非常快，我估计不会有人卡在这一步的，在安装完之后就可以用 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">moon</div> 命令来使用相关工具链了，比如这样新建项目进行开发：</div><div class=\"std-code\"><pre class=\"prismjs bash rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span>$ moon new myfirst  <span class=\"token comment\"># 创建一个叫做 myfirst 的项目</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span>$ <span class=\"token builtin class-name\">cd</span> myfirst        <span class=\"token comment\"># chdir 到项目里</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>$ moon run main     <span class=\"token comment\"># 编译运行</span></pre></div><h1 id=\"function\" class=\"std-title --fontTitle\"><a href=\"#function\" class=\"markdownIt-Anchor\">#</a> 一等公民函数<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">在 moonbit 里函数是一等公民，使用词法作用域，因此会有跟 js 一样的闭包效果：</div><div class=\"std-code\"><pre class=\"prismjs moonbit rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token comment\">// 写在最外面的叫做「顶层函数」</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Int</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>  <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token comment\">// 可变值需要带上 mut 标记</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  <span class=\"token comment\">// 嵌套在内的叫做「局部函数」</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  <span class=\"token comment\">// 局部函数的签名可以比较简略，编译器会自动推导</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">inc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span>    <span class=\"token comment\">// 函数走的是跟 js 一样的词法作用域</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>    <span class=\"token keyword\">let</span> r <span class=\"token operator\">=</span> i\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span>    i <span class=\"token operator\">=</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>    <span class=\"token keyword\">return</span> r\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">13</span>  <span class=\"token keyword\">return</span> inc\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">14</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">15</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">16</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">17</span>  <span class=\"token comment\">// 因此也会有一模一样的闭包效果</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">18</span>  <span class=\"token keyword\">let</span> count <span class=\"token operator\">=</span> <span class=\"token function\">counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">19</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 0</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">20</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">21</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"tag-parameter\" class=\"std-title --fontTitle\"><a href=\"#tag-parameter\" class=\"markdownIt-Anchor\">#</a> 带标签的函数参数<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">支持标签参数、可选参数等高级特性：</div><div class=\"std-code\"><pre class=\"prismjs moonbit rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token comment\">// 此处的内置类型 Ref 可以理解为 ts: type Ref&lt;T> = { val: T }</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span><span class=\"token comment\">// 1. 用 ~counter 的方式来给参数加标签</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span><span class=\"token comment\">// 2. 用 = 来给参数带一个默认值使其变成可选参数</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span><span class=\"token comment\">// 3. 默认值每次执行都会给一个「新的」</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">incr</span><span class=\"token punctuation\">(</span>~counter <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Ref</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> val<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Ref</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  counter<span class=\"token punctuation\">.</span>val <span class=\"token operator\">=</span> counter<span class=\"token punctuation\">.</span>val <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  counter\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">incr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">incr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 依然是 1，因为重新求值了默认表达式，产生了一个新的 Ref</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span>  <span class=\"token keyword\">let</span> counter <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Ref</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> val<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">13</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">incr</span><span class=\"token punctuation\">(</span>~counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">14</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">incr</span><span class=\"token punctuation\">(</span>~counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2，因为两次调用使用了同一个 Ref</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">15</span><span class=\"token punctuation\">}</span></pre></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">参数默认值每次执行都会执行新的，不会复用，如果想一直复用同一个默认值，那么可以将其提升到全局</div><div class=\"std-code\"><pre class=\"prismjs moonbit rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token keyword\">let</span> default_counter <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Ref</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> val<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">incr</span><span class=\"token punctuation\">(</span>~conuter <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Ref</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> default_counter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Int</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>  counter<span class=\"token punctuation\">.</span>val <span class=\"token operator\">=</span> counter<span class=\"token punctuation\">.</span>val <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  counter<span class=\"token punctuation\">.</span>val\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">incr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">incr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"adt-style-loop\" class=\"std-title --fontTitle\"><a href=\"#adt-style-loop\" class=\"markdownIt-Anchor\">#</a> 函数式循环<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">看了真过瘾，专门给 ADT 设计的 reduce 循环：</div><div class=\"std-code\"><pre class=\"prismjs moonbit rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">sum</span><span class=\"token punctuation\">(</span>xs<span class=\"token punctuation\">:</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Int</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span>  <span class=\"token keyword\">loop</span> xs<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>    <span class=\"token class-name\">Nil</span><span class=\"token punctuation\">,</span> acc <span class=\"token operator\">=></span> <span class=\"token keyword\">break</span> acc <span class=\"token comment\">// break 可以省略</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>    <span class=\"token class-name\">Cons</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> rest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> acc <span class=\"token operator\">=></span> <span class=\"token keyword\">continue</span> rest<span class=\"token punctuation\">,</span> x <span class=\"token operator\">+</span> acc\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">init</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Cons</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Cons</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Cons</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 6</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"multi-line-string\" class=\"std-title --fontTitle\"><a href=\"#multi-line-string\" class=\"markdownIt-Anchor\">#</a> 多行字符串<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">字符串底下用 UTF-16 进行编码，除了常用的字符串优秀实践外，还提供了多行字符串（js 的模板字符串在多行的情况下会把缩进也一起编进去，实际使用很蛋疼）</div><div class=\"std-code\"><pre class=\"prismjs moonbit rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span>  <span class=\"token keyword\">let</span> <span class=\"token keyword\">str</span> <span class=\"token operator\">=</span> \n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>    #<span class=\"token operator\">|</span> <span class=\"token class-name\">Hello</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>    #<span class=\"token operator\">|</span> <span class=\"token class-name\">World</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">str</span><span class=\"token punctuation\">)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"enum-adt\" class=\"std-title --fontTitle\"><a href=\"#enum-adt\" class=\"markdownIt-Anchor\">#</a> enum adt<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">爷最爱的 adt</div><div class=\"std-code\"><pre class=\"prismjs moonbit rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token keyword\">enum</span> <span class=\"token type-definition class-name\">DragState</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span>  <span class=\"token class-name\">Invalid</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>  <span class=\"token class-name\">Active</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Int</span><span class=\"token punctuation\">)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">printDragState</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">:</span> <span class=\"token class-name\">DragState</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Unit</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  <span class=\"token keyword\">match</span> s <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span>    <span class=\"token class-name\">Invalid</span> <span class=\"token operator\">=></span> <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"未激活拖拽\"</span><span class=\"token punctuation\">)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>    <span class=\"token class-name\">Active</span><span class=\"token punctuation\">(</span>dx<span class=\"token punctuation\">,</span> dy<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span>      <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"拖拽中 ... dx=(dx) dy=(dy)\"</span><span class=\"token punctuation\">)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>    <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">13</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">14</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">init</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">15</span>  <span class=\"token function\">printDragState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Invalid</span><span class=\"token punctuation\">)</span>      <span class=\"token comment\">// 未激活拖拽</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">16</span>  <span class=\"token function\">printDragState</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Active</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 拖拽中 ... dx=1 dy=2</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">17</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"no-null\" class=\"std-title --fontTitle\"><a href=\"#no-null\" class=\"markdownIt-Anchor\">#</a> 没有空值<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">由于提供了基于 ADT 构造的 Option 和 Result, moonbit 没有额外提供 null 这些空值了，配合 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">?.</div> 问号操作符能写出更健壮的代码：</div><div class=\"std-code\"><pre class=\"prismjs moonbit rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">may_fail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Option</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">...</span> <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Option</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token function\">may_fail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token function\">may_fail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">lsr</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  <span class=\"token keyword\">if</span> y <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token class-name\">None</span> <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  <span class=\"token class-name\">Some</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">/</span> y<span class=\"token punctuation\">)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">may_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">...</span> <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">g</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">[</span><span class=\"token class-name\">Int</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span>  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token function\">may_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">13</span>  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token function\">may_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">14</span>  <span class=\"token keyword\">if</span> y <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token class-name\">Err</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"divide by zero\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">15</span>  <span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">/</span> y<span class=\"token punctuation\">)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">16</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"mooncakes\" class=\"std-title --fontTitle\"><a href=\"#mooncakes\" class=\"markdownIt-Anchor\">#</a> moonckes 包管理<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">moonbit 提供了 mooncakes.io 作为包管理平台，跟语言深度结合，比 npm 高到不知道哪里去, 下面是我发的一个测试包，自带文档工具</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\"><a href=\"https://mooncakes.io/docs/#/eczn/eczn-utils/\" target=\"_blank\" style=\"background-color:#f8ece6\" class=\"std-link --fontSansSerif  _block\" data-minimap-color=\"#f8ece6\"><span class=\"std-link-icon r-link\" data-src=\"/get-favicon/mooncakes.io?h=1381796598\" style=\"background-image:url(&quot;/get-favicon/mooncakes.io?h=1381796598&quot;)\"></span><span class=\"std-link-txt\">mooncakes - eczn/eczn-utils</span></a></div><h1 id=\"eof\" class=\"std-title --fontTitle\"><a href=\"#eof\" class=\"markdownIt-Anchor\">#</a> EOF<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">这门语言是新开发的，目前仍在快速迭代中，从我去年第一次关注以来已经多了非常多功能了，前两天还发布了新的 js 后端 —— 也就是可以编译成 js 使用，试了下非常好，可以充分享受写高级语言的乐趣。</div>","props":{},"tocStack":[{"id":"-3870564968","level":1,"text":"非常好安装体验"},{"id":"function","level":1,"text":"一等公民函数"},{"id":"tag-parameter","level":1,"text":"带标签的函数参数"},{"id":"adt-style-loop","level":1,"text":"函数式循环"},{"id":"multi-line-string","level":1,"text":"多行字符串"},{"id":"enum-adt","level":1,"text":"enum adt"},{"id":"no-null","level":1,"text":"没有空值"},{"id":"mooncakes","level":1,"text":"moonckes 包管理"},{"id":"eof","level":1,"text":"EOF"}]}}},"HomeApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"TimeLineApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"SettingApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"LaunchpadApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}}}</script>
<!--SCRIPT-->
</body>
</html>
