<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<title>二进制补码的数学原理 | Eczn's Home</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,minimal-ui">
<meta name="format-detection" content="telephone=no">

<style id="CSS_VARS"></style>
<script>
(function() {
console.log('INIT CSS VAR');
function loadCSSVars() {
    const j = localStorage.getItem("CSS_VARS_2" /* STORAGE_KEY.CSS_VARS */);
    const initialVars = initialCSSVars();
    if (!j)
        return initialVars;
    try {
        const result = {
            ...initialVars,
            ...JSON.parse(j)
        };
        console.log('loadCSSVars from storage', result);
        return result;
    }
    catch (error) {
        console.error('load css vars with error', error);
        return initialVars;
    }
}
function renderCSSVars(vars, style) {
    const allDefine = Object.keys(vars).map(k => {
        const v = vars[k];
        const cssValue = typeof v === 'number' ? `${v}px` : v;
        return `--${k}:${cssValue};`;
    }).join('\n');
    if (style) {
        style.innerHTML = `:root { ${allDefine} }`;
    }
    else {
        console.error(`style#CSS_VARS NotFound !`);
    }
}
function initialCSSVars() {
    let rem = 16;
    // 移动端
    if (typeof window !== 'undefined' && window.innerWidth <= 500) {
        rem = Number(((window.innerWidth - 20) / 42).toFixed(1));
        console.log('mobile calculated rem =>', rem);
    }
    return {
        rem,
        enableSmallerFont: false,
        displayToc: 'block',
        fontSmcp: 'source serif pro, serif',
        fontCode: 'consolas, Menlo, monospace',
        fontTitle: 'Noto Serif SC, serif',
        fontArticle: 'source serif pro, LXGW WenKai',
        fontSansSerif: 'sans-serif',
    };
}
window.__initialCSSVars = loadCSSVars();
renderCSSVars(__initialCSSVars, document.querySelector('#CSS_VARS'));
})();
</script>

<link rel="icon" href="/favicon.png"><script defer="defer" src="/js/index.0fcf7c9d.js"></script><script defer="defer" src="/js/chunk-lib.c90ce4c7.js"></script><link href="/css/index.b0e70e3c588e68d62835.css" rel="stylesheet"><link href="/css/chunk-lib.5c7d4887bb8714b00c54.css" rel="stylesheet"></head>
<body x-apple-data-detectors="none">
<noscript>当前浏览器不支持 JavaScript, 建议使用支持 JavaScript 的浏览器来访问此网站 !</noscript>
<div id="rally-bg" style="opacity:0"></div>
<div id="app"><div class="ball-canvas-container"></div><nav class="nav-main --fontSmcp"><div class="_title default-max-width">Eczn&#x27;s Home</div><div class="smcphr"></div><div class="_links default-max-width"><a class="r-link _link clickable r-link" href="/">Home</a><a class="r-link _link clickable r-link" href="/tl/0/">Timeline</a><a class="r-link _link clickable r-link" href="/cate/all/">Category</a><a class="r-link _link clickable r-link" href="/setting/">Setting</a><a class="r-link _link clickable r-link" href="/launchpad/">Launchpad</a></div></nav><div class="std-box rally-page-content default-max-width"><div id="blog-box" class="std-box-content "><div id="start" class="blog-header-main"><div class="_infos"><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg>2024-04-29</div></div><div class="_title --fontTitle">二进制补码的数学原理</div></div><article><div class="toc"><div class="toc-item _active" style="padding-left:0em"><a href="#algebraic-relations-between-original-inverse-complement" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>原码、反码、补码的规则和代数关系</a></div><div class="toc-item" style="padding-left:0em"><a href="#A-B" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>实现减法 A - B (假设 A &gt;= B)</a></div><div class="toc-item" style="padding-left:0em"><a href="#decimal-complement-extension" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>十进制下的补码推广</a></div><div class="toc-item" style="padding-left:0em"><a href="#signed-number" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>引入有符号数</a></div><div class="toc-item" style="padding-left:0em"><a href="#-3782049860" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>实现任意减法 A - B</a></div><div class="toc-item" style="padding-left:0em"><a href="#865137154" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>溢出问题</a></div><div class="_index --fontSmcp" data-minimap="Ignore">Indexes</div><div class="smcphr"></div></div><div class="r-article"><style>.input-num {
  font-size: 125%;
  font-family: var(--fontCode);

  padding: 1em;

  & input {
    display: inline-block;
    width: 100%;
    font-family: inherit;
    font-size: inherit;
    text-align: center;
    width: 5em;
    color: rgb(255 255 255);
    background: rgb(128 15 15);
    border: none;
    outline: none;
  }
}

.input-num-item {
  margin-bottom: 1em;
  > * {
    display: inline-block;
  }
  > span {
    margin-right: .5em;
  }
}
</style><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">最近在看一些虚拟机相关的，里面状态寄存器的 Overflow 的规则变化看着非常复杂，看完直接注意力涣散 ... 重新想了下应该是对补码相关原理理解不够深刻，这里手写个「补码 demo」来实现完全同步。</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">备注: 如无特殊说明，本文中出现的整数都是 8 位整数。</div><h1 id="algebraic-relations-between-original-inverse-complement" class="std-title --fontTitle"><a href="#algebraic-relations-between-original-inverse-complement" class="markdownIt-Anchor">#</a> 原码、反码、补码的规则和代数关系<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">原码是将数字表示为二进制形式，反码是将其所有二进制位置反, 补码则是在反码的基础上加 1。具体转换可以看下面这个 demo, 在上面输入一个整数，下方会将其转为「原码」「反码」「补码」三种形式</div><div class="std-window mode-windowed"><div class="std-window-menus"><div class="std-window-title"><span></span></div><div class="std-window-btns"><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div></div></div><div style="height:auto" class="std-window-content"><div class="input-num"><div class="input-num-item"><span>右侧输入:</span><div><input value="24"/></div></div><div class="input-num-item"><span>原码</span><div>00011000 ==&gt; 24 (0x18)</div></div><div class="input-num-item"><span>反码</span><div>11100111 ==&gt; 231 (0xe7) ==&gt; 255 - 24</div></div><div class="input-num-item"><span>补码</span><div>11101000 ==&gt; 232 (0xe8) ==&gt; 256 - 24</div></div></div></div></div><div style="display:none;height:0px;background:#BBB">placeholder</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">显然上述变换立马就能注意到，任意数值 N 反码后得到的是 255 - N，而补码是在反码基础上加 1，因此总结如下：</div><ol class="numbering-main" data-minimap-color="#DDDDDD"><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">1.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">原码: N</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">2.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">反码: 255 - N</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">3.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">补码: 255 - N + 1, 即 256 - N</div></li></ol><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">* 其中 255 为 8 位整数的最大数值 (2^n - 1)，对于其他位宽的整数依次类推</div><h1 id="A-B" class="std-title --fontTitle"><a href="#A-B" class="markdownIt-Anchor">#</a> 实现减法 A - B (假设 A &gt;= B)<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">注意到 N 的补码为 256 - N, 因此: </div><div class="std-formula-wrapper" style="display:block"><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6em;vertical-align:-2.75em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">256</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">256</span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">补码</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">256</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span></div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">现在来验证一下 87 - 8 = 79:</div><div class="std-formula-wrapper" style="display:block"><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6em;vertical-align:-2.75em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">87</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">8</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">87</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">补码</span><span class="mopen">(</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">256</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">87</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">248</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">256</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">335</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">256</span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">79</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span></div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">当然你可能还会问这不是还有 <div class="std-inline-code" data-minimap-color="#f5e9e9">- 256</div> 么，这个数在二进制上比较特殊，是 0b100000000</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">因此可以考虑 <div class="std-inline-code" data-minimap-color="#f5e9e9">335 &amp; 0b11111111</div> 或者 <div class="std-inline-code" data-minimap-color="#f5e9e9">335 % 256</div> 的方式来求出最终结果</div><h1 id="decimal-complement-extension" class="std-title --fontTitle"><a href="#decimal-complement-extension" class="markdownIt-Anchor">#</a> 十进制下的补码推广<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">注意到 8 位二进制数 N 的补码是 256 - N，将这个结论推广到十进制则有：4 位十进制数 N 的补码是 1000 - N</div><div class="std-formula-wrapper" style="display:block"><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6em;vertical-align:-2.75em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">87</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">8</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">87</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">补码</span><span class="mopen">(</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1000</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">87</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">992</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1000</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1079</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1000</span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">79</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span></div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">对于人脑来说，计算 - 1000 非常容易，因此对于计算机来说计算 - 256 其实也是类似的，很好处理。（甚至都不需要处理，因为前面那个 case 里 335 已经溢出了，剩下的低 8 位就是最终答案了）</div><h1 id="signed-number" class="std-title --fontTitle"><a href="#signed-number" class="markdownIt-Anchor">#</a> 引入有符号数<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">前面讨论的那个 case 是正数减去正数后还是正数的情况，如果要考虑任意加减法的时候就得考虑负数的表达了。</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">有符号数有两种编码方式，一种是直接用最高位作为符号位的表达，如下左表所示；一种则是「负数用补码、正数用原码」的方式进行编码，如下右表所示：</div><table style="display:inline-block;font-size:75%;text-align:center;border-collapse:collapse;margin-bottom:1em;font-family:var(--fontArticle);margin-right:2em"><thead><tr><th style="padding:.5em;border:1px solid #BBB">正数</th><th style="padding:.5em;border:1px solid #BBB">十进制</th><th style="padding:.5em;border:1px solid #BBB">负数</th><th style="padding:.5em;border:1px solid #BBB">十进制</th></tr></thead><tbody><tr><td style="padding:.5em;border:1px solid #BBB">0000</td><td style="padding:.5em;border:1px solid #BBB">0</td><td style="padding:.5em;border:1px solid #BBB">1000</td><td style="padding:.5em;border:1px solid #BBB">-0</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0001</td><td style="padding:.5em;border:1px solid #BBB">1</td><td style="padding:.5em;border:1px solid #BBB">1001</td><td style="padding:.5em;border:1px solid #BBB">-1</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0010</td><td style="padding:.5em;border:1px solid #BBB">2</td><td style="padding:.5em;border:1px solid #BBB">1010</td><td style="padding:.5em;border:1px solid #BBB">-2</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0011</td><td style="padding:.5em;border:1px solid #BBB">3</td><td style="padding:.5em;border:1px solid #BBB">1011</td><td style="padding:.5em;border:1px solid #BBB">-3</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0100</td><td style="padding:.5em;border:1px solid #BBB">4</td><td style="padding:.5em;border:1px solid #BBB">1100</td><td style="padding:.5em;border:1px solid #BBB">-4</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0101</td><td style="padding:.5em;border:1px solid #BBB">5</td><td style="padding:.5em;border:1px solid #BBB">1101</td><td style="padding:.5em;border:1px solid #BBB">-5</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0110</td><td style="padding:.5em;border:1px solid #BBB">6</td><td style="padding:.5em;border:1px solid #BBB">1110</td><td style="padding:.5em;border:1px solid #BBB">-6</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0111</td><td style="padding:.5em;border:1px solid #BBB">7</td><td style="padding:.5em;border:1px solid #BBB">1111</td><td style="padding:.5em;border:1px solid #BBB">-7</td></tr></tbody></table><table style="display:inline-block;font-size:75%;text-align:center;border-collapse:collapse;margin-bottom:1em;font-family:var(--fontArticle)"><thead><tr><th style="padding:.5em;border:1px solid #BBB">原码</th><th style="padding:.5em;border:1px solid #BBB">十进制</th><th style="padding:.5em;border:1px solid #BBB">补码</th><th style="padding:.5em;border:1px solid #BBB">十进制</th></tr></thead><tbody><tr><td style="padding:.5em;border:1px solid #BBB">0000</td><td style="padding:.5em;border:1px solid #BBB">0</td><td style="padding:.5em;border:1px solid #BBB">1111</td><td style="padding:.5em;border:1px solid #BBB">-1</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0001</td><td style="padding:.5em;border:1px solid #BBB">1</td><td style="padding:.5em;border:1px solid #BBB">1110</td><td style="padding:.5em;border:1px solid #BBB">-2</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0010</td><td style="padding:.5em;border:1px solid #BBB">2</td><td style="padding:.5em;border:1px solid #BBB">1101</td><td style="padding:.5em;border:1px solid #BBB">-3</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0011</td><td style="padding:.5em;border:1px solid #BBB">3</td><td style="padding:.5em;border:1px solid #BBB">1100</td><td style="padding:.5em;border:1px solid #BBB">-4</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0100</td><td style="padding:.5em;border:1px solid #BBB">4</td><td style="padding:.5em;border:1px solid #BBB">1011</td><td style="padding:.5em;border:1px solid #BBB">-5</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0101</td><td style="padding:.5em;border:1px solid #BBB">5</td><td style="padding:.5em;border:1px solid #BBB">1010</td><td style="padding:.5em;border:1px solid #BBB">-6</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0110</td><td style="padding:.5em;border:1px solid #BBB">6</td><td style="padding:.5em;border:1px solid #BBB">1001</td><td style="padding:.5em;border:1px solid #BBB">-7</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0111</td><td style="padding:.5em;border:1px solid #BBB">7</td><td style="padding:.5em;border:1px solid #BBB">1000</td><td style="padding:.5em;border:1px solid #BBB">-8</td></tr></tbody></table><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">进一步，如果我们将「1000」当成「起始点」然后进一步做对比就可以得到下面的这张表。</div><table style="width:100%;display:block;font-size:75%;text-align:center;border-collapse:collapse;margin-bottom:1em;font-family:var(--fontArticle)"><thead><tr><th style="padding:.5em;border:1px solid #BBB">补码有符号数</th><th style="padding:.5em;border:1px solid #BBB">十进制</th><th style="padding:.5em;border:1px solid #BBB">无符号数</th><th style="padding:.5em;border:1px solid #BBB">十进制</th><th style="padding:.5em;border:1px solid #BBB">经典有符号数</th><th style="padding:.5em;border:1px solid #BBB">十进制</th></tr></thead><tbody><tr><td style="padding:.5em;border:1px solid #BBB">1000</td><td style="padding:.5em;border:1px solid #BBB">-8</td><td style="padding:.5em;border:1px solid #BBB">1000</td><td style="padding:.5em;border:1px solid #BBB">8</td><td style="padding:.5em;border:1px solid #BBB">1000</td><td style="padding:.5em;border:1px solid #BBB">-0</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">1001</td><td style="padding:.5em;border:1px solid #BBB">-7</td><td style="padding:.5em;border:1px solid #BBB">1001</td><td style="padding:.5em;border:1px solid #BBB">9</td><td style="padding:.5em;border:1px solid #BBB">1001</td><td style="padding:.5em;border:1px solid #BBB">-1</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">1010</td><td style="padding:.5em;border:1px solid #BBB">-6</td><td style="padding:.5em;border:1px solid #BBB">1010</td><td style="padding:.5em;border:1px solid #BBB">10</td><td style="padding:.5em;border:1px solid #BBB">1010</td><td style="padding:.5em;border:1px solid #BBB">-2</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">1011</td><td style="padding:.5em;border:1px solid #BBB">-5</td><td style="padding:.5em;border:1px solid #BBB">1011</td><td style="padding:.5em;border:1px solid #BBB">11</td><td style="padding:.5em;border:1px solid #BBB">1011</td><td style="padding:.5em;border:1px solid #BBB">-3</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">1100</td><td style="padding:.5em;border:1px solid #BBB">-4</td><td style="padding:.5em;border:1px solid #BBB">1100</td><td style="padding:.5em;border:1px solid #BBB">12</td><td style="padding:.5em;border:1px solid #BBB">1100</td><td style="padding:.5em;border:1px solid #BBB">-4</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">1101</td><td style="padding:.5em;border:1px solid #BBB">-3</td><td style="padding:.5em;border:1px solid #BBB">1101</td><td style="padding:.5em;border:1px solid #BBB">13</td><td style="padding:.5em;border:1px solid #BBB">1101</td><td style="padding:.5em;border:1px solid #BBB">-5</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">1110</td><td style="padding:.5em;border:1px solid #BBB">-2</td><td style="padding:.5em;border:1px solid #BBB">1110</td><td style="padding:.5em;border:1px solid #BBB">14</td><td style="padding:.5em;border:1px solid #BBB">1110</td><td style="padding:.5em;border:1px solid #BBB">-6</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">1111</td><td style="padding:.5em;border:1px solid #BBB">-1</td><td style="padding:.5em;border:1px solid #BBB">1111</td><td style="padding:.5em;border:1px solid #BBB">15</td><td style="padding:.5em;border:1px solid #BBB">1111</td><td style="padding:.5em;border:1px solid #BBB">-7</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0000</td><td style="padding:.5em;border:1px solid #BBB">0</td><td style="padding:.5em;border:1px solid #BBB">0000</td><td style="padding:.5em;border:1px solid #BBB">0</td><td style="padding:.5em;border:1px solid #BBB">0000</td><td style="padding:.5em;border:1px solid #BBB">+0</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0001</td><td style="padding:.5em;border:1px solid #BBB">1</td><td style="padding:.5em;border:1px solid #BBB">0001</td><td style="padding:.5em;border:1px solid #BBB">1</td><td style="padding:.5em;border:1px solid #BBB">0001</td><td style="padding:.5em;border:1px solid #BBB">1</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0010</td><td style="padding:.5em;border:1px solid #BBB">2</td><td style="padding:.5em;border:1px solid #BBB">0010</td><td style="padding:.5em;border:1px solid #BBB">2</td><td style="padding:.5em;border:1px solid #BBB">0010</td><td style="padding:.5em;border:1px solid #BBB">2</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0011</td><td style="padding:.5em;border:1px solid #BBB">3</td><td style="padding:.5em;border:1px solid #BBB">0011</td><td style="padding:.5em;border:1px solid #BBB">3</td><td style="padding:.5em;border:1px solid #BBB">0011</td><td style="padding:.5em;border:1px solid #BBB">3</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0100</td><td style="padding:.5em;border:1px solid #BBB">4</td><td style="padding:.5em;border:1px solid #BBB">0100</td><td style="padding:.5em;border:1px solid #BBB">4</td><td style="padding:.5em;border:1px solid #BBB">0100</td><td style="padding:.5em;border:1px solid #BBB">4</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0101</td><td style="padding:.5em;border:1px solid #BBB">5</td><td style="padding:.5em;border:1px solid #BBB">0101</td><td style="padding:.5em;border:1px solid #BBB">5</td><td style="padding:.5em;border:1px solid #BBB">0101</td><td style="padding:.5em;border:1px solid #BBB">5</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0110</td><td style="padding:.5em;border:1px solid #BBB">6</td><td style="padding:.5em;border:1px solid #BBB">0110</td><td style="padding:.5em;border:1px solid #BBB">6</td><td style="padding:.5em;border:1px solid #BBB">0110</td><td style="padding:.5em;border:1px solid #BBB">6</td></tr><tr><td style="padding:.5em;border:1px solid #BBB">0111</td><td style="padding:.5em;border:1px solid #BBB">7</td><td style="padding:.5em;border:1px solid #BBB">0111</td><td style="padding:.5em;border:1px solid #BBB">7</td><td style="padding:.5em;border:1px solid #BBB">0111</td><td style="padding:.5em;border:1px solid #BBB">7</td></tr></tbody></table><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">可以发现经典有符号数有明显问题：</div><ol class="numbering-main" data-minimap-color="#DDDDDD"><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">1.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">+0 和 -0 的问题，重复编码</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">2.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">做减法不好弄</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-decimal">3.</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">随着二进制数的递增，经典有符号数是递减的，而补码有符号数是递增的溢出后刚好是 0, 换言之没有做到「溢出循环」</div></li></ol><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">第三个尤为重要，因为对某个负数 N 做加 10 操作的时候，实际就是加十次 1 也就是顺着这张表走十次，如果跟二进制数的单调性对不上的话就没法做了，而刚好补码对上了这个顺序因此对一个补码的数字 +1 后得到的二进制数依然是对应的补码，比如上表中，-6(1010) 对其进行 +1 得到 1011 而刚好就是 -5(1011)</div><h1 id="-3782049860" class="std-title --fontTitle"><a href="#-3782049860" class="markdownIt-Anchor">#</a> 实现任意减法 A - B<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">前面讨论的 case 是 A &gt;= B 的情况，现在引入了有符号数后我们就能实现任意减法了</div><div class="std-window mode-windowed"><div class="std-window-menus"><div class="std-window-title"><span></span></div><div class="std-window-btns"><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div></div></div><div style="height:auto" class="std-window-content"><div class="input-num"><div class="input-num-item"><span>右侧输入:</span><div><input value="17"/></div></div><div class="input-num-item"><span>原码</span><div>00010001 ==&gt; 17 (0x11)</div></div><div class="input-num-item"><span>反码</span><div>11101110 ==&gt; 238 (0xee) ==&gt; 255 - 17</div></div><div class="input-num-item"><span>补码</span><div>11101111 ==&gt; 239 (0xef) ==&gt; 256 - 17</div></div></div></div></div><div style="display:none;height:0px;background:#BBB">placeholder</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">下面是输入 A 和 B 并求出 A + B 和 A - B</div><div class="std-window mode-windowed"><div class="std-window-menus"><div class="std-window-title"><span></span></div><div class="std-window-btns"><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div></div></div><div style="height:auto" class="std-window-content"><div class="input-num"><div class="input-num-item"><div><span style="display:inline-block;width:3em">A =</span><input style="margin-right:1em" value="2"/>00000010 ==&gt; 2 (0x2)</div></div><div class="input-num-item"><div><span style="display:inline-block;width:3em">B =</span><input style="margin-right:1em" value="8"/>00001000 ==&gt; 8 (0x8)</div></div><div class="input-num-item"><div><span style="display:inline-block;width:5em">A + B =</span>00001010 = 10</div></div><div class="input-num-item"><div><span style="display:inline-block;width:17em">A - B = A + 补码(B) - 256 =</span>11111010 - 256 = -6 - 256</div></div></div></div></div><div style="display:none;height:0px;background:#BBB">placeholder</div><h1 id="865137154" class="std-title --fontTitle"><a href="#865137154" class="markdownIt-Anchor">#</a> 溢出问题<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">也许你已经注意到了，当 A=127 B=1 的时候，此时 A+B 就会出现溢出问题，最终得到了错误的 -128 作为结果。</div><div class="std-window mode-windowed"><div class="std-window-menus"><div class="std-window-title"><span></span></div><div class="std-window-btns"><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div></div></div><div style="height:auto" class="std-window-content"><div class="input-num"><div class="input-num-item"><div><span style="display:inline-block;width:3em">A =</span><input style="margin-right:1em" value="127"/>01111111 ==&gt; 127 (0x7f)</div></div><div class="input-num-item"><div><span style="display:inline-block;width:3em">B =</span><input style="margin-right:1em" value="1"/>00000001 ==&gt; 1 (0x1)</div></div><div class="input-num-item"><div><span style="display:inline-block;width:5em">A + B =</span>10000000 = -128</div></div><div class="input-num-item"><div><span style="display:inline-block;width:17em">A - B = A + 补码(B) - 256 =</span>01111110 - 256 = 126 - 256</div></div></div></div></div><div style="display:none;height:0px;background:#BBB">placeholder</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">为了应对这个问题, CPU 在状态寄存器里用 Overflow Flag 作为有符号数算术运算的溢出指示</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">以加法为例，可以有枚举出四种 case:</div><ul class="numbering-main" data-minimap-color="#DDDDDD"><li class="numbering-item"><div class="numbering-marker numbering-marker-rect"></div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">A 是正数、B 是正数、结果是负数</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-rect"></div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">A 是正数、B 是负数, 根据结果的正负可细分为两个 case: 8 + (-10) = -2 和 8 + (-7) = 1 因此两者都不会溢出</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-rect"></div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">A 是负数、B 是正数, 加法满足交换律，跟上面一样</div></li><li class="numbering-item"><div class="numbering-marker numbering-marker-rect"></div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">A 是负数、B 是负数、结果是正数</div></li></ul><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">评估上述最后可以归纳出：当 A 和 B 和结果的符号都不相等的时候就是溢出了: </div><div class="std-code"><pre class="prismjs tsx rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token keyword">function</span> <span class="token function">isOverflow</span><span class="token punctuation">(</span>a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">,</span> result<span class="token operator">:</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">01</span>  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>
<span class="line-numbers-rows" style="user-select: none;">02</span>    <span class="token punctuation">(</span>a<span class="token operator">^</span>result<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>b<span class="token operator">^</span>result<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b10000000</span>
<span class="line-numbers-rows" style="user-select: none;">03</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">04</span><span class="token punctuation">}</span></pre></div></div></article></div></div><div class="smcphr rally-page-smcphr"></div><div class="std-box rally-giscus-wrapper default-max-width"><div class="std-box-content "></div></div></div>
<script>window.__INITIAL_STATE__ = {"CategoryApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"BlogApiState":{"loaded":true,"loading":false,"error":null,"dataMap":{"binary-complement-principle":{"type":"tsx","meta":{"id":"binary-complement-principle","title":"二进制补码的数学原理","author":"author","time":"2024-04-29T15:58:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},"tsxDistPath":"./binary-complement-principle/index.blog.js","ssrContent":"<style>.input-num {\n  font-size: 125%;\n  font-family: var(--fontCode);\n\n  padding: 1em;\n\n  & input {\n    display: inline-block;\n    width: 100%;\n    font-family: inherit;\n    font-size: inherit;\n    text-align: center;\n    width: 5em;\n    color: rgb(255 255 255);\n    background: rgb(128 15 15);\n    border: none;\n    outline: none;\n  }\n}\n\n.input-num-item {\n  margin-bottom: 1em;\n  > * {\n    display: inline-block;\n  }\n  > span {\n    margin-right: .5em;\n  }\n}\n</style><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">最近在看一些虚拟机相关的，里面状态寄存器的 Overflow 的规则变化看着非常复杂，看完直接注意力涣散 ... 重新想了下应该是对补码相关原理理解不够深刻，这里手写个「补码 demo」来实现完全同步。</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">备注: 如无特殊说明，本文中出现的整数都是 8 位整数。</div><h1 id=\"algebraic-relations-between-original-inverse-complement\" class=\"std-title --fontTitle\"><a href=\"#algebraic-relations-between-original-inverse-complement\" class=\"markdownIt-Anchor\">#</a> 原码、反码、补码的规则和代数关系<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">原码是将数字表示为二进制形式，反码是将其所有二进制位置反, 补码则是在反码的基础上加 1。具体转换可以看下面这个 demo, 在上面输入一个整数，下方会将其转为「原码」「反码」「补码」三种形式</div><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"><span></span></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div style=\"height:auto\" class=\"std-window-content\"><div class=\"input-num\"><div class=\"input-num-item\"><span>右侧输入:</span><div><input value=\"24\"/></div></div><div class=\"input-num-item\"><span>原码</span><div>00011000 ==&gt; 24 (0x18)</div></div><div class=\"input-num-item\"><span>反码</span><div>11100111 ==&gt; 231 (0xe7) ==&gt; 255 - 24</div></div><div class=\"input-num-item\"><span>补码</span><div>11101000 ==&gt; 232 (0xe8) ==&gt; 256 - 24</div></div></div></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">显然上述变换立马就能注意到，任意数值 N 反码后得到的是 255 - N，而补码是在反码基础上加 1，因此总结如下：</div><ol class=\"numbering-main\" data-minimap-color=\"#DDDDDD\"><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">1.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">原码: N</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">2.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">反码: 255 - N</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">3.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">补码: 255 - N + 1, 即 256 - N</div></li></ol><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">* 其中 255 为 8 位整数的最大数值 (2^n - 1)，对于其他位宽的整数依次类推</div><h1 id=\"A-B\" class=\"std-title --fontTitle\"><a href=\"#A-B\" class=\"markdownIt-Anchor\">#</a> 实现减法 A - B (假设 A &gt;= B)<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">注意到 N 的补码为 256 - N, 因此: </div><div class=\"std-formula-wrapper\" style=\"display:block\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6em;vertical-align:-2.75em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-0.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.75em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">−</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">−</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">256</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">256</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">256</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">256</span></span></span><span style=\"top:-0.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord cjk_fallback\">补码</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">256</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.75em;\"><span></span></span></span></span></span></span></span></span></span></span></span></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">现在来验证一下 87 - 8 = 79:</div><div class=\"std-formula-wrapper\" style=\"display:block\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6em;vertical-align:-2.75em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">87</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">8</span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-0.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.75em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">87</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord cjk_fallback\">补码</span><span class=\"mopen\">(</span><span class=\"mord\">8</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">256</span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">87</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">248</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">256</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">335</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">256</span></span></span><span style=\"top:-0.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">79</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.75em;\"><span></span></span></span></span></span></span></span></span></span></span></span></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">当然你可能还会问这不是还有 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">- 256</div> 么，这个数在二进制上比较特殊，是 0b100000000</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">因此可以考虑 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">335 &amp; 0b11111111</div> 或者 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">335 % 256</div> 的方式来求出最终结果</div><h1 id=\"decimal-complement-extension\" class=\"std-title --fontTitle\"><a href=\"#decimal-complement-extension\" class=\"markdownIt-Anchor\">#</a> 十进制下的补码推广<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">注意到 8 位二进制数 N 的补码是 256 - N，将这个结论推广到十进制则有：4 位十进制数 N 的补码是 1000 - N</div><div class=\"std-formula-wrapper\" style=\"display:block\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6em;vertical-align:-2.75em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">87</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">8</span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-0.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.75em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">87</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord cjk_fallback\">补码</span><span class=\"mopen\">(</span><span class=\"mord\">8</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1000</span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">87</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">992</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1000</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">1079</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1000</span></span></span><span style=\"top:-0.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">79</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.75em;\"><span></span></span></span></span></span></span></span></span></span></span></span></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">对于人脑来说，计算 - 1000 非常容易，因此对于计算机来说计算 - 256 其实也是类似的，很好处理。（甚至都不需要处理，因为前面那个 case 里 335 已经溢出了，剩下的低 8 位就是最终答案了）</div><h1 id=\"signed-number\" class=\"std-title --fontTitle\"><a href=\"#signed-number\" class=\"markdownIt-Anchor\">#</a> 引入有符号数<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">前面讨论的那个 case 是正数减去正数后还是正数的情况，如果要考虑任意加减法的时候就得考虑负数的表达了。</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">有符号数有两种编码方式，一种是直接用最高位作为符号位的表达，如下左表所示；一种则是「负数用补码、正数用原码」的方式进行编码，如下右表所示：</div><table style=\"display:inline-block;font-size:75%;text-align:center;border-collapse:collapse;margin-bottom:1em;font-family:var(--fontArticle);margin-right:2em\"><thead><tr><th style=\"padding:.5em;border:1px solid #BBB\">正数</th><th style=\"padding:.5em;border:1px solid #BBB\">十进制</th><th style=\"padding:.5em;border:1px solid #BBB\">负数</th><th style=\"padding:.5em;border:1px solid #BBB\">十进制</th></tr></thead><tbody><tr><td style=\"padding:.5em;border:1px solid #BBB\">0000</td><td style=\"padding:.5em;border:1px solid #BBB\">0</td><td style=\"padding:.5em;border:1px solid #BBB\">1000</td><td style=\"padding:.5em;border:1px solid #BBB\">-0</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0001</td><td style=\"padding:.5em;border:1px solid #BBB\">1</td><td style=\"padding:.5em;border:1px solid #BBB\">1001</td><td style=\"padding:.5em;border:1px solid #BBB\">-1</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0010</td><td style=\"padding:.5em;border:1px solid #BBB\">2</td><td style=\"padding:.5em;border:1px solid #BBB\">1010</td><td style=\"padding:.5em;border:1px solid #BBB\">-2</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0011</td><td style=\"padding:.5em;border:1px solid #BBB\">3</td><td style=\"padding:.5em;border:1px solid #BBB\">1011</td><td style=\"padding:.5em;border:1px solid #BBB\">-3</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0100</td><td style=\"padding:.5em;border:1px solid #BBB\">4</td><td style=\"padding:.5em;border:1px solid #BBB\">1100</td><td style=\"padding:.5em;border:1px solid #BBB\">-4</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0101</td><td style=\"padding:.5em;border:1px solid #BBB\">5</td><td style=\"padding:.5em;border:1px solid #BBB\">1101</td><td style=\"padding:.5em;border:1px solid #BBB\">-5</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0110</td><td style=\"padding:.5em;border:1px solid #BBB\">6</td><td style=\"padding:.5em;border:1px solid #BBB\">1110</td><td style=\"padding:.5em;border:1px solid #BBB\">-6</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0111</td><td style=\"padding:.5em;border:1px solid #BBB\">7</td><td style=\"padding:.5em;border:1px solid #BBB\">1111</td><td style=\"padding:.5em;border:1px solid #BBB\">-7</td></tr></tbody></table><table style=\"display:inline-block;font-size:75%;text-align:center;border-collapse:collapse;margin-bottom:1em;font-family:var(--fontArticle)\"><thead><tr><th style=\"padding:.5em;border:1px solid #BBB\">原码</th><th style=\"padding:.5em;border:1px solid #BBB\">十进制</th><th style=\"padding:.5em;border:1px solid #BBB\">补码</th><th style=\"padding:.5em;border:1px solid #BBB\">十进制</th></tr></thead><tbody><tr><td style=\"padding:.5em;border:1px solid #BBB\">0000</td><td style=\"padding:.5em;border:1px solid #BBB\">0</td><td style=\"padding:.5em;border:1px solid #BBB\">1111</td><td style=\"padding:.5em;border:1px solid #BBB\">-1</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0001</td><td style=\"padding:.5em;border:1px solid #BBB\">1</td><td style=\"padding:.5em;border:1px solid #BBB\">1110</td><td style=\"padding:.5em;border:1px solid #BBB\">-2</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0010</td><td style=\"padding:.5em;border:1px solid #BBB\">2</td><td style=\"padding:.5em;border:1px solid #BBB\">1101</td><td style=\"padding:.5em;border:1px solid #BBB\">-3</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0011</td><td style=\"padding:.5em;border:1px solid #BBB\">3</td><td style=\"padding:.5em;border:1px solid #BBB\">1100</td><td style=\"padding:.5em;border:1px solid #BBB\">-4</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0100</td><td style=\"padding:.5em;border:1px solid #BBB\">4</td><td style=\"padding:.5em;border:1px solid #BBB\">1011</td><td style=\"padding:.5em;border:1px solid #BBB\">-5</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0101</td><td style=\"padding:.5em;border:1px solid #BBB\">5</td><td style=\"padding:.5em;border:1px solid #BBB\">1010</td><td style=\"padding:.5em;border:1px solid #BBB\">-6</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0110</td><td style=\"padding:.5em;border:1px solid #BBB\">6</td><td style=\"padding:.5em;border:1px solid #BBB\">1001</td><td style=\"padding:.5em;border:1px solid #BBB\">-7</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0111</td><td style=\"padding:.5em;border:1px solid #BBB\">7</td><td style=\"padding:.5em;border:1px solid #BBB\">1000</td><td style=\"padding:.5em;border:1px solid #BBB\">-8</td></tr></tbody></table><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">进一步，如果我们将「1000」当成「起始点」然后进一步做对比就可以得到下面的这张表。</div><table style=\"width:100%;display:block;font-size:75%;text-align:center;border-collapse:collapse;margin-bottom:1em;font-family:var(--fontArticle)\"><thead><tr><th style=\"padding:.5em;border:1px solid #BBB\">补码有符号数</th><th style=\"padding:.5em;border:1px solid #BBB\">十进制</th><th style=\"padding:.5em;border:1px solid #BBB\">无符号数</th><th style=\"padding:.5em;border:1px solid #BBB\">十进制</th><th style=\"padding:.5em;border:1px solid #BBB\">经典有符号数</th><th style=\"padding:.5em;border:1px solid #BBB\">十进制</th></tr></thead><tbody><tr><td style=\"padding:.5em;border:1px solid #BBB\">1000</td><td style=\"padding:.5em;border:1px solid #BBB\">-8</td><td style=\"padding:.5em;border:1px solid #BBB\">1000</td><td style=\"padding:.5em;border:1px solid #BBB\">8</td><td style=\"padding:.5em;border:1px solid #BBB\">1000</td><td style=\"padding:.5em;border:1px solid #BBB\">-0</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">1001</td><td style=\"padding:.5em;border:1px solid #BBB\">-7</td><td style=\"padding:.5em;border:1px solid #BBB\">1001</td><td style=\"padding:.5em;border:1px solid #BBB\">9</td><td style=\"padding:.5em;border:1px solid #BBB\">1001</td><td style=\"padding:.5em;border:1px solid #BBB\">-1</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">1010</td><td style=\"padding:.5em;border:1px solid #BBB\">-6</td><td style=\"padding:.5em;border:1px solid #BBB\">1010</td><td style=\"padding:.5em;border:1px solid #BBB\">10</td><td style=\"padding:.5em;border:1px solid #BBB\">1010</td><td style=\"padding:.5em;border:1px solid #BBB\">-2</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">1011</td><td style=\"padding:.5em;border:1px solid #BBB\">-5</td><td style=\"padding:.5em;border:1px solid #BBB\">1011</td><td style=\"padding:.5em;border:1px solid #BBB\">11</td><td style=\"padding:.5em;border:1px solid #BBB\">1011</td><td style=\"padding:.5em;border:1px solid #BBB\">-3</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">1100</td><td style=\"padding:.5em;border:1px solid #BBB\">-4</td><td style=\"padding:.5em;border:1px solid #BBB\">1100</td><td style=\"padding:.5em;border:1px solid #BBB\">12</td><td style=\"padding:.5em;border:1px solid #BBB\">1100</td><td style=\"padding:.5em;border:1px solid #BBB\">-4</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">1101</td><td style=\"padding:.5em;border:1px solid #BBB\">-3</td><td style=\"padding:.5em;border:1px solid #BBB\">1101</td><td style=\"padding:.5em;border:1px solid #BBB\">13</td><td style=\"padding:.5em;border:1px solid #BBB\">1101</td><td style=\"padding:.5em;border:1px solid #BBB\">-5</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">1110</td><td style=\"padding:.5em;border:1px solid #BBB\">-2</td><td style=\"padding:.5em;border:1px solid #BBB\">1110</td><td style=\"padding:.5em;border:1px solid #BBB\">14</td><td style=\"padding:.5em;border:1px solid #BBB\">1110</td><td style=\"padding:.5em;border:1px solid #BBB\">-6</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">1111</td><td style=\"padding:.5em;border:1px solid #BBB\">-1</td><td style=\"padding:.5em;border:1px solid #BBB\">1111</td><td style=\"padding:.5em;border:1px solid #BBB\">15</td><td style=\"padding:.5em;border:1px solid #BBB\">1111</td><td style=\"padding:.5em;border:1px solid #BBB\">-7</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0000</td><td style=\"padding:.5em;border:1px solid #BBB\">0</td><td style=\"padding:.5em;border:1px solid #BBB\">0000</td><td style=\"padding:.5em;border:1px solid #BBB\">0</td><td style=\"padding:.5em;border:1px solid #BBB\">0000</td><td style=\"padding:.5em;border:1px solid #BBB\">+0</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0001</td><td style=\"padding:.5em;border:1px solid #BBB\">1</td><td style=\"padding:.5em;border:1px solid #BBB\">0001</td><td style=\"padding:.5em;border:1px solid #BBB\">1</td><td style=\"padding:.5em;border:1px solid #BBB\">0001</td><td style=\"padding:.5em;border:1px solid #BBB\">1</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0010</td><td style=\"padding:.5em;border:1px solid #BBB\">2</td><td style=\"padding:.5em;border:1px solid #BBB\">0010</td><td style=\"padding:.5em;border:1px solid #BBB\">2</td><td style=\"padding:.5em;border:1px solid #BBB\">0010</td><td style=\"padding:.5em;border:1px solid #BBB\">2</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0011</td><td style=\"padding:.5em;border:1px solid #BBB\">3</td><td style=\"padding:.5em;border:1px solid #BBB\">0011</td><td style=\"padding:.5em;border:1px solid #BBB\">3</td><td style=\"padding:.5em;border:1px solid #BBB\">0011</td><td style=\"padding:.5em;border:1px solid #BBB\">3</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0100</td><td style=\"padding:.5em;border:1px solid #BBB\">4</td><td style=\"padding:.5em;border:1px solid #BBB\">0100</td><td style=\"padding:.5em;border:1px solid #BBB\">4</td><td style=\"padding:.5em;border:1px solid #BBB\">0100</td><td style=\"padding:.5em;border:1px solid #BBB\">4</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0101</td><td style=\"padding:.5em;border:1px solid #BBB\">5</td><td style=\"padding:.5em;border:1px solid #BBB\">0101</td><td style=\"padding:.5em;border:1px solid #BBB\">5</td><td style=\"padding:.5em;border:1px solid #BBB\">0101</td><td style=\"padding:.5em;border:1px solid #BBB\">5</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0110</td><td style=\"padding:.5em;border:1px solid #BBB\">6</td><td style=\"padding:.5em;border:1px solid #BBB\">0110</td><td style=\"padding:.5em;border:1px solid #BBB\">6</td><td style=\"padding:.5em;border:1px solid #BBB\">0110</td><td style=\"padding:.5em;border:1px solid #BBB\">6</td></tr><tr><td style=\"padding:.5em;border:1px solid #BBB\">0111</td><td style=\"padding:.5em;border:1px solid #BBB\">7</td><td style=\"padding:.5em;border:1px solid #BBB\">0111</td><td style=\"padding:.5em;border:1px solid #BBB\">7</td><td style=\"padding:.5em;border:1px solid #BBB\">0111</td><td style=\"padding:.5em;border:1px solid #BBB\">7</td></tr></tbody></table><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">可以发现经典有符号数有明显问题：</div><ol class=\"numbering-main\" data-minimap-color=\"#DDDDDD\"><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">1.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">+0 和 -0 的问题，重复编码</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">2.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">做减法不好弄</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-decimal\">3.</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">随着二进制数的递增，经典有符号数是递减的，而补码有符号数是递增的溢出后刚好是 0, 换言之没有做到「溢出循环」</div></li></ol><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">第三个尤为重要，因为对某个负数 N 做加 10 操作的时候，实际就是加十次 1 也就是顺着这张表走十次，如果跟二进制数的单调性对不上的话就没法做了，而刚好补码对上了这个顺序因此对一个补码的数字 +1 后得到的二进制数依然是对应的补码，比如上表中，-6(1010) 对其进行 +1 得到 1011 而刚好就是 -5(1011)</div><h1 id=\"-3782049860\" class=\"std-title --fontTitle\"><a href=\"#-3782049860\" class=\"markdownIt-Anchor\">#</a> 实现任意减法 A - B<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">前面讨论的 case 是 A &gt;= B 的情况，现在引入了有符号数后我们就能实现任意减法了</div><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"><span></span></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div style=\"height:auto\" class=\"std-window-content\"><div class=\"input-num\"><div class=\"input-num-item\"><span>右侧输入:</span><div><input value=\"17\"/></div></div><div class=\"input-num-item\"><span>原码</span><div>00010001 ==&gt; 17 (0x11)</div></div><div class=\"input-num-item\"><span>反码</span><div>11101110 ==&gt; 238 (0xee) ==&gt; 255 - 17</div></div><div class=\"input-num-item\"><span>补码</span><div>11101111 ==&gt; 239 (0xef) ==&gt; 256 - 17</div></div></div></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">下面是输入 A 和 B 并求出 A + B 和 A - B</div><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"><span></span></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div style=\"height:auto\" class=\"std-window-content\"><div class=\"input-num\"><div class=\"input-num-item\"><div><span style=\"display:inline-block;width:3em\">A =</span><input style=\"margin-right:1em\" value=\"2\"/>00000010 ==&gt; 2 (0x2)</div></div><div class=\"input-num-item\"><div><span style=\"display:inline-block;width:3em\">B =</span><input style=\"margin-right:1em\" value=\"8\"/>00001000 ==&gt; 8 (0x8)</div></div><div class=\"input-num-item\"><div><span style=\"display:inline-block;width:5em\">A + B =</span>00001010 = 10</div></div><div class=\"input-num-item\"><div><span style=\"display:inline-block;width:17em\">A - B = A + 补码(B) - 256 =</span>11111010 - 256 = -6 - 256</div></div></div></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div><h1 id=\"865137154\" class=\"std-title --fontTitle\"><a href=\"#865137154\" class=\"markdownIt-Anchor\">#</a> 溢出问题<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">也许你已经注意到了，当 A=127 B=1 的时候，此时 A+B 就会出现溢出问题，最终得到了错误的 -128 作为结果。</div><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"><span></span></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div style=\"height:auto\" class=\"std-window-content\"><div class=\"input-num\"><div class=\"input-num-item\"><div><span style=\"display:inline-block;width:3em\">A =</span><input style=\"margin-right:1em\" value=\"127\"/>01111111 ==&gt; 127 (0x7f)</div></div><div class=\"input-num-item\"><div><span style=\"display:inline-block;width:3em\">B =</span><input style=\"margin-right:1em\" value=\"1\"/>00000001 ==&gt; 1 (0x1)</div></div><div class=\"input-num-item\"><div><span style=\"display:inline-block;width:5em\">A + B =</span>10000000 = -128</div></div><div class=\"input-num-item\"><div><span style=\"display:inline-block;width:17em\">A - B = A + 补码(B) - 256 =</span>01111110 - 256 = 126 - 256</div></div></div></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">为了应对这个问题, CPU 在状态寄存器里用 Overflow Flag 作为有符号数算术运算的溢出指示</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">以加法为例，可以有枚举出四种 case:</div><ul class=\"numbering-main\" data-minimap-color=\"#DDDDDD\"><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-rect\"></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">A 是正数、B 是正数、结果是负数</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-rect\"></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">A 是正数、B 是负数, 根据结果的正负可细分为两个 case: 8 + (-10) = -2 和 8 + (-7) = 1 因此两者都不会溢出</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-rect\"></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">A 是负数、B 是正数, 加法满足交换律，跟上面一样</div></li><li class=\"numbering-item\"><div class=\"numbering-marker numbering-marker-rect\"></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">A 是负数、B 是负数、结果是正数</div></li></ul><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">评估上述最后可以归纳出：当 A 和 B 和结果的符号都不相等的时候就是溢出了: </div><div class=\"std-code\"><pre class=\"prismjs tsx rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token keyword\">function</span> <span class=\"token function\">isOverflow</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span> b<span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span> result<span class=\"token operator\">:</span> number<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span>  <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>    <span class=\"token punctuation\">(</span>a<span class=\"token operator\">^</span>result<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span>b<span class=\"token operator\">^</span>result<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0b10000000</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span><span class=\"token punctuation\">}</span></pre></div>","props":{},"tocStack":[{"id":"algebraic-relations-between-original-inverse-complement","level":1,"text":"原码、反码、补码的规则和代数关系"},{"id":"A-B","level":1,"text":"实现减法 A - B (假设 A >= B)"},{"id":"decimal-complement-extension","level":1,"text":"十进制下的补码推广"},{"id":"signed-number","level":1,"text":"引入有符号数"},{"id":"-3782049860","level":1,"text":"实现任意减法 A - B"},{"id":"865137154","level":1,"text":"溢出问题"}]}}},"HomeApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"TimeLineApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"SettingApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"LaunchpadApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}}}</script>
<!--SCRIPT-->
</body>
</html>
