<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<title>自制解释器 - S 表达式 | Eczn's Home</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,minimal-ui">
<meta name="format-detection" content="telephone=no">

<style id="CSS_VARS"></style>
<script>
(function() {
console.log('INIT CSS VAR');
function loadCSSVars() {
    const j = localStorage.getItem("CSS_VARS_2" /* STORAGE_KEY.CSS_VARS */);
    const initialVars = initialCSSVars();
    if (!j)
        return initialVars;
    try {
        const result = {
            ...initialVars,
            ...JSON.parse(j)
        };
        console.log('loadCSSVars from storage', result);
        return result;
    }
    catch (error) {
        console.error('load css vars with error', error);
        return initialVars;
    }
}
function renderCSSVars(vars, style) {
    const allDefine = Object.keys(vars).map(k => {
        const v = vars[k];
        const cssValue = typeof v === 'number' ? `${v}px` : v;
        return `--${k}:${cssValue};`;
    }).join('\n');
    if (style) {
        style.innerHTML = `:root { ${allDefine} }`;
    }
    else {
        console.error(`style#CSS_VARS NotFound !`);
    }
}
function initialCSSVars() {
    let rem = 16;
    // 移动端
    if (typeof window !== 'undefined' && window.innerWidth <= 500) {
        rem = Number(((window.innerWidth - 20) / 42).toFixed(1));
        console.log('mobile calculated rem =>', rem);
    }
    return {
        rem,
        enableSmallerFont: false,
        displayToc: 'block',
        fontSmcp: 'source serif pro, serif',
        fontCode: 'consolas, Menlo, monospace',
        fontTitle: 'Noto Serif SC, serif',
        fontArticle: 'source serif pro, LXGW WenKai',
        fontSansSerif: 'sans-serif',
    };
}
window.__initialCSSVars = loadCSSVars();
renderCSSVars(__initialCSSVars, document.querySelector('#CSS_VARS'));
})();
</script>

<link rel="icon" href="/favicon.png"><script defer="defer" src="/js/index.c464742b.js"></script><script defer="defer" src="/js/chunk-lib.c90ce4c7.js"></script><link href="/css/index.b0e70e3c588e68d62835.css" rel="stylesheet"><link href="/css/chunk-lib.5c7d4887bb8714b00c54.css" rel="stylesheet"></head>
<body x-apple-data-detectors="none">
<noscript>当前浏览器不支持 JavaScript, 建议使用支持 JavaScript 的浏览器来访问此网站 !</noscript>
<div id="rally-bg" style="opacity:0"></div>
<div id="app"><div class="ball-canvas-container"></div><nav class="nav-main --fontSmcp"><div class="_title default-max-width">Eczn&#x27;s Home</div><div class="smcphr"></div><div class="_links default-max-width"><a class="r-link _link clickable r-link" href="/">Home</a><a class="r-link _link clickable r-link" href="/tl/0/">Timeline</a><a class="r-link _link clickable r-link" href="/cate/all/">Category</a><a class="r-link _link clickable r-link" href="/setting/">Setting</a><a class="r-link _link clickable r-link" href="/launchpad/">Launchpad</a></div></nav><div class="std-box rally-page-content default-max-width"><div id="blog-box" class="std-box-content "><div id="start" class="blog-header-main"><div class="_infos"><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg>2017-05-28</div><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tag" class="svg-inline--fa fa-tag fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg>编程语言</div><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tag" class="svg-inline--fa fa-tag fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg>解释器</div></div><div class="_title --fontTitle">自制解释器 - S 表达式</div></div><article><div class="r-article"><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">好吧 我开坑做解释器了 … 准备做 Q 语言 …  额 …  实现变量、表达式、函数就 OK 了。<br/>
不知道接下来的有没有时间做，现在完成了表达式的解析，接下来应该要完成剩下的 <code>变量</code>、<code>函数</code></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">不要报太大希望，<code>Q-lang</code> 可比 <code>BASIC</code> 糟糕多的多的多 …</div>
<hr class="std-hr"/>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">解释器就是… 可以把一段文本当作 <code>某种语言</code> 解释执行，比如没有 <code>V8</code> 前的 JS 都是用解释器运行的，速度较慢，有了 <code>V8</code> 之后就先编译成中间格式，运行的时候速度块很多。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">既然要做解释器，首先得实现解析 <code>表达式</code></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">表达式的选择有很多种，我钦点了 <code>S-表达式</code> 作为解释器解释的表达式。</div>
<h1 id="什么是-s-表达式" class="std-title --fontTitle"><a target="_blank" href="#什么是-s-表达式" class="markdownIt-Anchor">#</a> 什么是 S-表达式<i data-minimap="Ignore"> ↵ </i></h1>
<ol class="std-list">
<li>S-表达式是一种数据结构表示法 <em>用文本表示一个数据结构</em></li>
<li>S-表达式被大量应用在 <code>Lisp</code> 里面</li>
</ol>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">通过上述的描述你可能还不太清楚，我举例子把。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">比如</div>
<ol class="std-list">
<li>把 <code>1 + 1</code> 写成 <code>(+ 1 1)</code></li>
<li>把 <code>(2 * 5) + 2</code> 写成 <code>(+ (* 2 5) 2)</code></li>
<li>把 <code>1 + ((2 * 5) * (3 * 5))</code> 写成 <code>(+ 1 (* (* 2 5) (* 3 5)))</code></li>
</ol>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这种把 <code>操作符</code> 提前的算式写法就叫做 <code>S-表达式</code></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这里写的解释器只能解释 <code>S-表达式</code></div>
<h1 id="为什么选择-s-表达式" class="std-title --fontTitle"><a target="_blank" href="#为什么选择-s-表达式" class="markdownIt-Anchor">#</a> 为什么选择 S-表达式<i data-minimap="Ignore"> ↵ </i></h1>
<ol class="std-list">
<li>为了更方便的把表达式解析成 AST 因此采取了 S-表达式</li>
<li>受王垠的博文启发才做的，因此采用跟他一样的设计思路</li>
</ol>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">上面提到了 <code>AST</code> 这里得解释一下。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">AST 全名是 <code>抽象语法树</code>，是 Abstract Syntax Tree 的缩写，可以认为它是 S-表达式所对应的数据结构，可以把以字符串显示的 <code>S-表达式</code> 转化成 <code>AST</code> 的过程叫做 <code>Parse</code> ，如图：</div>
<div class="std-img"><img class="std-img-bg r-link" data-minimap="Rect" src="/images/what-ast.jpg" alt="S-Expression =&gt; AST"/><div class="std-img-text">S-Expression =&gt; AST</div></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">其中 非叶子节点（就是黑色斜线的那些节点）称作 <code>子树</code></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">通过遍历这颗树，可以很方便的把全部 <code>子树</code> 的值求出来，也就是求得 S-表达式 的值。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">上述遍历用递归来写就是：</div>
<ol class="std-list">
<li>求当前子树的值</li>
<li>取得 <code>子树</code> 的操作符</li>
<li>取得操作符的左值和右值</li>
<li>如果左值是 <code>子树</code> 那么求左值的值 得到左值 (递归调用第一步)</li>
<li>如果右值是 <code>子树</code> 那么求右值的值 得到右值 (递归调用第一步)</li>
<li>把左值右值应用到操作符上即为当前子树的值</li>
</ol>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">因此求的 <code>(+ 2 (* 3 5))</code> 的过程就是：</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">求 <code>(+ 2 x)</code> 的值，因为 <code>x</code> 是子树 所以求 <code>子树x</code> 的值。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">求 <code>子树x</code> 的值即求 <code>(* 3 5)</code> 的值，因为左值右值都不是子树，所以可求得该子树的值是 15</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">回到 <code>(+ 2 x)</code> 的求值，左值已经求出，是 <code>2</code>，右值刚刚得出是 <code>15</code>，把 <code>2</code> 和 <code>15</code> 应用到 <code>+</code> 上可得结果 <code>17</code></div>
<h1 id="把-s-表达式-解析成数组形式" class="std-title --fontTitle"><a target="_blank" href="#把-s-表达式-解析成数组形式" class="markdownIt-Anchor">#</a> 把 S-表达式 解析成数组形式<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">要得到 AST 首先得把多余的空格去掉，把表达式中的元素抽离出来。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">比如<br/>
<code>(+ 1 1)</code> 应该变成 <code>[&quot;(&quot;, &quot;+&quot;, 1, 1, &quot;)&quot;]</code><br/>
<code>(+ 1 (* 2 3))</code> 应该变成 <code>[&quot;(&quot;, &quot;+&quot;, &quot;1&quot;, &quot;(&quot;, &quot;*&quot;, &quot;2&quot;, &quot;3&quot;, &quot;)&quot;, &quot;)&quot;]</code></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">看起来问题变复杂了，其实不然，因为语义元素分离出来了，我们就可以遍历数组来构造树了。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">以下是我的做法：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">parseToArr</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
<span style="user-select:none" class="line-numbers-rows">01</span>    str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">02</span>        <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#x27; &#x27;</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">03</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e <span class="token operator">!==</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">04</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> its</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">05</span>            <span class="token keyword">let</span> temp <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">06</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token operator">+</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">07</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">08</span>                    <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">09</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">10</span>                    <span class="token comment">// e 可能是 &quot;4))&quot; &quot;-4))&quot; 这种 有带正负 </span>
<span style="user-select:none" class="line-numbers-rows">11</span>                    <span class="token keyword">const</span> _ <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">12</span>                    <span class="token keyword">return</span> <span class="token punctuation">[</span>temp<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">13</span>                <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">14</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">15</span>                <span class="token keyword">return</span> temp<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">16</span>            <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">17</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">18</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">19</span>                <span class="token keyword">return</span> acc<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">20</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">21</span>                acc<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">22</span>                <span class="token keyword">return</span> acc<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">23</span>            <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">24</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">上述不是最佳的做法，最佳的算法我还在考虑。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">以下是简单的测试用例</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">import</span> <span class="token punctuation">{</span> parseToArr <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./parse-to-arr&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">parseToArr</span><span class="token punctuation">(</span><span class="token string">&#x27;(+ 1 1)&#x27;</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">03</span>  <span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">parseToArr</span><span class="token punctuation">(</span><span class="token string">&#x27;(+ (* 2 3) 2)&#x27;</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">04</span>  <span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token function">parseToArr</span><span class="token punctuation">(</span><span class="token string">&#x27;(+ (* 2 3) (+ 1 1))&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">05</span>
<span style="user-select:none" class="line-numbers-rows">06</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;a:&#x27;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">07</span><span class="token comment">// =&gt; a: [&quot;(&quot;, &quot;+&quot;, 1, 1, &quot;)&quot;]</span>
<span style="user-select:none" class="line-numbers-rows">08</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;b:&#x27;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">09</span><span class="token comment">// =&gt; b: [&quot;(&quot;, &quot;+&quot;, &quot;(&quot;, &quot;*&quot;, 2, 3, &quot;)&quot;, 2, &quot;)&quot;]</span>
<span style="user-select:none" class="line-numbers-rows">10</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;c:&#x27;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">11</span><span class="token comment">// =&gt; c: [&quot;(&quot;, &quot;+&quot;, &quot;(&quot;, &quot;*&quot;, 2, 3, &quot;)&quot;, &quot;(&quot;, &quot;+&quot;, 1, 1, &quot;)&quot;, &quot;)&quot;]</span></pre></div>
<div class="std-img"><img class="std-img-bg r-link" data-minimap="Rect" src="/images/parseToArr001.jpg" alt="parseToArr 的测试用例"/><div class="std-img-text">parseToArr 的测试用例</div></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">结果正常 继续。</div>
<h1 id="把数组-parse-成-ast" class="std-title --fontTitle"><a target="_blank" href="#把数组-parse-成-ast" class="markdownIt-Anchor">#</a> 把数组 parse 成 AST<i data-minimap="Ignore"> ↵ </i></h1>
<ol class="std-list">
<li>分析数组，并取出子数组：操作符组、左值组、右值组</li>
<li>如果左值组、右值组都是常数，把他们应用到操作符上即可求得这个数组的值 否则执行下两步</li>
<li>如果左值组是常数，把左值应用到操作符，否则调用第一步来分析左值组并求得左值应用到操作符</li>
<li>如果右值组是常数，把右值应用到操作符，否则调用第一步来分析右值组并求得右值应用到操作符</li>
</ol>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">为了实现操作符到函数的映射，我写了 <code>rules</code> 对象</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">export</span> <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token string-property property">&#x27;+&#x27;</span><span class="token operator">:</span> <span class="token parameter">ap</span> <span class="token operator">=&gt;</span> <span class="token parameter">bp</span> <span class="token operator">=&gt;</span> ap <span class="token operator">+</span> bp<span class="token punctuation">,</span> 
<span style="user-select:none" class="line-numbers-rows">02</span>    <span class="token string-property property">&#x27;-&#x27;</span><span class="token operator">:</span> <span class="token parameter"><span class="token keyword">as</span></span> <span class="token operator">=&gt;</span> <span class="token parameter">bs</span> <span class="token operator">=&gt;</span> <span class="token keyword">as</span> <span class="token operator">-</span> bs<span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token string-property property">&#x27;*&#x27;</span><span class="token operator">:</span> <span class="token parameter">am</span> <span class="token operator">=&gt;</span> <span class="token parameter">bm</span> <span class="token operator">=&gt;</span> am <span class="token operator">*</span> bm<span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">04</span>    <span class="token string-property property">&#x27;/&#x27;</span><span class="token operator">:</span> <span class="token parameter">ad</span> <span class="token operator">=&gt;</span> <span class="token parameter">bd</span> <span class="token operator">=&gt;</span> ad <span class="token operator">/</span> bd
<span style="user-select:none" class="line-numbers-rows">05</span><span class="token punctuation">}</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">下面这段代码用来测试一下上面的 runles:</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">import</span> <span class="token punctuation">{</span> rules <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./rules&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token keyword">const</span> p <span class="token operator">=</span> rules<span class="token punctuation">[</span><span class="token string">&#x27;+&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 柯里化的加法</span>
<span style="user-select:none" class="line-numbers-rows">03</span><span class="token keyword">const</span> s <span class="token operator">=</span> rules<span class="token punctuation">[</span><span class="token string">&#x27;-&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 柯里化的减法</span>
<span style="user-select:none" class="line-numbers-rows">04</span>
<span style="user-select:none" class="line-numbers-rows">05</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">p</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5 + 12 =&gt; 17 </span>
<span style="user-select:none" class="line-numbers-rows">06</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 14 - 3 =&gt; 11</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">然后递归实现 AST 的生成 (parse.js)：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">import</span> <span class="token punctuation">{</span> rules <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./rules&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token comment">// 注意 parse 这里有下划线 </span>
<span style="user-select:none" class="line-numbers-rows">03</span><span class="token comment">// 这段代码暂时用不到 </span>
<span style="user-select:none" class="line-numbers-rows">04</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">_parse</span> <span class="token operator">=</span> <span class="token parameter">arr</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">05</span>    <span class="token keyword">var</span> tree <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span style="user-select:none" class="line-numbers-rows">06</span>      <span class="token punctuation">,</span> <span class="token constant">LR</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span style="user-select:none" class="line-numbers-rows">07</span>      <span class="token punctuation">,</span> posStart <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span style="user-select:none" class="line-numbers-rows">08</span>      <span class="token punctuation">,</span> posEnd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span style="user-select:none" class="line-numbers-rows">09</span>      <span class="token punctuation">,</span> deep <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">10</span>
<span style="user-select:none" class="line-numbers-rows">11</span>    <span class="token comment">// posStart 代表左值括号的开始位置 </span>
<span style="user-select:none" class="line-numbers-rows">12</span>    <span class="token comment">// posEnd 代表右值括号的结束位置 </span>
<span style="user-select:none" class="line-numbers-rows">13</span>    <span class="token comment">// deep 代表括号嵌套的深度 </span>
<span style="user-select:none" class="line-numbers-rows">14</span>    <span class="token comment">// 利用 deep 来判断括号的深度，以此区分出最外层左值 最外层右值 </span>
<span style="user-select:none" class="line-numbers-rows">15</span>    <span class="token comment">// 比如 &quot;(+ 1 (+ 1 (+ 2 3)))&quot; 这里左值是 1 右值是 (+ 1 (+ 2 3)) 利用deep可以区分不同深度的括号 </span>
<span style="user-select:none" class="line-numbers-rows">16</span>    <span class="token comment">// LR 代表左右值 （如果是常数）</span>
<span style="user-select:none" class="line-numbers-rows">17</span>    <span class="token comment">// 比如 (+ 1 2) 的 LR 是 [{ val: 1, idx: 在数组的位置}, {val: 2, idx:在数组的位置}] </span>
<span style="user-select:none" class="line-numbers-rows">18</span>    <span class="token comment">// 如果是 (+ 2 (+ 3 4) LR 是 [{val: 2}, idx: 在数组的位置}] </span>
<span style="user-select:none" class="line-numbers-rows">19</span>
<span style="user-select:none" class="line-numbers-rows">20</span>    arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ch<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">21</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> <span class="token string">&#x27;(&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">22</span>            <span class="token comment">// 加深度 </span>
<span style="user-select:none" class="line-numbers-rows">23</span>            deep <span class="token operator">++</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">24</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>deep <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">25</span>                <span class="token comment">// 如果深度刚刚从 1 跳到现在的 2 </span>
<span style="user-select:none" class="line-numbers-rows">26</span>                posStart<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">27</span>            <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">28</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> <span class="token string">&#x27;)&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">29</span>            <span class="token comment">// 减深度 </span>
<span style="user-select:none" class="line-numbers-rows">30</span>            deep<span class="token operator">--</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">31</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>deep <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">32</span>                <span class="token comment">// 如果深度刚刚从 2 跳到现在的 1  </span>
<span style="user-select:none" class="line-numbers-rows">33</span>                posEnd<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">34</span>            <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">35</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rules<span class="token punctuation">[</span>ch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">36</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>deep <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">37</span>                tree<span class="token punctuation">.</span>o <span class="token operator">=</span> ch<span class="token punctuation">;</span>    
<span style="user-select:none" class="line-numbers-rows">38</span>            <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">39</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">40</span>            <span class="token comment">// 普通的数字 </span>
<span style="user-select:none" class="line-numbers-rows">41</span>            <span class="token comment">// val 是值 pos 是这个值在数组中的位置 </span>
<span style="user-select:none" class="line-numbers-rows">42</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>deep <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token constant">LR</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">43</span>                <span class="token literal-property property">val</span><span class="token operator">:</span> ch<span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">44</span>                <span class="token literal-property property">pos</span><span class="token operator">:</span> idx
<span style="user-select:none" class="line-numbers-rows">45</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">46</span>        <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">47</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">48</span>
<span style="user-select:none" class="line-numbers-rows">49</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LR</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">50</span>        <span class="token comment">// 左右均为表达式</span>
<span style="user-select:none" class="line-numbers-rows">51</span>        tree<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token function">_parse</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>posStart<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> posEnd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">52</span>
<span style="user-select:none" class="line-numbers-rows">53</span>        tree<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token function">_parse</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>posStart<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> posEnd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">54</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LR</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">55</span>        <span class="token comment">// 左边是表达式、右边是数字</span>
<span style="user-select:none" class="line-numbers-rows">56</span>        <span class="token comment">// 或者 </span>
<span style="user-select:none" class="line-numbers-rows">57</span>        <span class="token comment">// 左边是数字、右边是表达式</span>
<span style="user-select:none" class="line-numbers-rows">58</span>        <span class="token keyword">let</span> temp <span class="token operator">=</span> <span class="token constant">LR</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">59</span>        <span class="token keyword">let</span> l <span class="token operator">=</span> posStart<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span style="user-select:none" class="line-numbers-rows">60</span>          <span class="token punctuation">,</span> r <span class="token operator">=</span> posEnd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">61</span>
<span style="user-select:none" class="line-numbers-rows">62</span>        <span class="token comment">// 如果 temp.pos 在 l 的左侧 那么 temp 是左值无误 </span>
<span style="user-select:none" class="line-numbers-rows">63</span>        <span class="token comment">// 如果 temp.pos 在 r 的右侧 那么 temp 是右值无误 </span>
<span style="user-select:none" class="line-numbers-rows">64</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>temp<span class="token punctuation">.</span>pos <span class="token operator">&lt;</span> l<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">65</span>            <span class="token comment">// temp 在左 </span>
<span style="user-select:none" class="line-numbers-rows">66</span>            tree<span class="token punctuation">.</span>a <span class="token operator">=</span> temp<span class="token punctuation">.</span>val<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">67</span>            tree<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token function">_parse</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>posStart<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> posEnd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">68</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>temp<span class="token punctuation">.</span>pos <span class="token operator">&gt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">69</span>            <span class="token comment">// temp 在右 </span>
<span style="user-select:none" class="line-numbers-rows">70</span>            tree<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token function">_parse</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>posStart<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> posEnd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">71</span>            tree<span class="token punctuation">.</span>b <span class="token operator">=</span> temp<span class="token punctuation">.</span>val<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">72</span>        <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">73</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LR</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">74</span>        <span class="token comment">// 左右均为数字 </span>
<span style="user-select:none" class="line-numbers-rows">75</span>        tree<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token constant">LR</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>val<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">76</span>        tree<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token constant">LR</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>val<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">77</span>    <span class="token punctuation">}</span> 
<span style="user-select:none" class="line-numbers-rows">78</span>
<span style="user-select:none" class="line-numbers-rows">79</span>    <span class="token comment">// 调试输出 </span>
<span style="user-select:none" class="line-numbers-rows">80</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;_parse.js:&#x27;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">81</span>
<span style="user-select:none" class="line-numbers-rows">82</span>    <span class="token keyword">return</span> tree<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">83</span><span class="token punctuation">}</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这里我觉得很蛋疼了。。 可能能力不足把。 勉强实现了。 看王垠的代码 很精简，不懂 <code>Scheme</code> 所以看不懂。。。 只能自己慢慢实现 绕了好几个坑才抓到这个方法用于解析 <code>AST</code></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">以下是简单的测试用例 parse-test.js</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">import</span> <span class="token punctuation">{</span> _parse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./parse&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span><span class="token keyword">import</span> <span class="token punctuation">{</span> parseToArr <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./parse-to-arr&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">02</span>
<span style="user-select:none" class="line-numbers-rows">03</span><span class="token comment">// S-表达式 数组 </span>
<span style="user-select:none" class="line-numbers-rows">04</span><span class="token punctuation">[</span><span class="token string">&#x27;(+ 1 2)&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;(+ (+ 1 2) 3)&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;(+ (+ 1 2) (+ 3 4))&#x27;</span><span class="token punctuation">]</span>
<span style="user-select:none" class="line-numbers-rows">05</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>parseToArr<span class="token punctuation">)</span>   <span class="token comment">// 映射成 S-表达式 数组</span>
<span style="user-select:none" class="line-numbers-rows">06</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>_parse<span class="token punctuation">)</span>       <span class="token comment">// 映射成 AST</span>
<span style="user-select:none" class="line-numbers-rows">07</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">AST</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 打印出来 </span>
<span style="user-select:none" class="line-numbers-rows">08</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">AST</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">09</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div>
<div class="std-img"><img class="std-img-bg r-link" data-minimap="Rect" src="/images/s-express-2-ast.png" alt="解析结果"/><div class="std-img-text">解析结果</div></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">其中 (+ (+ 1 2) (+ 3 4)) 的结果是：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">var</span> <span class="token constant">AST</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token string-property property">&quot;o&quot;</span><span class="token operator">:</span><span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">02</span>    <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">03</span>        <span class="token string-property property">&quot;o&quot;</span><span class="token operator">:</span><span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">04</span>        <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">05</span>        <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span><span class="token number">2</span>
<span style="user-select:none" class="line-numbers-rows">06</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">07</span>    <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">08</span>        <span class="token string-property property">&quot;o&quot;</span><span class="token operator">:</span><span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">09</span>        <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
<span style="user-select:none" class="line-numbers-rows">10</span>        <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span><span class="token number">4</span>
<span style="user-select:none" class="line-numbers-rows">11</span>    <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">12</span><span class="token punctuation">}</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">它无疑是一棵树，而且结构也是我们想象中的那样是递归的结构。</div>
<h1 id="递归遍历-ast-求值" class="std-title --fontTitle"><a target="_blank" href="#递归遍历-ast-求值" class="markdownIt-Anchor">#</a> 递归遍历 AST 求值<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">从上面的讨论中可以从以字符串显示的 S-表达式 得到 AST 了，现在只需要遍历 AST 就可以得到结果。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">遍历过程用代码描述很简单：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">import</span> <span class="token punctuation">{</span> rules <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./rules&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">calc</span> <span class="token operator">=</span> <span class="token parameter">tree</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token keyword">let</span> o <span class="token operator">=</span> rules<span class="token punctuation">[</span>tree<span class="token punctuation">.</span>o<span class="token punctuation">]</span>
<span style="user-select:none" class="line-numbers-rows">04</span>      <span class="token punctuation">,</span> a <span class="token operator">=</span> tree<span class="token punctuation">.</span>a
<span style="user-select:none" class="line-numbers-rows">05</span>      <span class="token punctuation">,</span> b <span class="token operator">=</span> tree<span class="token punctuation">.</span>b
<span style="user-select:none" class="line-numbers-rows">06</span>      <span class="token punctuation">,</span> a_is_num <span class="token operator">=</span> <span class="token keyword">typeof</span> a <span class="token operator">===</span> <span class="token string">&#x27;number&#x27;</span>
<span style="user-select:none" class="line-numbers-rows">07</span>      <span class="token punctuation">,</span> b_is_num <span class="token operator">=</span> <span class="token keyword">typeof</span> b <span class="token operator">===</span> <span class="token string">&#x27;number&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">08</span>
<span style="user-select:none" class="line-numbers-rows">09</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a_is_num <span class="token operator">&amp;&amp;</span> b_is_num<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">10</span>        <span class="token comment">// a b 都是数字 说明已到达最深处 </span>
<span style="user-select:none" class="line-numbers-rows">11</span>        <span class="token keyword">return</span> <span class="token function">o</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">12</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>a_is_num <span class="token operator">&amp;&amp;</span> b_is_num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">13</span>        <span class="token comment">// a 是表达式, b 是数字 继续对 a 求值 </span>
<span style="user-select:none" class="line-numbers-rows">14</span>        <span class="token keyword">return</span> <span class="token function">o</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">15</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a_is_num <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>b_is_num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">16</span>        <span class="token comment">// a 是数字, b 是表达式 继续对 b 求值  </span>
<span style="user-select:none" class="line-numbers-rows">17</span>        <span class="token keyword">return</span> <span class="token function">o</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">18</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>a_is_num <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>b_is_num<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">19</span>        <span class="token comment">// a b 都是表达式 都要继续求值 </span>
<span style="user-select:none" class="line-numbers-rows">20</span>        <span class="token keyword">return</span> <span class="token function">o</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">21</span>    <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">22</span><span class="token punctuation">}</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">以下是测试用例</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">import</span> <span class="token punctuation">{</span> _parse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./parse&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span><span class="token keyword">import</span> <span class="token punctuation">{</span> parseToArr <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./parse-to-arr&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token keyword">import</span> <span class="token punctuation">{</span> calc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./calc&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">03</span>
<span style="user-select:none" class="line-numbers-rows">04</span><span class="token punctuation">[</span><span class="token string">&#x27;(+ 1 2)&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;(+ (+ 1 2) 3)&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;(+ (+ 1 2) (+ 3 4))&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">rawCode</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">05</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Do Calc For&#x27;</span><span class="token punctuation">,</span> rawCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">06</span>    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token function">parseToArr</span><span class="token punctuation">(</span>rawCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">07</span>    <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">_parse</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">08</span>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">calc</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">09</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rawCode<span class="token punctuation">,</span> <span class="token string">&#x27;==&gt;&#x27;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">10</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;======&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div>
<div class="std-img"><img class="std-img-bg r-link" data-minimap="Rect" src="/images/calc-result-test.png" alt="执行结果"/><div class="std-img-text">执行结果</div></div> 
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">结果如预期所想</div>
<h1 id="最后的封装" class="std-title --fontTitle"><a target="_blank" href="#最后的封装" class="markdownIt-Anchor">#</a> 最后的封装<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">最后封装一下从字符串到数组再到AST再到值的过程：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">import</span> <span class="token punctuation">{</span> _parse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./parse&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span><span class="token keyword">import</span> <span class="token punctuation">{</span> parseToArr <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./parse-to-arr&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token keyword">import</span> <span class="token punctuation">{</span> calc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./calc&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">03</span>
<span style="user-select:none" class="line-numbers-rows">04</span><span class="token comment">// 注意parse这里没有下划线 </span>
<span style="user-select:none" class="line-numbers-rows">05</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">parse</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token function">_parse</span><span class="token punctuation">(</span><span class="token function">parseToArr</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">06</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Q</span> <span class="token operator">=</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">07</span>
<span style="user-select:none" class="line-numbers-rows">08</span><span class="token comment">// Q(&#x27;(+ 1 1)&#x27;)       ===&gt; 2 </span>
<span style="user-select:none" class="line-numbers-rows">09</span><span class="token comment">// Q(&#x27;(+ 2 (* 2 3))&#x27;) ===&gt; 8</span></pre></div>
<div class="std-img"><img class="std-img-bg r-link" data-minimap="Rect" src="/images/Q-calc-s-expression.png" alt="简单的执行"/><div class="std-img-text">简单的执行</div></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">现在我们得到的 <code>Q</code> 就有点类似于 <code>eval</code> 了，接下来要实现变量、函数等特性，请见下一篇博文。</div>
<hr class="std-hr"/>
<h1 id="live-demo" class="std-title --fontTitle"><a target="_blank" href="#live-demo" class="markdownIt-Anchor">#</a> live demo<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这里我已经完成了代码，请直接运行下面的代码框即可运行。</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./demo.jsx&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span><span class="token comment">// 👇 运行 Run !</span></pre></div>
<details>
<summary>此处为上面这个 demo 的源码，点我展开</summary>
<div class="std-code"><pre class="prismjs jsx rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">Q</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./q&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#x27;react-dom&#x27;</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">03</span>
<span style="user-select:none" class="line-numbers-rows">04</span>window<span class="token punctuation">.</span><span class="token constant">Q</span> <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">05</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Q inited&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">06</span>
<span style="user-select:none" class="line-numbers-rows">07</span><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">08</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span>result<span class="token punctuation">,</span> setResult<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">09</span>
<span style="user-select:none" class="line-numbers-rows">10</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span style="user-select:none" class="line-numbers-rows">11</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
<span style="user-select:none" class="line-numbers-rows">12</span>            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">请在下面的输入框中输入 S 表达式</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
<span style="user-select:none" class="line-numbers-rows">13</span>            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_s-exp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(+ 1 2)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>输入S表达式<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
<span style="user-select:none" class="line-numbers-rows">14</span>            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>to-calc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">15</span>                <span class="token keyword">const</span> $ <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;_s-exp&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">16</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>$<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;error&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">17</span>
<span style="user-select:none" class="line-numbers-rows">18</span>                <span class="token function">setResult</span><span class="token punctuation">(</span><span class="token constant">Q</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;_s-exp&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">19</span>            <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点我开始计算</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
<span style="user-select:none" class="line-numbers-rows">20</span>
<span style="user-select:none" class="line-numbers-rows">21</span>            </span><span class="token punctuation">{</span>result <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">结果为: </span><span class="token punctuation">{</span> result <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text">
<span style="user-select:none" class="line-numbers-rows">22</span>
<span style="user-select:none" class="line-numbers-rows">23</span>            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
<span style="user-select:none" class="line-numbers-rows">24</span>        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">25</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">26</span><span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">27</span>
<span style="user-select:none" class="line-numbers-rows">28</span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;demo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div>
</details>
<!-- -->
<h1 id="links" class="std-title --fontTitle"><a target="_blank" href="#links" class="markdownIt-Anchor">#</a> Links<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC"><a target="_blank" href="http://www.yinwang.org/blog-cn/2012/08/01/interpreter" style="background-color:#e6dff4" class="std-link --fontSansSerif  _line" data-minimap-color="#e6dff4"><span class="std-link-icon r-link" data-src="/get-favicon/www.yinwang.org?h=-439149731" style="background-image:url(&quot;/get-favicon/www.yinwang.org?h=-439149731&quot;)"></span><span class="std-link-txt">王垠 - 怎样写一个解释器</span></a></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC"><a target="_blank" href="https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E8%AA%9E%E6%B3%95%E6%A8%B9" style="background-color:#dcebe1" class="std-link --fontSansSerif  _line" data-minimap-color="#dcebe1"><span class="std-link-icon r-link" data-src="/get-favicon/zh.wikipedia.org?h=11797628163" style="background-image:url(&quot;/get-favicon/zh.wikipedia.org?h=11797628163&quot;)"></span><span class="std-link-txt">Wiki - AST 抽象语法树</span></a></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC"><a target="_blank" href="https://zh.wikipedia.org/wiki/S-%E8%A1%A8%E8%BE%BE%E5%BC%8F" style="background-color:#dcf0e3" class="std-link --fontSansSerif  _line" data-minimap-color="#dcf0e3"><span class="std-link-icon r-link" data-src="/get-favicon/zh.wikipedia.org?h=-4223685117" style="background-image:url(&quot;/get-favicon/zh.wikipedia.org?h=-4223685117&quot;)"></span><span class="std-link-txt">Wiki - S-表达式</span></a></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC"><a target="_blank" href="https://zh.wikipedia.org/wiki/%E8%AA%9E%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8" style="background-color:#e9e9e9" class="std-link --fontSansSerif  _line" data-minimap-color="#e9e9e9"><span class="std-link-icon r-link" data-src="/get-favicon/zh.wikipedia.org?h=14184182901" style="background-image:url(&quot;/get-favicon/zh.wikipedia.org?h=14184182901&quot;)"></span><span class="std-link-txt">Wiki - 语法分析器</span></a></div>
</div></article></div></div><div class="smcphr rally-page-smcphr"></div><div class="std-box rally-giscus-wrapper default-max-width"><div class="std-box-content "></div></div></div>
<script>window.__INITIAL_STATE__ = {"CategoryApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"BlogApiState":{"loaded":true,"loading":false,"error":null,"dataMap":{"4daaa023319471bb6c9693ae5cc8593a":{"type":"markdown","meta":{"title":"自制解释器 - S 表达式","intro":"自制一门比 BASIC 还糟糕的语言 叫做 Q-lang","date":"Sun May 28 2017 22:39:35 GMT+0800 (中国标准时间)","category":"自制解释器","cateIntro":"设计一个解释器","tags":["编程语言","解释器"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"headerText":"S-Expression ?","customCSS":["header { ","font-size: 1rem;","}"],"type":"article","id":"4daaa023319471bb6c9693ae5cc8593a","appTitle":"","appIcon":"","author":"eczn","imgs":[],"time":"2017-05-28T14:39:35.000Z","isDraft":false,"fileDeps":["/images/what-ast.jpg","/images/parseToArr001.jpg","/images/s-express-2-ast.png","/images/calc-result-test.png","/images/Q-calc-s-expression.png"],"wordCount":10103},"nodes":[{"type":"tag","children":[{"type":"text","data":"好吧 我开坑做解释器了 … 准备做 Q 语言 …  额 …  实现变量、表达式、函数就 OK 了。"},{"type":"tag","children":[],"name":"br","attribs":{}},{"type":"text","data":"\n不知道接下来的有没有时间做，现在完成了表达式的解析，接下来应该要完成剩下的 "},{"type":"tag","children":[{"type":"text","data":"变量"}],"name":"code","attribs":{}},{"type":"text","data":"、"},{"type":"tag","children":[{"type":"text","data":"函数"}],"name":"code","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"不要报太大希望，"},{"type":"tag","children":[{"type":"text","data":"Q-lang"}],"name":"code","attribs":{}},{"type":"text","data":" 可比 "},{"type":"tag","children":[{"type":"text","data":"BASIC"}],"name":"code","attribs":{}},{"type":"text","data":" 糟糕多的多的多 …"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"hr","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"解释器就是… 可以把一段文本当作 "},{"type":"tag","children":[{"type":"text","data":"某种语言"}],"name":"code","attribs":{}},{"type":"text","data":" 解释执行，比如没有 "},{"type":"tag","children":[{"type":"text","data":"V8"}],"name":"code","attribs":{}},{"type":"text","data":" 前的 JS 都是用解释器运行的，速度较慢，有了 "},{"type":"tag","children":[{"type":"text","data":"V8"}],"name":"code","attribs":{}},{"type":"text","data":" 之后就先编译成中间格式，运行的时候速度块很多。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"既然要做解释器，首先得实现解析 "},{"type":"tag","children":[{"type":"text","data":"表达式"}],"name":"code","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"表达式的选择有很多种，我钦点了 "},{"type":"tag","children":[{"type":"text","data":"S-表达式"}],"name":"code","attribs":{}},{"type":"text","data":" 作为解释器解释的表达式。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#什么是-s-表达式","className":"markdownIt-Anchor"}},{"type":"text","data":" 什么是 S-表达式"}],"name":"h1","attribs":{"id":"什么是-s-表达式"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"S-表达式是一种数据结构表示法 "},{"type":"tag","children":[{"type":"text","data":"用文本表示一个数据结构"}],"name":"em","attribs":{}}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"S-表达式被大量应用在 "},{"type":"tag","children":[{"type":"text","data":"Lisp"}],"name":"code","attribs":{}},{"type":"text","data":" 里面"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"通过上述的描述你可能还不太清楚，我举例子把。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"比如"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"把 "},{"type":"tag","children":[{"type":"text","data":"1 + 1"}],"name":"code","attribs":{}},{"type":"text","data":" 写成 "},{"type":"tag","children":[{"type":"text","data":"(+ 1 1)"}],"name":"code","attribs":{}}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"把 "},{"type":"tag","children":[{"type":"text","data":"(2 * 5) + 2"}],"name":"code","attribs":{}},{"type":"text","data":" 写成 "},{"type":"tag","children":[{"type":"text","data":"(+ (* 2 5) 2)"}],"name":"code","attribs":{}}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"把 "},{"type":"tag","children":[{"type":"text","data":"1 + ((2 * 5) * (3 * 5))"}],"name":"code","attribs":{}},{"type":"text","data":" 写成 "},{"type":"tag","children":[{"type":"text","data":"(+ 1 (* (* 2 5) (* 3 5)))"}],"name":"code","attribs":{}}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这种把 "},{"type":"tag","children":[{"type":"text","data":"操作符"}],"name":"code","attribs":{}},{"type":"text","data":" 提前的算式写法就叫做 "},{"type":"tag","children":[{"type":"text","data":"S-表达式"}],"name":"code","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这里写的解释器只能解释 "},{"type":"tag","children":[{"type":"text","data":"S-表达式"}],"name":"code","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#为什么选择-s-表达式","className":"markdownIt-Anchor"}},{"type":"text","data":" 为什么选择 S-表达式"}],"name":"h1","attribs":{"id":"为什么选择-s-表达式"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"为了更方便的把表达式解析成 AST 因此采取了 S-表达式"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"受王垠的博文启发才做的，因此采用跟他一样的设计思路"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"上面提到了 "},{"type":"tag","children":[{"type":"text","data":"AST"}],"name":"code","attribs":{}},{"type":"text","data":" 这里得解释一下。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"AST 全名是 "},{"type":"tag","children":[{"type":"text","data":"抽象语法树"}],"name":"code","attribs":{}},{"type":"text","data":"，是 Abstract Syntax Tree 的缩写，可以认为它是 S-表达式所对应的数据结构，可以把以字符串显示的 "},{"type":"tag","children":[{"type":"text","data":"S-表达式"}],"name":"code","attribs":{}},{"type":"text","data":" 转化成 "},{"type":"tag","children":[{"type":"text","data":"AST"}],"name":"code","attribs":{}},{"type":"text","data":" 的过程叫做 "},{"type":"tag","children":[{"type":"text","data":"Parse"}],"name":"code","attribs":{}},{"type":"text","data":" ，如图："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/what-ast.jpg","alt":"S-Expression => AST"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"其中 非叶子节点（就是黑色斜线的那些节点）称作 "},{"type":"tag","children":[{"type":"text","data":"子树"}],"name":"code","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"通过遍历这颗树，可以很方便的把全部 "},{"type":"tag","children":[{"type":"text","data":"子树"}],"name":"code","attribs":{}},{"type":"text","data":" 的值求出来，也就是求得 S-表达式 的值。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"上述遍历用递归来写就是："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"求当前子树的值"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"取得 "},{"type":"tag","children":[{"type":"text","data":"子树"}],"name":"code","attribs":{}},{"type":"text","data":" 的操作符"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"取得操作符的左值和右值"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"如果左值是 "},{"type":"tag","children":[{"type":"text","data":"子树"}],"name":"code","attribs":{}},{"type":"text","data":" 那么求左值的值 得到左值 (递归调用第一步)"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"如果右值是 "},{"type":"tag","children":[{"type":"text","data":"子树"}],"name":"code","attribs":{}},{"type":"text","data":" 那么求右值的值 得到右值 (递归调用第一步)"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"把左值右值应用到操作符上即为当前子树的值"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"因此求的 "},{"type":"tag","children":[{"type":"text","data":"(+ 2 (* 3 5))"}],"name":"code","attribs":{}},{"type":"text","data":" 的过程就是："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"求 "},{"type":"tag","children":[{"type":"text","data":"(+ 2 x)"}],"name":"code","attribs":{}},{"type":"text","data":" 的值，因为 "},{"type":"tag","children":[{"type":"text","data":"x"}],"name":"code","attribs":{}},{"type":"text","data":" 是子树 所以求 "},{"type":"tag","children":[{"type":"text","data":"子树x"}],"name":"code","attribs":{}},{"type":"text","data":" 的值。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"求 "},{"type":"tag","children":[{"type":"text","data":"子树x"}],"name":"code","attribs":{}},{"type":"text","data":" 的值即求 "},{"type":"tag","children":[{"type":"text","data":"(* 3 5)"}],"name":"code","attribs":{}},{"type":"text","data":" 的值，因为左值右值都不是子树，所以可求得该子树的值是 15"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"回到 "},{"type":"tag","children":[{"type":"text","data":"(+ 2 x)"}],"name":"code","attribs":{}},{"type":"text","data":" 的求值，左值已经求出，是 "},{"type":"tag","children":[{"type":"text","data":"2"}],"name":"code","attribs":{}},{"type":"text","data":"，右值刚刚得出是 "},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"code","attribs":{}},{"type":"text","data":"，把 "},{"type":"tag","children":[{"type":"text","data":"2"}],"name":"code","attribs":{}},{"type":"text","data":" 和 "},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"code","attribs":{}},{"type":"text","data":" 应用到 "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"code","attribs":{}},{"type":"text","data":" 上可得结果 "},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"code","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#把-s-表达式-解析成数组形式","className":"markdownIt-Anchor"}},{"type":"text","data":" 把 S-表达式 解析成数组形式"}],"name":"h1","attribs":{"id":"把-s-表达式-解析成数组形式"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"要得到 AST 首先得把多余的空格去掉，把表达式中的元素抽离出来。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"比如"},{"type":"tag","children":[],"name":"br","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"(+ 1 1)"}],"name":"code","attribs":{}},{"type":"text","data":" 应该变成 "},{"type":"tag","children":[{"type":"text","data":"[&quot;(&quot;, &quot;+&quot;, 1, 1, &quot;)&quot;]"}],"name":"code","attribs":{}},{"type":"tag","children":[],"name":"br","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"(+ 1 (* 2 3))"}],"name":"code","attribs":{}},{"type":"text","data":" 应该变成 "},{"type":"tag","children":[{"type":"text","data":"[&quot;(&quot;, &quot;+&quot;, &quot;1&quot;, &quot;(&quot;, &quot;*&quot;, &quot;2&quot;, &quot;3&quot;, &quot;)&quot;, &quot;)&quot;]"}],"name":"code","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"看起来问题变复杂了，其实不然，因为语义元素分离出来了，我们就可以遍历数组来构造树了。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"以下是我的做法："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"export"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parseToArr"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"str"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    str"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"trim"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"split"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"' '"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"filter"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"e"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" e "},{"type":"tag","children":[{"type":"text","data":"!=="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"map"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"e"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" idx"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" its"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" temp "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parseInt"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"e"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"Number"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"isNaN"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":"e"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"Number"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"isNaN"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"temp"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" e"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"split"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                    "},{"type":"tag","children":[{"type":"text","data":"// e 可能是 \"4))\" \"-4))\" 这种 有带正负 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                    "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" _ "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" e"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"replace"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"temp"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"toString"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"split"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"temp"},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"concat"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"_"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" temp"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"reduce"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"acc"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" cur"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"Array"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"isArray"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"cur"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" acc"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"concat"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"cur"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                acc"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"push"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"cur"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" acc"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"23"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"24"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"25"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"上述不是最佳的做法，最佳的算法我还在考虑。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"以下是简单的测试用例"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" parseToArr "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./parse-to-arr'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"var"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" a "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parseToArr"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'(+ 1 1)'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"  "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" b "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parseToArr"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'(+ (* 2 3) 2)'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"  "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" c "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parseToArr"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'(+ (* 2 3) (+ 1 1))'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'a:'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"JSON"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"stringify"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// => a: [\"(\", \"+\", 1, 1, \")\"]"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'b:'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"JSON"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"stringify"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// => b: [\"(\", \"+\", \"(\", \"*\", 2, 3, \")\", 2, \")\"]"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'c:'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"JSON"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"stringify"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"c"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// => c: [\"(\", \"+\", \"(\", \"*\", 2, 3, \")\", \"(\", \"+\", 1, 1, \")\", \")\"]"}],"name":"span","attribs":{"className":"token comment"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/parseToArr001.jpg","alt":"parseToArr 的测试用例"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"结果正常 继续。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#把数组-parse-成-ast","className":"markdownIt-Anchor"}},{"type":"text","data":" 把数组 parse 成 AST"}],"name":"h1","attribs":{"id":"把数组-parse-成-ast"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"分析数组，并取出子数组：操作符组、左值组、右值组"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"如果左值组、右值组都是常数，把他们应用到操作符上即可求得这个数组的值 否则执行下两步"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"如果左值组是常数，把左值应用到操作符，否则调用第一步来分析左值组并求得左值应用到操作符"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"如果右值组是常数，把右值应用到操作符，否则调用第一步来分析右值组并求得右值应用到操作符"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"为了实现操作符到函数的映射，我写了 "},{"type":"tag","children":[{"type":"text","data":"rules"}],"name":"code","attribs":{}},{"type":"text","data":" 对象"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"export"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" rules "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"'+'"}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"ap"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"bp"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" ap "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" bp"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"'-'"}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"as"}],"name":"span","attribs":{"className":"token keyword"}}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"bs"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"as"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"-"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" bs"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"'*'"}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"am"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"bm"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" am "},{"type":"tag","children":[{"type":"text","data":"*"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" bm"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"'/'"}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"ad"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"bd"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" ad "},{"type":"tag","children":[{"type":"text","data":"/"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" bd\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"下面这段代码用来测试一下上面的 runles:"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" rules "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./rules'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" p "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" rules"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'+'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"// 柯里化的加法"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" s "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" rules"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'-'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"// 柯里化的减法"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"5"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"// 5 + 12 => 17 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"s"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"3"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"// 14 - 3 => 11"}],"name":"span","attribs":{"className":"token comment"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"然后递归实现 AST 的生成 (parse.js)："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" rules "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./rules'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// 注意 parse 这里有下划线 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// 这段代码暂时用不到 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"export"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"_parse"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"arr"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"var"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" tree "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" Object"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"create"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"null"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"      "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"LR"}],"name":"span","attribs":{"className":"token constant"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"      "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" posStart "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"      "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" posEnd "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"      "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" deep "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// posStart 代表左值括号的开始位置 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// posEnd 代表右值括号的结束位置 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// deep 代表括号嵌套的深度 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 利用 deep 来判断括号的深度，以此区分出最外层左值 最外层右值 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 比如 \"(+ 1 (+ 1 (+ 2 3)))\" 这里左值是 1 右值是 (+ 1 (+ 2 3)) 利用deep可以区分不同深度的括号 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// LR 代表左右值 （如果是常数）"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 比如 (+ 1 2) 的 LR 是 [{ val: 1, idx: 在数组的位置}, {val: 2, idx:在数组的位置}] "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 如果是 (+ 2 (+ 3 4) LR 是 [{val: 2}, idx: 在数组的位置}] "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    arr"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"forEach"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"ch"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" idx"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"ch "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'('"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 加深度 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"23"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            deep "},{"type":"tag","children":[{"type":"text","data":"++"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"24"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"deep "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"2"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"25"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"// 如果深度刚刚从 1 跳到现在的 2 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"26"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                posStart"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"push"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"idx"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"27"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"28"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"ch "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"')'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"29"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 减深度 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"30"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            deep"},{"type":"tag","children":[{"type":"text","data":"--"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"31"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"deep "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"32"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"// 如果深度刚刚从 2 跳到现在的 1  "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"33"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                posEnd"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"push"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"idx"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"34"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"35"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"rules"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"ch"},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"36"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"deep "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"37"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"o "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" ch"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"    \n"},{"type":"tag","children":[{"type":"text","data":"38"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"39"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"40"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 普通的数字 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"41"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// val 是值 pos 是这个值在数组中的位置 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"42"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"deep "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"LR"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"push"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"43"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"val"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" ch"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"44"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"pos"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" idx\n"},{"type":"tag","children":[{"type":"text","data":"45"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"46"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"47"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"48"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"49"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"LR"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"length "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"50"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 左右均为表达式"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"51"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"_parse"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"arr"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"slice"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"posStart"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" posEnd"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"52"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"53"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"_parse"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"arr"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"slice"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"posStart"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" posEnd"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"54"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"LR"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"length "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"55"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 左边是表达式、右边是数字"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"56"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 或者 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"57"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 左边是数字、右边是表达式"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"58"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" temp "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"LR"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"pop"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"59"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" l "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" posStart"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"60"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"          "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" r "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" posEnd"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"61"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"62"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 如果 temp.pos 在 l 的左侧 那么 temp 是左值无误 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"63"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 如果 temp.pos 在 r 的右侧 那么 temp 是右值无误 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"64"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"temp"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"pos "},{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" l"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"65"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// temp 在左 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"66"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" temp"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"val"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"67"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"_parse"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"arr"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"slice"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"posStart"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" posEnd"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"68"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"temp"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"pos "},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" r"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"69"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// temp 在右 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"70"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"_parse"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"arr"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"slice"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"posStart"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" posEnd"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"71"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" temp"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"val"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"72"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"73"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"LR"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"length "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"2"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"74"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 左右均为数字 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"75"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"LR"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"val"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"76"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"LR"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"val"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"77"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"78"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"79"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 调试输出 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"80"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'_parse.js:'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"JSON"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"stringify"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"arr"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"81"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"82"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" tree"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"83"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这里我觉得很蛋疼了。。 可能能力不足把。 勉强实现了。 看王垠的代码 很精简，不懂 "},{"type":"tag","children":[{"type":"text","data":"Scheme"}],"name":"code","attribs":{}},{"type":"text","data":" 所以看不懂。。。 只能自己慢慢实现 绕了好几个坑才抓到这个方法用于解析 "},{"type":"tag","children":[{"type":"text","data":"AST"}],"name":"code","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"以下是简单的测试用例 parse-test.js"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" _parse "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./parse'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" parseToArr "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./parse-to-arr'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// S-表达式 数组 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'(+ 1 2)'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'(+ (+ 1 2) 3)'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'(+ (+ 1 2) (+ 3 4))'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"map"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"parseToArr"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"   "},{"type":"tag","children":[{"type":"text","data":"// 映射成 S-表达式 数组"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"map"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"_parse"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"       "},{"type":"tag","children":[{"type":"text","data":"// 映射成 AST"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"forEach"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"AST"}],"name":"span","attribs":{"className":"token constant"}}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"  "},{"type":"tag","children":[{"type":"text","data":"// 打印出来 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"AST"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/s-express-2-ast.png","alt":"解析结果"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"其中 (+ (+ 1 2) (+ 3 4)) 的结果是："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"var"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"AST"}],"name":"span","attribs":{"className":"token constant"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"\"o\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"\"+\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"\"a\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"\"o\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"\"+\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"\"a\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"\"b\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"2"}],"name":"span","attribs":{"className":"token number"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"\"b\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"\"o\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"\"+\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"\"a\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"3"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"\"b\""}],"name":"span","attribs":{"className":"token string-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"4"}],"name":"span","attribs":{"className":"token number"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"它无疑是一棵树，而且结构也是我们想象中的那样是递归的结构。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#递归遍历-ast-求值","className":"markdownIt-Anchor"}},{"type":"text","data":" 递归遍历 AST 求值"}],"name":"h1","attribs":{"id":"递归遍历-ast-求值"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"从上面的讨论中可以从以字符串显示的 S-表达式 得到 AST 了，现在只需要遍历 AST 就可以得到结果。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"遍历过程用代码描述很简单："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" rules "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./rules'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"export"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"calc"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"tree"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" o "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" rules"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"o"},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"      "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" a "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"      "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" b "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" tree"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"      "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" a_is_num "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"typeof"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" a "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'number'"}],"name":"span","attribs":{"className":"token string"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"      "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" b_is_num "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"typeof"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" b "},{"type":"tag","children":[{"type":"text","data":"==="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'number'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a_is_num "},{"type":"tag","children":[{"type":"text","data":"&amp;&amp;"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" b_is_num"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// a b 都是数字 说明已到达最深处 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"o"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"!"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":"a_is_num "},{"type":"tag","children":[{"type":"text","data":"&amp;&amp;"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" b_is_num"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// a 是表达式, b 是数字 继续对 a 求值 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"o"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"calc"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a_is_num "},{"type":"tag","children":[{"type":"text","data":"&amp;&amp;"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"!"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":"b_is_num"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// a 是数字, b 是表达式 继续对 b 求值  "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"o"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"calc"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"!"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":"a_is_num "},{"type":"tag","children":[{"type":"text","data":"&amp;&amp;"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"!"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":"b_is_num"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// a b 都是表达式 都要继续求值 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"o"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"calc"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"a"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"calc"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"b"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"以下是测试用例"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" _parse "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./parse'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" parseToArr "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./parse-to-arr'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" calc "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./calc'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'(+ 1 2)'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'(+ (+ 1 2) 3)'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'(+ (+ 1 2) (+ 3 4))'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"forEach"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"rawCode"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'Do Calc For'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" rawCode"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" arr "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parseToArr"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"rawCode"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" ast "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"_parse"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"arr"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" result "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"calc"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"ast"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"rawCode"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'==>'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" result"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'======'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/calc-result-test.png","alt":"执行结果"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"结果如预期所想"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#最后的封装","className":"markdownIt-Anchor"}},{"type":"text","data":" 最后的封装"}],"name":"h1","attribs":{"id":"最后的封装"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"最后封装一下从字符串到数组再到AST再到值的过程："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" _parse "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./parse'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" parseToArr "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./parse-to-arr'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" calc "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./calc'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// 注意parse这里没有下划线 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"export"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parse"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"str"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"_parse"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"parseToArr"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"str"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"export"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"str"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"calc"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"parse"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"str"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// Q('(+ 1 1)')       ===> 2 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// Q('(+ 2 (* 2 3))') ===> 8"}],"name":"span","attribs":{"className":"token comment"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/Q-calc-s-expression.png","alt":"简单的执行"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"现在我们得到的 "},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"code","attribs":{}},{"type":"text","data":" 就有点类似于 "},{"type":"tag","children":[{"type":"text","data":"eval"}],"name":"code","attribs":{}},{"type":"text","data":" 了，接下来要实现变量、函数等特性，请见下一篇博文。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"hr","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#live-demo","className":"markdownIt-Anchor"}},{"type":"text","data":" live demo"}],"name":"h1","attribs":{"id":"live-demo"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这里我已经完成了代码，请直接运行下面的代码框即可运行。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'./demo.jsx'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// 👇 运行 Run !"}],"name":"span","attribs":{"className":"token comment"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"此处为上面这个 demo 的源码，点我展开"}],"name":"summary","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token constant"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'./q'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" React "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'react'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"import"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" ReactDOM "},{"type":"tag","children":[{"type":"text","data":"from"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'react-dom'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"window"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token constant"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'Q inited'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"App"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"result"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" setResult"},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" React"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"useState"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":"请在下面的输入框中输入 S 表达式"}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"input"}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"id"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"_s-exp"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"defaultValue"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"(+ 1 2)"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"type"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"text"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"placeholder"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"输入S表达式"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"/>"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"button"}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"id"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"to-calc"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"onClick"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token script-punctuation punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" $ "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" document"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"getElementById"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'_s-exp'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"!"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":"$"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'error'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"setResult"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"document"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"getElementById"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'_s-exp'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"value"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token script language-javascript"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":"点我开始计算"}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"button"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"result "},{"type":"tag","children":[{"type":"text","data":"?"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":"结果为: "}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" result "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"null"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"23"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"br"}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"/>"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"24"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "}],"name":"span","attribs":{"className":"token plain-text"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"25"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"26"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"27"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"28"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"ReactDOM"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"render"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"App"}],"name":"span","attribs":{"className":"token class-name"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"/>"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" document"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"getElementById"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'demo'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs jsx rally-runner  "}},{"type":"text","data":"\n"}],"name":"details","attribs":{}},{"type":"text","data":"\n"},{"type":"comment","data":" 当然我已经把 Q 注入到当前页面了，所以在 `Run!` 之后你也可以打开浏览器 F12 输入 `Q('(+ 1 1)')` 来使用它。  "},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#links","className":"markdownIt-Anchor"}},{"type":"text","data":" Links"}],"name":"h1","attribs":{"id":"links"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"王垠 - 怎样写一个解释器"}],"name":"a","attribs":{"href":"http://www.yinwang.org/blog-cn/2012/08/01/interpreter"}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"Wiki - AST 抽象语法树"}],"name":"a","attribs":{"href":"https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E8%AA%9E%E6%B3%95%E6%A8%B9"}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"Wiki - S-表达式"}],"name":"a","attribs":{"href":"https://zh.wikipedia.org/wiki/S-%E8%A1%A8%E8%BE%BE%E5%BC%8F"}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"Wiki - 语法分析器"}],"name":"a","attribs":{"href":"https://zh.wikipedia.org/wiki/%E8%AA%9E%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8"}}],"name":"p","attribs":{}},{"type":"text","data":"\n"}],"rawContent":""}}},"HomeApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"TimeLineApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"SettingApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"LaunchpadApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}}}</script>
<!--SCRIPT-->
</body>
</html>
