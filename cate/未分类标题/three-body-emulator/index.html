<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<title>未分类标题 | 三体运动模拟器 | Eczn's Home</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,minimal-ui">
<meta name="format-detection" content="telephone=no">

<style id="CSS_VARS"></style>
<script>
(function() {
console.log('INIT CSS VAR');
function loadCSSVars() {
    const j = localStorage.getItem("CSS_VARS_2" /* STORAGE_KEY.CSS_VARS */);
    const initialVars = initialCSSVars();
    if (!j)
        return initialVars;
    try {
        const result = {
            ...initialVars,
            ...JSON.parse(j)
        };
        console.log('loadCSSVars from storage', result);
        return result;
    }
    catch (error) {
        console.error('load css vars with error', error);
        return initialVars;
    }
}
function renderCSSVars(vars, style) {
    const allDefine = Object.keys(vars).map(k => {
        const v = vars[k];
        const cssValue = typeof v === 'number' ? `${v}px` : v;
        return `--${k}:${cssValue};`;
    }).join('\n');
    if (style) {
        style.innerHTML = `:root { ${allDefine} }`;
    }
    else {
        console.error(`style#CSS_VARS NotFound !`);
    }
}
function initialCSSVars() {
    let rem = 16;
    // 移动端
    if (typeof window !== 'undefined' && window.innerWidth <= 500) {
        rem = Number(((window.innerWidth - 20) / 42).toFixed(1));
        console.log('mobile calculated rem =>', rem);
    }
    return {
        rem,
        enableSmallerFont: false,
        displayToc: 'block',
        fontSmcp: 'source serif pro, serif',
        fontCode: 'consolas, Menlo, monospace',
        fontTitle: 'Noto Serif SC, serif',
        fontArticle: 'source serif pro, LXGW WenKai',
        fontSansSerif: 'sans-serif',
    };
}
window.__initialCSSVars = loadCSSVars();
renderCSSVars(__initialCSSVars, document.querySelector('#CSS_VARS'));
})();
</script>

<link rel="icon" href="/favicon.png"><script defer="defer" src="/js/index.a1ff11e6.js"></script><script defer="defer" src="/js/chunk-lib.c90ce4c7.js"></script><link href="/css/index.b0e70e3c588e68d62835.css" rel="stylesheet"><link href="/css/chunk-lib.5c7d4887bb8714b00c54.css" rel="stylesheet"></head>
<body x-apple-data-detectors="none">
<noscript>当前浏览器不支持 JavaScript, 建议使用支持 JavaScript 的浏览器来访问此网站 !</noscript>
<div id="rally-bg" style="opacity:0"></div>
<div id="app"><div class="ball-canvas-container"></div><nav class="nav-main --fontSmcp"><div class="_title default-max-width">Eczn&#x27;s Home</div><div class="smcphr"></div><div class="_links default-max-width"><a class="r-link _link clickable r-link" href="/">Home</a><a class="r-link _link clickable r-link" href="/tl/0/">Timeline</a><a class="r-link _link clickable r-link" href="/cate/all/">Category</a><a class="r-link _link clickable r-link" href="/setting/">Setting</a><a class="r-link _link clickable r-link" href="/launchpad/">Launchpad</a></div></nav><div class="std-box category-main category-detail default-max-width"><div class="std-box-content "><div class="_cate-header"><div class="_blog-links"><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/test-tsx-article-for-new-version/"><span class="_nth">#<!-- -->0</span>新版博客测试文章 (.tsx)</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/62ca7f2093a59fcbab91ce9ad5fd9c37/"><span class="_nth">#<!-- -->1</span>Markdown 快速上手</a><a class="r-link _blog-link --fontTitle _active" href="/cate/未分类标题/three-body-emulator/"><span class="_nth">#<!-- -->2</span>三体运动模拟器</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/is-esm-robust-enough-in-broswer/"><span class="_nth">#<!-- -->3</span>浏览器内的 ESM 是否已足够强大</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/white-noise-webgl/"><span class="_nth">#<!-- -->4</span>从白噪声开始学习 WebGL</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/the-adt-in-ts/"><span class="_nth">#<!-- -->5</span>TypeScript 里的 ADT</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/hello-css-vars/"><span class="_nth">#<!-- -->6</span>Hello CSS 变量</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/css-matrix3d-calc/"><span class="_nth">#<!-- -->7</span>CSS Matrix3D 中的矩阵运算</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/latex-notes/"><span class="_nth">#<!-- -->8</span>LaTeX 笔记</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/ipod-spin-gesture/"><span class="_nth">#<!-- -->9</span>iPod 转盘手势</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/app-pinch/"><span class="_nth">#<!-- -->10</span>Pinch 捏放手势</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/old-demos/"><span class="_nth">#<!-- -->11</span>早期 DEMO 集</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/binary-complement-principle/"><span class="_nth">#<!-- -->12</span>二进制补码的数学原理</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/moonbit-start/"><span class="_nth">#<!-- -->13</span>Moonbit, 启动</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/parser-combinator/"><span class="_nth">#<!-- -->14</span>Parser Combinator</a><a class="r-link _blog-link --fontTitle" href="/cate/未分类标题/v8-asm-detail-of-inline-caches/"><span class="_nth">#<!-- -->15</span>V8 Inline Caches 优化及其汇编细节</a></div><div class="_cate-title --fontTitle">分类「 <!-- -->未分类标题<!-- --> 」</div></div><div><div id="start" class="blog-header-main"><div class="_infos"><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg>2021-06-16</div></div><div class="_title --fontTitle">三体运动模拟器</div></div><article><div class="toc"><div class="toc-item _active" style="padding-left:0em"><a href="#point" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>质点</a></div><div class="toc-item" style="padding-left:0em"><a href="#position" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>速度对坐标, 引力对速度</a></div><div class="toc-item" style="padding-left:0em"><a href="#draw-and-multi-points" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>绘图控制 &amp; 多质点</a></div><div class="toc-item" style="padding-left:0em"><a href="#playground" data-minimap-color="#CCCCCC"><span class="_hashtag">#</span>playground</a></div><div class="_index --fontSmcp" data-minimap="Ignore">Indexes</div><div class="smcphr"></div></div><div class="r-article"><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">三体运动没有解析解，这种遵循物理定律的混沌运动很适合用来做屏保，如:</div><div class="std-window mode-windowed"><div class="std-window-menus"><div class="std-window-title"><span></span></div><div class="std-window-btns"><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div></div></div><div style="height:300px" class="std-window-content"><canvas style="display:block;margin:0 auto" width="320" height="300"></canvas></div></div><div style="display:none;height:0px;background:#BBB">placeholder</div><h1 id="point" class="std-title --fontTitle"><a href="#point" class="markdownIt-Anchor">#</a> 质点<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">将星球运动简化为质点，有二维坐标及速度向量，最后加上其质量:</div><div class="std-code"><pre class="prismjs tsx rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token comment">// point-static.ts</span>
<span class="line-numbers-rows" style="user-select: none;">01</span><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">PointStatic</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">02</span>  <span class="token comment">/** 坐标 x */</span>
<span class="line-numbers-rows" style="user-select: none;">03</span>  x<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">04</span>  <span class="token comment">/** 坐标 y */</span>
<span class="line-numbers-rows" style="user-select: none;">05</span>  y<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>  <span class="token comment">/** 速度向量 x */</span>
<span class="line-numbers-rows" style="user-select: none;">07</span>  dx<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>  <span class="token comment">/** 速度向量 y */</span>
<span class="line-numbers-rows" style="user-select: none;">09</span>  dy<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">10</span>  <span class="token comment">/** 质量 */</span>
<span class="line-numbers-rows" style="user-select: none;">11</span>  m<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">12</span><span class="token punctuation">}</span></pre></div><h1 id="position" class="std-title --fontTitle"><a href="#position" class="markdownIt-Anchor">#</a> 速度对坐标, 引力对速度<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">速度对坐标的影响比较容易处理将上面的定义的 PointStatic 结构进行 (p.x += p.dx) 即可, 而引力对速度的影响, 则要计算加速度 (f = ma) 以及展开后在二维上的分量进行累加才行</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这里有个情况需要注意，因为是质点，所以距离近的时候力会瞬间增大到无穷导致 number 溢出或者除 0 出现的 NaN, 所以要做最小距离处理</div><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">具体实现如下</div><div class="std-code"><pre class="prismjs tsx rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token comment">// point.ts</span>
<span class="line-numbers-rows" style="user-select: none;">01</span><span class="token keyword">import</span> <span class="token punctuation">{</span> PointStatic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./point-static'</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">02</span>
<span class="line-numbers-rows" style="user-select: none;">03</span><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token keyword">implements</span> <span class="token class-name">PointStatic</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">04</span>  <span class="token keyword">public</span> x<span class="token operator">!</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">05</span>  <span class="token keyword">public</span> y<span class="token operator">!</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>  <span class="token keyword">public</span> dx<span class="token operator">!</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">07</span>  <span class="token keyword">public</span> dy<span class="token operator">!</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>  <span class="token keyword">public</span> m<span class="token operator">!</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">09</span>
<span class="line-numbers-rows" style="user-select: none;">10</span>  <span class="token keyword">public</span> <span class="token function">constructor</span><span class="token punctuation">(</span>data<span class="token operator">:</span> PointStatic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">11</span>    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">12</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">13</span>
<span class="line-numbers-rows" style="user-select: none;">14</span>  <span class="token comment">/** 当前速度对坐标的影响 */</span>
<span class="line-numbers-rows" style="user-select: none;">15</span>  <span class="token keyword">public</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">16</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dx<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">17</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dy<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">18</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">19</span>
<span class="line-numbers-rows" style="user-select: none;">20</span>  <span class="token comment">/**
<span class="line-numbers-rows" style="user-select: none;">21</span>   * p 和 this 间的引力对 this 速度影响
<span class="line-numbers-rows" style="user-select: none;">22</span>   * @param p 其他点
<span class="line-numbers-rows" style="user-select: none;">23</span>   * @param g 引力常数
<span class="line-numbers-rows" style="user-select: none;">24</span>   */</span>
<span class="line-numbers-rows" style="user-select: none;">25</span>  <span class="token keyword">public</span> <span class="token function">effect</span><span class="token punctuation">(</span>p<span class="token operator">:</span> Point<span class="token punctuation">,</span> g<span class="token operator">:</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">26</span>    <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">27</span>
<span class="line-numbers-rows" style="user-select: none;">28</span>    <span class="token keyword">const</span> distanceX <span class="token operator">=</span> p<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">29</span>    <span class="token keyword">const</span> distanceY <span class="token operator">=</span> p<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">30</span>
<span class="line-numbers-rows" style="user-select: none;">31</span>    <span class="token comment">// f = ma 展开后可以得到 a = g * p.m / (r * r)</span>
<span class="line-numbers-rows" style="user-select: none;">32</span>    <span class="token comment">// 这个 a 是带方向的，它的方向跟 this -> p 练成的线的方向是一致的</span>
<span class="line-numbers-rows" style="user-select: none;">33</span>    <span class="token comment">// 根据这个来做 x y 方向的分量拆解得到 k 最后得到各分量 ax ay</span>
<span class="line-numbers-rows" style="user-select: none;">34</span>    <span class="token keyword">const</span> k <span class="token operator">=</span> g <span class="token operator">*</span> p<span class="token punctuation">.</span>m <span class="token operator">/</span> <span class="token punctuation">(</span>r <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">35</span>    <span class="token keyword">const</span> ax <span class="token operator">=</span> k <span class="token operator">*</span> distanceX<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">36</span>    <span class="token keyword">const</span> ay <span class="token operator">=</span> k <span class="token operator">*</span> distanceY<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">37</span>
<span class="line-numbers-rows" style="user-select: none;">38</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>dx <span class="token operator">+=</span> ax<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">39</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>dy <span class="token operator">+=</span> ay<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">40</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">41</span>
<span class="line-numbers-rows" style="user-select: none;">42</span>  <span class="token comment">/** 求与 p1 的距离 */</span>
<span class="line-numbers-rows" style="user-select: none;">43</span>  <span class="token keyword">private</span> <span class="token function">distance</span><span class="token punctuation">(</span>p1<span class="token operator">:</span> Point<span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">44</span>    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">-</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">45</span>    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">-</span> p1<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">46</span>    <span class="token keyword">const</span> yy <span class="token operator">=</span> y <span class="token operator">*</span> y<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">47</span>    <span class="token keyword">const</span> xx <span class="token operator">=</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">48</span>    <span class="token keyword">const</span> rr <span class="token operator">=</span> yy <span class="token operator">+</span> xx<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">49</span>    <span class="token comment">// 最小距离</span>
<span class="line-numbers-rows" style="user-select: none;">50</span>    <span class="token keyword">const</span> min <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">51</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>rr <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>min <span class="token operator">*</span> min<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">52</span>    <span class="token keyword">const</span> r <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>rr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">53</span>    <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">54</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">55</span>
<span class="line-numbers-rows" style="user-select: none;">56</span>  <span class="token comment">/** 根据 m 给一个合适的半径 方便绘图 */</span>
<span class="line-numbers-rows" style="user-select: none;">57</span>  <span class="token keyword">public</span> <span class="token function">getPointRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">58</span>    <span class="token keyword">const</span> r <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">59</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 最小值 免得太小了看不到了</span>
<span class="line-numbers-rows" style="user-select: none;">60</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">>=</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">// 免得太大了</span>
<span class="line-numbers-rows" style="user-select: none;">61</span>    <span class="token keyword">return</span> r <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">62</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">63</span><span class="token punctuation">}</span></pre></div><h1 id="draw-and-multi-points" class="std-title --fontTitle"><a href="#draw-and-multi-points" class="markdownIt-Anchor">#</a> 绘图控制 &amp; 多质点<i data-minimap="Ignore"> ↵ </i></h1><div class="std-code"><pre class="prismjs tsx rally-runner  " ><span class="line-numbers-rows" style="user-select: none;">00</span><span class="token comment">// gravity.tsx</span>
<span class="line-numbers-rows" style="user-select: none;">01</span><span class="token keyword">import</span> <span class="token punctuation">{</span> PointStatic <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./point-static'</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">02</span><span class="token keyword">import</span> <span class="token punctuation">{</span> Point <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./point'</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">03</span>
<span class="line-numbers-rows" style="user-select: none;">04</span><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">GravityOptions</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">05</span>  points<span class="token operator">:</span> PointStatic<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 各个点的实例</span>
<span class="line-numbers-rows" style="user-select: none;">06</span>  g<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// 引力常数</span>
<span class="line-numbers-rows" style="user-select: none;">07</span><span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">08</span>
<span class="line-numbers-rows" style="user-select: none;">09</span><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Gravity</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">10</span>  <span class="token keyword">public</span> $dom<span class="token operator">!</span><span class="token operator">:</span> HTMLCanvasElement<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">11</span>  <span class="token keyword">public</span> c2d<span class="token operator">!</span><span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">12</span>  <span class="token keyword">public</span> g<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">13</span>  <span class="token keyword">public</span> points<span class="token operator">:</span> Point<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">14</span>  <span class="token keyword">public</span> timer<span class="token operator">:</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> requestAnimationFrame<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">15</span>  <span class="token keyword">public</span> drawLine <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">16</span>
<span class="line-numbers-rows" style="user-select: none;">17</span>  <span class="token keyword">public</span> <span class="token function">constructor</span><span class="token punctuation">(</span>opts<span class="token operator">:</span> GravityOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">18</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> points<span class="token punctuation">,</span> g <span class="token punctuation">}</span> <span class="token operator">=</span> opts<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">19</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>g <span class="token operator">=</span> g <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">20</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initFromPoints</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">21</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">22</span>
<span class="line-numbers-rows" style="user-select: none;">23</span>  <span class="token keyword">public</span> <span class="token function">initFromPoints</span><span class="token punctuation">(</span>points<span class="token operator">:</span> PointStatic<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">24</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>points <span class="token operator">=</span> points<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">25</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">26</span>
<span class="line-numbers-rows" style="user-select: none;">27</span>  <span class="token keyword">public</span> <span class="token function">addPoint</span><span class="token punctuation">(</span>p<span class="token operator">:</span> PointStatic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">28</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">29</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">30</span>
<span class="line-numbers-rows" style="user-select: none;">31</span>  <span class="token keyword">public</span> <span class="token function">setDom</span><span class="token punctuation">(</span>$dom<span class="token operator">:</span> HTMLCanvasElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">32</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$dom <span class="token operator">=</span> $dom<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">33</span>    <span class="token keyword">const</span> c2d <span class="token operator">=</span> $dom<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">34</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>c2d<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'no 2d context'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">35</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>c2d <span class="token operator">=</span> c2d<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">36</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">37</span>
<span class="line-numbers-rows" style="user-select: none;">38</span>  <span class="token keyword">public</span> <span class="token function">updatePointsInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">39</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">40</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>otherP <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">41</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>otherP <span class="token operator">===</span> p<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 排除自己</span>
<span class="line-numbers-rows" style="user-select: none;">42</span>        p<span class="token punctuation">.</span><span class="token function">effect</span><span class="token punctuation">(</span>otherP<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">43</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">44</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">45</span>
<span class="line-numbers-rows" style="user-select: none;">46</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">47</span>      p<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">48</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">49</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">50</span>
<span class="line-numbers-rows" style="user-select: none;">51</span>  <span class="token keyword">public</span> <span class="token function">drawPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">52</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$dom<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$dom<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">53</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(77, 77, 77, 1)'</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">54</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">55</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">56</span>      <span class="token keyword">const</span> r <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">getPointRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">57</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">58</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">59</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">60</span>
<span class="line-numbers-rows" style="user-select: none;">61</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">62</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">63</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">64</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">65</span>
<span class="line-numbers-rows" style="user-select: none;">66</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">67</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(77, 77, 77, 0.3)'</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">68</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>c2d<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">69</span>    <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">70</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">71</span>
<span class="line-numbers-rows" style="user-select: none;">72</span>  <span class="token keyword">public</span> <span class="token function">toggleDrawLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">73</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>drawLine <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>drawLine<span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">74</span>  <span class="token punctuation">}</span>
<span class="line-numbers-rows" style="user-select: none;">75</span>
<span class="line-numbers-rows" style="user-select: none;">76</span>  <span class="token keyword">public</span> <span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">77</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">78</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">79</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">80</span>
<span class="line-numbers-rows" style="user-select: none;">81</span>  <span class="token keyword">public</span> <span class="token function-variable function">stop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">82</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">83</span>    <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">84</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">85</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">86</span>
<span class="line-numbers-rows" style="user-select: none;">87</span>  <span class="token keyword">public</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="line-numbers-rows" style="user-select: none;">88</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updatePointsInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">89</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">90</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">91</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="line-numbers-rows" style="user-select: none;">92</span><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></div><h1 id="playground" class="std-title --fontTitle"><a href="#playground" class="markdownIt-Anchor">#</a> playground<i data-minimap="Ignore"> ↵ </i></h1><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">调整参数控制, 建议保持动量和为 0, 不然会跑到画布之外</div><div><textarea style="font-family:consolas, Menlo;width:100%;height:300px">[
  {
    &quot;x&quot;: 150,
    &quot;y&quot;: 80,
    &quot;m&quot;: 100,
    &quot;dx&quot;: 6,
    &quot;dy&quot;: 0
  },
  {
    &quot;x&quot;: 150,
    &quot;y&quot;: 150,
    &quot;m&quot;: 100,
    &quot;dx&quot;: -6,
    &quot;dy&quot;: 0
  },
  {
    &quot;x&quot;: 150,
    &quot;y&quot;: 200,
    &quot;m&quot;: 100,
    &quot;dx&quot;: 0,
    &quot;dy&quot;: 0
  }
]</textarea></div><div class="std-window mode-windowed"><div class="std-window-menus"><div class="std-window-title"><span></span></div><div class="std-window-btns"><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div><div class="std-icon std-window-menu-btn" style="overflow:hidden;border-radius:1em;box-sizing:border-box"></div></div></div><div style="height:300px" class="std-window-content"><canvas style="display:block;margin:0 auto" width="320" height="300"></canvas></div></div><div style="display:none;height:0px;background:#BBB">placeholder</div></div></article></div><hr class="std-hr"/><hr class="std-hr"/><div class="blog-footer-main"><a class="r-link _prev" href="/cate/未分类标题/62ca7f2093a59fcbab91ce9ad5fd9c37/"><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-left" class="svg-inline--fa fa-caret-left fa-w-6 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><path fill="currentColor" d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"></path></svg></span><span>Markdown 快速上手</span></a><div class="_current"><span class="_smaller _grey">第</span><span class="_nums _grey">3</span><span class="_smaller _grey">篇</span><div class="_now-id">三体运动模拟器</div></div><a class="r-link _next" href="/cate/未分类标题/is-esm-robust-enough-in-broswer/"><span>浏览器内的 ESM 是否已足够强大</span><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-right" class="svg-inline--fa fa-caret-right fa-w-6 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></span></a></div><hr class="std-hr"/><hr class="std-hr"/><div class="back-to-top-main"><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up fa-w-10 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg></span><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up fa-w-10 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg></span><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up fa-w-10 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg></span><div class="_text-intro">回到顶部</div></div><hr class="std-hr"/><hr class="std-hr"/></div></div></div>
<script>window.__INITIAL_STATE__ = {"CategoryApiState":{"loaded":true,"loading":false,"error":null,"dataMap":{"/未分类标题/three-body-emulator":{"type":"detail","categoryId":"未分类标题","list":[{"id":"test-tsx-article-for-new-version","title":"新版博客测试文章 (.tsx)","author":"eczn","time":"1999-12-31T16:00:02.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"title":"Markdown 快速上手","date":"2017-02-07 02:21:11","intro":"Markdown 是一种轻量级标记语言，创始人为约翰·格鲁伯，写文章经常用的到，它可以被编译成HTML，比起直接用HTML写文章，Markdown书写起来更简洁快速，写作体验会好很多。 ","headPic":"http://2.im.guokr.com/YtavWcYpNiA3PDc9nI3VlKABHBwMwev-sVT_rHUQJAjEAQAA_wAAAEpQ.jpg","type":"article","id":"62ca7f2093a59fcbab91ce9ad5fd9c37","appTitle":"","appIcon":"","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","author":"eczn","imgs":[],"tags":[],"time":"2017-02-06T18:21:11.000Z","isDraft":false,"fileDeps":[],"wordCount":1322},{"id":"three-body-emulator","title":"三体运动模拟器","time":"2021-06-16T10:33:00.000Z","author":"eczn","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"is-esm-robust-enough-in-broswer","title":"浏览器内的 ESM 是否已足够强大","author":"eczn","time":"2022-01-04T15:33:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"white-noise-webgl","title":"从白噪声开始学习 WebGL","author":"eczn","time":"2023-03-28T16:34:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"the-adt-in-ts","title":"TypeScript 里的 ADT","author":"eczn","time":"2023-07-25T13:38:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"hello-css-vars","title":"Hello CSS 变量","author":"eczn","time":"2023-08-12T10:32:11.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"type":"app","id":"css-matrix3d-calc","title":"CSS Matrix3D 中的矩阵运算","appTitle":"CSS Matrix","appIcon":"/tsxs-esm/matrix2x2.831ca9df4adfae73.svg","author":"eczn","time":"2023-08-17T16:00:00.000Z","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"latex-notes","title":"LaTeX 笔记","author":"eczn","time":"2023-10-20T16:00:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"ipod-spin-gesture","title":"iPod 转盘手势","author":"eczn","time":"2023-11-19T17:20:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"type":"app","id":"app-pinch","title":"Pinch 捏放手势","appTitle":"Pinch 捏放手势","appIcon":"/tsxs-esm/pinch.daef4e8852186e91.svg","author":"eczn","time":"2024-01-01T15:33:00.000Z","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"old-demos","type":"app","appTitle":"早期 DEMO 集","appIcon":"/tsxs-esm/demo-book.dc04159dd4134c99.svg","title":"早期 DEMO 集","author":"eczn","time":"2024-03-16T10:50:00.000Z","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"binary-complement-principle","title":"二进制补码的数学原理","author":"author","time":"2024-04-29T15:58:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"moonbit-start","title":"Moonbit, 启动","author":"eczn","time":"2024-05-01T03:33:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"parser-combinator","title":"Parser Combinator","author":"eczn","time":"2024-05-01T23:00:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},{"id":"v8-asm-detail-of-inline-caches","title":"V8 Inline Caches 优化及其汇编细节","author":"eczn","time":"2024-06-29T23:49:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0}],"current":{"type":"tsx","meta":{"id":"three-body-emulator","title":"三体运动模拟器","time":"2021-06-16T10:33:00.000Z","author":"eczn","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},"tsxDistPath":"./three-body-emulator/index.blog.js","ssrContent":"<div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">三体运动没有解析解，这种遵循物理定律的混沌运动很适合用来做屏保，如:</div><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"><span></span></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div style=\"height:300px\" class=\"std-window-content\"><canvas style=\"display:block;margin:0 auto\" width=\"320\" height=\"300\"></canvas></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div><h1 id=\"point\" class=\"std-title --fontTitle\"><a href=\"#point\" class=\"markdownIt-Anchor\">#</a> 质点<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">将星球运动简化为质点，有二维坐标及速度向量，最后加上其质量:</div><div class=\"std-code\"><pre class=\"prismjs tsx rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token comment\">// point-static.ts</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PointStatic</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>  <span class=\"token comment\">/** 坐标 x */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>  x<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  <span class=\"token comment\">/** 坐标 y */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  y<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  <span class=\"token comment\">/** 速度向量 x */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span>  dx<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>  <span class=\"token comment\">/** 速度向量 y */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span>  dy<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>  <span class=\"token comment\">/** 质量 */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>  m<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"position\" class=\"std-title --fontTitle\"><a href=\"#position\" class=\"markdownIt-Anchor\">#</a> 速度对坐标, 引力对速度<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">速度对坐标的影响比较容易处理将上面的定义的 PointStatic 结构进行 (p.x += p.dx) 即可, 而引力对速度的影响, 则要计算加速度 (f = ma) 以及展开后在二维上的分量进行累加才行</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">这里有个情况需要注意，因为是质点，所以距离近的时候力会瞬间增大到无穷导致 number 溢出或者除 0 出现的 NaN, 所以要做最小距离处理</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">具体实现如下</div><div class=\"std-code\"><pre class=\"prismjs tsx rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token comment\">// point.ts</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PointStatic <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./point-static'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Point</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">PointStatic</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  <span class=\"token keyword\">public</span> x<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  <span class=\"token keyword\">public</span> y<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  <span class=\"token keyword\">public</span> dx<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span>  <span class=\"token keyword\">public</span> dy<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>  <span class=\"token keyword\">public</span> m<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">:</span> PointStatic<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>    Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">13</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">14</span>  <span class=\"token comment\">/** 当前速度对坐标的影响 */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">15</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">16</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dx<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">17</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dy<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">18</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">19</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">20</span>  <span class=\"token comment\">/**\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">21</span>   * p 和 this 间的引力对 this 速度影响\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">22</span>   * @param p 其他点\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">23</span>   * @param g 引力常数\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">24</span>   */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">25</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">effect</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">:</span> Point<span class=\"token punctuation\">,</span> g<span class=\"token operator\">:</span> number<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">26</span>    <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">distance</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">27</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">28</span>    <span class=\"token keyword\">const</span> distanceX <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">29</span>    <span class=\"token keyword\">const</span> distanceY <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">30</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">31</span>    <span class=\"token comment\">// f = ma 展开后可以得到 a = g * p.m / (r * r)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">32</span>    <span class=\"token comment\">// 这个 a 是带方向的，它的方向跟 this -> p 练成的线的方向是一致的</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">33</span>    <span class=\"token comment\">// 根据这个来做 x y 方向的分量拆解得到 k 最后得到各分量 ax ay</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">34</span>    <span class=\"token keyword\">const</span> k <span class=\"token operator\">=</span> g <span class=\"token operator\">*</span> p<span class=\"token punctuation\">.</span>m <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">*</span> r <span class=\"token operator\">*</span> r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">35</span>    <span class=\"token keyword\">const</span> ax <span class=\"token operator\">=</span> k <span class=\"token operator\">*</span> distanceX<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">36</span>    <span class=\"token keyword\">const</span> ay <span class=\"token operator\">=</span> k <span class=\"token operator\">*</span> distanceY<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">37</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">38</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dx <span class=\"token operator\">+=</span> ax<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">39</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dy <span class=\"token operator\">+=</span> ay<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">40</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">41</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">42</span>  <span class=\"token comment\">/** 求与 p1 的距离 */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">43</span>  <span class=\"token keyword\">private</span> <span class=\"token function\">distance</span><span class=\"token punctuation\">(</span>p1<span class=\"token operator\">:</span> Point<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> number <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">44</span>    <span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> p1<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">45</span>    <span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> p1<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">46</span>    <span class=\"token keyword\">const</span> yy <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> y<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">47</span>    <span class=\"token keyword\">const</span> xx <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">48</span>    <span class=\"token keyword\">const</span> rr <span class=\"token operator\">=</span> yy <span class=\"token operator\">+</span> xx<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">49</span>    <span class=\"token comment\">// 最小距离</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">50</span>    <span class=\"token keyword\">const</span> min <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">51</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rr <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>min <span class=\"token operator\">*</span> min<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">52</span>    <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>rr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">53</span>    <span class=\"token keyword\">return</span> r<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">54</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">55</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">56</span>  <span class=\"token comment\">/** 根据 m 给一个合适的半径 方便绘图 */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">57</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">getPointRadius</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> number <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">58</span>    <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">59</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 最小值 免得太小了看不到了</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">60</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">>=</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 免得太大了</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">61</span>    <span class=\"token keyword\">return</span> r <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">62</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">63</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"draw-and-multi-points\" class=\"std-title --fontTitle\"><a href=\"#draw-and-multi-points\" class=\"markdownIt-Anchor\">#</a> 绘图控制 &amp; 多质点<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-code\"><pre class=\"prismjs tsx rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token comment\">// gravity.tsx</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PointStatic <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./point-static'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Point <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./point'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">GravityOptions</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  points<span class=\"token operator\">:</span> PointStatic<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 各个点的实例</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  g<span class=\"token operator\">?</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 引力常数</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Gravity</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>  <span class=\"token keyword\">public</span> $dom<span class=\"token operator\">!</span><span class=\"token operator\">:</span> HTMLCanvasElement<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>  <span class=\"token keyword\">public</span> c2d<span class=\"token operator\">!</span><span class=\"token operator\">:</span> CanvasRenderingContext2D<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span>  <span class=\"token keyword\">public</span> g<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">13</span>  <span class=\"token keyword\">public</span> points<span class=\"token operator\">:</span> Point<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">14</span>  <span class=\"token keyword\">public</span> timer<span class=\"token operator\">:</span> ReturnType<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> requestAnimationFrame<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">15</span>  <span class=\"token keyword\">public</span> drawLine <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">16</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">17</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>opts<span class=\"token operator\">:</span> GravityOptions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">18</span>    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> points<span class=\"token punctuation\">,</span> g <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> opts<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">19</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>g <span class=\"token operator\">=</span> g <span class=\"token operator\">||</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">20</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initFromPoints</span><span class=\"token punctuation\">(</span>points<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">21</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">22</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">23</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">initFromPoints</span><span class=\"token punctuation\">(</span>points<span class=\"token operator\">:</span> PointStatic<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">24</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points <span class=\"token operator\">=</span> points<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">25</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">26</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">27</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">addPoint</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">:</span> PointStatic<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">28</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">29</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">30</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">31</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">setDom</span><span class=\"token punctuation\">(</span>$dom<span class=\"token operator\">:</span> HTMLCanvasElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">32</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$dom <span class=\"token operator\">=</span> $dom<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">33</span>    <span class=\"token keyword\">const</span> c2d <span class=\"token operator\">=</span> $dom<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">34</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>c2d<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'no 2d context'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">35</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d <span class=\"token operator\">=</span> c2d<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">36</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">37</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">38</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">updatePointsInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">39</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">40</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>otherP <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">41</span>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>otherP <span class=\"token operator\">===</span> p<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 排除自己</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">42</span>        p<span class=\"token punctuation\">.</span><span class=\"token function\">effect</span><span class=\"token punctuation\">(</span>otherP<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>g<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">43</span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">44</span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">45</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">46</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">47</span>      p<span class=\"token punctuation\">.</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">48</span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">49</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">50</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">51</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">drawPoints</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">52</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$dom<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$dom<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">53</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'rgba(77, 77, 77, 1)'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">54</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">55</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">56</span>      <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span><span class=\"token function\">getPointRadius</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">57</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">58</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">59</span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">60</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">61</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>drawLine<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">62</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">63</span>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">lineTo</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">64</span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">65</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">66</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">lineTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">67</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'rgba(77, 77, 77, 0.3)'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">68</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">69</span>    <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">70</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">71</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">72</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">toggleDrawLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">73</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>drawLine <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>drawLine<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">74</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">75</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">76</span>  <span class=\"token keyword\">public</span> <span class=\"token function-variable function\">start</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">77</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">78</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">79</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">80</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">81</span>  <span class=\"token keyword\">public</span> <span class=\"token function-variable function\">stop</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">82</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">83</span>    <span class=\"token function\">cancelAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">84</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">85</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">86</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">87</span>  <span class=\"token keyword\">public</span> <span class=\"token function-variable function\">render</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">88</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updatePointsInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">89</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">drawPoints</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">90</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer <span class=\"token operator\">=</span> <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">91</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">92</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></pre></div><h1 id=\"playground\" class=\"std-title --fontTitle\"><a href=\"#playground\" class=\"markdownIt-Anchor\">#</a> playground<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">调整参数控制, 建议保持动量和为 0, 不然会跑到画布之外</div><div><textarea style=\"font-family:consolas, Menlo;width:100%;height:300px\">[\n  {\n    &quot;x&quot;: 150,\n    &quot;y&quot;: 80,\n    &quot;m&quot;: 100,\n    &quot;dx&quot;: 6,\n    &quot;dy&quot;: 0\n  },\n  {\n    &quot;x&quot;: 150,\n    &quot;y&quot;: 150,\n    &quot;m&quot;: 100,\n    &quot;dx&quot;: -6,\n    &quot;dy&quot;: 0\n  },\n  {\n    &quot;x&quot;: 150,\n    &quot;y&quot;: 200,\n    &quot;m&quot;: 100,\n    &quot;dx&quot;: 0,\n    &quot;dy&quot;: 0\n  }\n]</textarea></div><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"><span></span></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div style=\"height:300px\" class=\"std-window-content\"><canvas style=\"display:block;margin:0 auto\" width=\"320\" height=\"300\"></canvas></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div>","props":{"codePointStatic":"// point-static.ts\nexport interface PointStatic {\n  /** 坐标 x */\n  x: number;\n  /** 坐标 y */\n  y: number;\n  /** 速度向量 x */\n  dx: number;\n  /** 速度向量 y */\n  dy: number;\n  /** 质量 */\n  m: number;\n}\n","codePoint":"// point.ts\nimport { PointStatic } from './point-static';\n\nexport class Point implements PointStatic {\n  public x!: number;\n  public y!: number;\n  public dx!: number;\n  public dy!: number;\n  public m!: number;\n\n  public constructor(data: PointStatic) {\n    Object.assign(this, data);\n  }\n\n  /** 当前速度对坐标的影响 */\n  public move() {\n    this.x += this.dx;\n    this.y += this.dy;\n  }\n\n  /**\n   * p 和 this 间的引力对 this 速度影响\n   * @param p 其他点\n   * @param g 引力常数\n   */\n  public effect(p: Point, g: number) {\n    const r = this.distance(p);\n\n    const distanceX = p.x - this.x;\n    const distanceY = p.y - this.y;\n\n    // f = ma 展开后可以得到 a = g * p.m / (r * r)\n    // 这个 a 是带方向的，它的方向跟 this -> p 练成的线的方向是一致的\n    // 根据这个来做 x y 方向的分量拆解得到 k 最后得到各分量 ax ay\n    const k = g * p.m / (r * r * r);\n    const ax = k * distanceX;\n    const ay = k * distanceY;\n\n    this.dx += ax;\n    this.dy += ay;\n  }\n\n  /** 求与 p1 的距离 */\n  private distance(p1: Point): number {\n    const y = this.y - p1.y;\n    const x = this.x - p1.x;\n    const yy = y * y;\n    const xx = x * x;\n    const rr = yy + xx;\n    // 最小距离\n    const min = 100;\n    if (rr <= (min * min)) return 100;\n    const r = Math.sqrt(rr);\n    return r;\n  }\n\n  /** 根据 m 给一个合适的半径 方便绘图 */\n  public getPointRadius(): number {\n    const r = Math.sqrt(this.m);\n    if (r <= 4) return 2; // 最小值 免得太小了看不到了\n    if (r >= 24) return 12; // 免得太大了\n    return r / 2;\n  }\n}\n","codeGravity":"// gravity.tsx\nimport { PointStatic } from './point-static';\nimport { Point } from './point';\n\nexport interface GravityOptions {\n  points: PointStatic[]; // 各个点的实例\n  g?: number; // 引力常数\n}\n\nexport class Gravity {\n  public $dom!: HTMLCanvasElement;\n  public c2d!: CanvasRenderingContext2D;\n  public g: number;\n  public points: Point[] = [];\n  public timer: ReturnType<typeof requestAnimationFrame> | null = null;\n  public drawLine = false;\n\n  public constructor(opts: GravityOptions) {\n    const { points, g } = opts;\n    this.g = g || 1;\n    this.initFromPoints(points);\n  }\n\n  public initFromPoints(points: PointStatic[]) {\n    this.points = points.map(p => new Point(p));\n  }\n\n  public addPoint(p: PointStatic) {\n    this.points.push(new Point(p));\n  }\n\n  public setDom($dom: HTMLCanvasElement) {\n    this.$dom = $dom;\n    const c2d = $dom.getContext('2d')!;\n    if (!c2d) throw new Error('no 2d context');\n    this.c2d = c2d;\n  }\n\n  public updatePointsInfo() {\n    this.points.forEach(p => {\n      this.points.forEach(otherP => {\n        if (otherP === p) return; // 排除自己\n        p.effect(otherP, this.g);\n      });\n    });\n\n    this.points.forEach(p => {\n      p.move();\n    });\n  }\n\n  public drawPoints() {\n    this.c2d.clearRect(0, 0, this.$dom.width, this.$dom.height);\n    this.c2d.fillStyle = 'rgba(77, 77, 77, 1)';\n    this.points.forEach(p => {\n      this.c2d.beginPath();\n      const r = p.getPointRadius();\n      this.c2d.arc(p.x, p.y, r, 0, Math.PI * 2);\n      this.c2d.fill();\n    });\n\n    if (this.drawLine) {\n      this.points.forEach((p, idx) => {\n        this.c2d.lineTo(p.x, p.y);\n      });\n\n      this.c2d.lineTo(this.points[0].x, this.points[0].y);\n      this.c2d.fillStyle = 'rgba(77, 77, 77, 0.3)';\n      this.c2d.fill();\n    }\n  }\n\n  public toggleDrawLine() {\n    this.drawLine = !this.drawLine;\n  }\n\n  public start = () => {\n    if (this.timer) return;\n    this.render();\n  };\n\n  public stop = () => {\n    if (!this.timer) return;\n    cancelAnimationFrame(this.timer);\n    this.timer = null;\n  };\n\n  public render = () => {\n    this.updatePointsInfo();\n    this.drawPoints();\n    this.timer = requestAnimationFrame(this.render);\n  };\n};"},"tocStack":[{"id":"point","level":1,"text":"质点"},{"id":"position","level":1,"text":"速度对坐标, 引力对速度"},{"id":"draw-and-multi-points","level":1,"text":"绘图控制 & 多质点"},{"id":"playground","level":1,"text":"playground"}]}}}},"BlogApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"HomeApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"TimeLineApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"SettingApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"LaunchpadApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}}}</script>
<!--SCRIPT-->
</body>
</html>
