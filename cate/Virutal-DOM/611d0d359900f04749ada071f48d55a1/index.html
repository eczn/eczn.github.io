<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<title>Virutal-DOM | 虚拟 DOM 原理表述 | Eczn's Home</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no,minimal-ui">
<meta name="format-detection" content="telephone=no">

<style id="CSS_VARS"></style>
<script>
(function() {
console.log('INIT CSS VAR');
function loadCSSVars() {
    const j = localStorage.getItem("CSS_VARS_2" /* STORAGE_KEY.CSS_VARS */);
    const initialVars = initialCSSVars();
    if (!j)
        return initialVars;
    try {
        const result = {
            ...initialVars,
            ...JSON.parse(j)
        };
        console.log('loadCSSVars from storage', result);
        return result;
    }
    catch (error) {
        console.error('load css vars with error', error);
        return initialVars;
    }
}
function renderCSSVars(vars, style) {
    const allDefine = Object.keys(vars).map(k => {
        const v = vars[k];
        const cssValue = typeof v === 'number' ? `${v}px` : v;
        return `--${k}:${cssValue};`;
    }).join('\n');
    if (style) {
        style.innerHTML = `:root { ${allDefine} }`;
    }
    else {
        console.error(`style#CSS_VARS NotFound !`);
    }
}
function initialCSSVars() {
    let rem = 16;
    // 移动端
    if (typeof window !== 'undefined' && window.innerWidth <= 500) {
        rem = Number(((window.innerWidth - 20) / 42).toFixed(1));
        console.log('mobile calculated rem =>', rem);
    }
    return {
        rem,
        enableSmallerFont: false,
        displayToc: 'block',
        fontSmcp: 'source serif pro, serif',
        fontCode: 'consolas, Menlo, monospace',
        fontTitle: 'Noto Serif SC, serif',
        fontArticle: 'source serif pro, LXGW WenKai',
        fontSansSerif: 'sans-serif',
    };
}
window.__initialCSSVars = loadCSSVars();
renderCSSVars(__initialCSSVars, document.querySelector('#CSS_VARS'));
})();
</script>

<link rel="icon" href="/favicon.png"><script defer="defer" src="/js/index.cfd76580.js"></script><script defer="defer" src="/js/chunk-lib.c90ce4c7.js"></script><link href="/css/index.719eaef39530924de6f6.css" rel="stylesheet"><link href="/css/chunk-lib.5c7d4887bb8714b00c54.css" rel="stylesheet"></head>
<body>
<noscript>当前浏览器不支持 JavaScript, 建议使用支持 JavaScript 的浏览器来访问此网站 !</noscript>
<div id="rally-bg" style="opacity:0"></div>
<div id="app"><div class="ball-canvas-container"></div><nav class="nav-main --fontSmcp"><div class="_title default-max-width">Eczn&#x27;s Home</div><div class="smcphr"></div><div class="_links default-max-width"><a class="r-link _link clickable r-link" href="/">Home</a><a class="r-link _link clickable r-link" href="/tl/0/">Timeline</a><a class="r-link _link clickable r-link" href="/cate/all/">Category</a><a class="r-link _link clickable r-link" href="/setting/">Setting</a><a class="r-link _link clickable r-link" href="/launchpad/">Launchpad</a></div></nav><div class="std-box category-main category-detail default-max-width"><div class="std-box-content "><div class="_cate-header"><div class="_blog-links"><a class="r-link _blog-link --fontTitle _active" href="/cate/Virutal-DOM/611d0d359900f04749ada071f48d55a1/"><span class="_nth">#<!-- -->0</span>虚拟 DOM 原理表述</a><a class="r-link _blog-link --fontTitle" href="/cate/Virutal-DOM/aeb212c2acdd98406cb97f10c5b66475/"><span class="_nth">#<!-- -->1</span>构造 VNode 对象</a><a class="r-link _blog-link --fontTitle" href="/cate/Virutal-DOM/1b558499fb2239187487ceeb547e8b6a/"><span class="_nth">#<!-- -->2</span>diff 算法</a><a class="r-link _blog-link --fontTitle" href="/cate/Virutal-DOM/11aa2f70ade26f5065684ff8b56c1f58/"><span class="_nth">#<!-- -->3</span>diff 和 patch 操作</a></div><div class="_cate-title --fontTitle">分类「 <!-- -->Virutal-DOM<!-- --> 」</div></div><div><div id="start" class="blog-header-main"><div class="_infos"><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg>2018-01-31</div><div class="_info"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tag" class="svg-inline--fa fa-tag fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg>Virtual-DOM</div></div><div class="_title --fontTitle">虚拟 DOM 原理表述</div></div><article><div class="r-article"><div class="std-para --fontArticle" data-minimap-color="#CCCCCC">过去的两周里，有空就看了看虚拟 DOM 的各种，勉勉强强算是有了一个简单的实现：</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">https://github.com/eczn/vdom</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">本篇着重介绍为什么要有虚拟 DOM ，以及虚拟 DOM 的一般性原理，接下来的几篇我将陆陆续续的实现一个简单的虚拟 DOM</div>
<h1 id="dom-的性能问题" class="std-title --fontTitle"><a target="_blank" href="#dom-的性能问题" class="markdownIt-Anchor">#</a> DOM 的性能问题<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">观察如下的 HTML 结构</div>
<div class="std-code"><pre class="prismjs html rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Apple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">02</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Bababa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Star<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">04</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>eczn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">05</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">现在要实现这样的功能：点击 p 标签让其置顶，比如点击了 <code>Star</code> 之后，DOM 变成如下样子：</div>
<div class="std-code"><pre class="prismjs html rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Star<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">02</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Apple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Bababa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">04</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>eczn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">05</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">一个简单的实现如下：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span>window<span class="token punctuation">.</span>onload <span class="token operator">=</span> clickTop<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">01</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token keyword">function</span> <span class="token function">clickTop</span><span class="token punctuation">(</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#x27;Apple&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Bababa&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Star&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;eczn&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token comment">// 容器 </span>
<span style="user-select:none" class="line-numbers-rows">04</span>    <span class="token keyword">let</span> $app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#app&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">05</span>
<span style="user-select:none" class="line-numbers-rows">06</span>    <span class="token comment">// 让第 idx 个元素提前 </span>
<span style="user-select:none" class="line-numbers-rows">07</span>    <span class="token keyword">let</span> <span class="token function-variable function">makeFirst</span> <span class="token operator">=</span> <span class="token parameter">idx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">08</span>        <span class="token keyword">let</span> target <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">09</span>        data<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">10</span>    <span class="token punctuation">}</span>
<span style="user-select:none" class="line-numbers-rows">11</span>
<span style="user-select:none" class="line-numbers-rows">12</span>    <span class="token comment">// 调用 data2html 将会得到如下结果 </span>
<span style="user-select:none" class="line-numbers-rows">13</span>    <span class="token comment">// =&gt; </span>
<span style="user-select:none" class="line-numbers-rows">14</span>    <span class="token comment">// &lt;p data-pos=&quot;0&quot;&gt;Apple&lt;/p&gt;</span>
<span style="user-select:none" class="line-numbers-rows">15</span>    <span class="token comment">// &lt;p data-pos=&quot;1&quot;&gt;Bababa&lt;/p&gt;</span>
<span style="user-select:none" class="line-numbers-rows">16</span>    <span class="token comment">// &lt;p data-pos=&quot;2&quot;&gt;Star&lt;/p&gt;</span>
<span style="user-select:none" class="line-numbers-rows">17</span>    <span class="token comment">// &lt;p data-pos=&quot;3&quot;&gt;eczn&lt;/p&gt;</span>
<span style="user-select:none" class="line-numbers-rows">18</span>    <span class="token keyword">let</span> <span class="token function-variable function">data2html</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
<span style="user-select:none" class="line-numbers-rows">19</span>        <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p data-pos=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span>
<span style="user-select:none" class="line-numbers-rows">20</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">21</span>
<span style="user-select:none" class="line-numbers-rows">22</span>    <span class="token comment">// render， 渲染 data 到 $app 里 </span>
<span style="user-select:none" class="line-numbers-rows">23</span>    <span class="token keyword">let</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">data2html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">24</span>
<span style="user-select:none" class="line-numbers-rows">25</span>    <span class="token comment">// 事件委托处理 p 标签 </span>
<span style="user-select:none" class="line-numbers-rows">26</span>    $app<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">27</span>        <span class="token comment">// 被点击的 p 标签以及其下标</span>
<span style="user-select:none" class="line-numbers-rows">28</span>        <span class="token keyword">let</span> $p <span class="token operator">=</span> e<span class="token punctuation">.</span>srcElement<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">29</span>        <span class="token keyword">let</span> pos <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>$p<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">30</span>
<span style="user-select:none" class="line-numbers-rows">31</span>        <span class="token comment">// 调整并重新皴染</span>
<span style="user-select:none" class="line-numbers-rows">32</span>        <span class="token function">makeFirst</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">33</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">34</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">35</span>
<span style="user-select:none" class="line-numbers-rows">36</span>    <span class="token comment">// 初始渲染 </span>
<span style="user-select:none" class="line-numbers-rows">37</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">38</span><span class="token punctuation">}</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">显然随着 data 的增长，每次 render 的量会越来越大，性能也会越来越差，每次 render 所花费时间也会越来越多。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">再来看看另外一个实现：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span>window<span class="token punctuation">.</span>onload <span class="token operator">=</span> clickTopV2<span class="token punctuation">;</span>
<span style="user-select:none" class="line-numbers-rows">01</span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token keyword">function</span> <span class="token function">clickTopV2</span><span class="token punctuation">(</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#x27;Apple&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Bababa&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Star&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;eczn&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token comment">// 容器 </span>
<span style="user-select:none" class="line-numbers-rows">04</span>    <span class="token keyword">let</span> $app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#app&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">05</span>
<span style="user-select:none" class="line-numbers-rows">06</span>    <span class="token comment">// 生成 html </span>
<span style="user-select:none" class="line-numbers-rows">07</span>    <span class="token keyword">let</span> html <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
<span style="user-select:none" class="line-numbers-rows">08</span>        <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p data-pos=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span>
<span style="user-select:none" class="line-numbers-rows">09</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">10</span>
<span style="user-select:none" class="line-numbers-rows">11</span>    <span class="token comment">// 初始渲染 </span>
<span style="user-select:none" class="line-numbers-rows">12</span>    $app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">13</span>
<span style="user-select:none" class="line-numbers-rows">14</span>    $app<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span style="user-select:none" class="line-numbers-rows">15</span>        <span class="token keyword">let</span> $p <span class="token operator">=</span> e<span class="token punctuation">.</span>srcElement<span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">16</span>        <span class="token keyword">let</span> $nowTop <span class="token operator">=</span> $app<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">17</span>
<span style="user-select:none" class="line-numbers-rows">18</span>        <span class="token comment">// $app.removeChild($p); </span>
<span style="user-select:none" class="line-numbers-rows">19</span>        <span class="token comment">// 下一句 insertBefore 会自动去重</span>
<span style="user-select:none" class="line-numbers-rows">20</span>        <span class="token comment">// 此步省略 </span>
<span style="user-select:none" class="line-numbers-rows">21</span>        <span class="token comment">// 感谢 @deswan 纠错 </span>
<span style="user-select:none" class="line-numbers-rows">22</span>
<span style="user-select:none" class="line-numbers-rows">23</span>        $app<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>$p<span class="token punctuation">,</span> $nowTop<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">24</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span style="user-select:none" class="line-numbers-rows">25</span><span class="token punctuation">}</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这个实现跟之前的不一样，因为它将元素提升的操作是操作 <code>$app</code> 的子节点，吧 srcElment 取出来插入到最前面，在这种情况下，即便 data 很大，性能也能保持为 <code>O(1)</code> (假设 removeChild 和 insertBefore 的复杂度也是常数)</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">此处，没有直接操作 innerHTML 进行 DOM 操作，性能比前者好很多，DOM 是很慢的，毫秒级的，很花费时间，要想要更好的性能，最好都要使用第二种方式来操作 DOM，但这种操作比起前者的实现要更难一些，原因在于：需要找到不同的地方以及相关的 DOM 节点进行位置的变换，而前者仅仅只要赋值 innerHTML 就可以了。</div>
<h1 id="被忽略的差异-以及不可忽略的差异" class="std-title --fontTitle"><a target="_blank" href="#被忽略的差异-以及不可忽略的差异" class="markdownIt-Anchor">#</a> 被忽略的差异、以及不可忽略的差异<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">实现如上的例子，有两种思路，一种是忽略差异，一种是不忽略差异，分别对应前述的两种实现：</div>
<div class="std-code"><pre class="prismjs html rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Apple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">02</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Bababa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">03</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Star<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">04</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>eczn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">05</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">06</span>
<span style="user-select:none" class="line-numbers-rows">07</span>==&gt; 
<span style="user-select:none" class="line-numbers-rows">08</span>
<span style="user-select:none" class="line-numbers-rows">09</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">10</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Bababa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">11</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Apple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">12</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Star<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">13</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>eczn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span style="user-select:none" class="line-numbers-rows">14</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">先谈谈不忽略差异的实现吧：</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">$app 的差异在于 Apple 和 Bababa 的位置互换了。<br/>
因此，要让 <div class="std-formula-wrapper" style="display:inline-block"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord cjk_fallback">变成</span></span></span></span></div>app2 仅需将 $app 里的 Bababa 和 Apple 互换位置即可，这样就可以实现功能。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">而所谓的忽略差异其实就是直接操作 innerHTML 而不管原来的 DOM 树要怎么样才可以变成新的 DOM 树：<br/>
观察到多个 p 标签跟数组的结构是一一对应的，因而很容器得到如下的映射关系：</div>
<div class="std-code"><pre class="prismjs js rally-runner  "><span style="user-select:none" class="line-numbers-rows">00</span>$app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#x27;Apple&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;eczn&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
<span style="user-select:none" class="line-numbers-rows">01</span>    <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span>
<span style="user-select:none" class="line-numbers-rows">02</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">对此进行编程即可实现功能。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC"><strong>很显然，忽略差异会做更多的事，不忽略差异的本质是：让原 DOM 树走一条路径变成新的 DOM 树。</strong></div>
<h1 id="虚拟-dom-应运而生" class="std-title --fontTitle"><a target="_blank" href="#虚拟-dom-应运而生" class="markdownIt-Anchor">#</a> 虚拟 DOM 应运而生<i data-minimap="Ignore"> ↵ </i></h1>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">从前面的讨论可以知道，忽略差异的话， DOM 会做很多多余的事，要让性能最好，必须找出那条使得让原树变成新树的路径，这样才可以让 DOM 做少一些事，从而使性能更好。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">那么要怎么样才能知道两颗 DOM 树的差异，以及一条从原树到新树的路径？</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">答案是使用虚拟 DOM：</div>
<blockquote lang="en" class="std-quote"><span class="std-quote-text">
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">虚拟 DOM 技术是指用 JavaScript 来表达 DOM 的数据结构，并由一定的算法来找出虚拟 DOM 变化前后的差异，最后将差异应用到真实的 DOM 上，从而达到性能优化的技术目的。</div>
</span></blockquote>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">特别说明一下：找出旧树和新树的差异，叫做 diff 操作；把路径应用到旧树使其变成新树，叫做 patch 操作。</div>
<div class="std-para --fontArticle" data-minimap-color="#CCCCCC">这两个操作是虚拟 DOM 的核心操作，实现了这两个操作，虚拟 DOM 就写的七七八八了。</div>
</div></article></div><hr class="std-hr"/><hr class="std-hr"/><div class="blog-footer-main"><a class="r-link _prev" href="/cate/all/"><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-left" class="svg-inline--fa fa-caret-left fa-w-6 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><path fill="currentColor" d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"></path></svg></span><span>回到列表</span></a><div class="_current"><span class="_smaller _grey">第</span><span class="_nums _grey">1</span><span class="_smaller _grey">篇</span><div class="_now-id">虚拟 DOM 原理表述</div></div><a class="r-link _next" href="/cate/Virutal-DOM/aeb212c2acdd98406cb97f10c5b66475/"><span>构造 VNode 对象</span><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-right" class="svg-inline--fa fa-caret-right fa-w-6 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></span></a></div><hr class="std-hr"/><hr class="std-hr"/><div class="back-to-top-main"><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up fa-w-10 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg></span><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up fa-w-10 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg></span><span class="_icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up fa-w-10 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg></span><div class="_text-intro">回到顶部</div></div><hr class="std-hr"/><hr class="std-hr"/></div></div></div>
<script>window.__INITIAL_STATE__ = {"CategoryApiState":{"loaded":true,"loading":false,"error":null,"dataMap":{"/Virutal-DOM/611d0d359900f04749ada071f48d55a1":{"type":"detail","categoryId":"Virutal-DOM","list":[{"title":"虚拟 DOM 原理表述","intro":"怎样写一个虚拟 DOM","date":"Wed Jan 31 2018 15:08:04 GMT+0800 (中国标准时间)","category":"Virutal-DOM","cateIntro":"虚拟 DOM 的原理以及一个可行的实现","tags":["Virtual-DOM"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"type":"article","id":"611d0d359900f04749ada071f48d55a1","appTitle":"","author":"eczn","imgs":[],"time":"2018-01-31T07:08:04.000Z","isDraft":false,"fileDeps":[],"wordCount":3667},{"title":"构造 VNode 对象","intro":"怎样写一个虚拟 DOM","date":"Wed Jan 31 2018 16:30:30 GMT+0800 (中国标准时间)","category":"Virutal-DOM","cateIntro":"虚拟 DOM 的原理以及一个可行的实现","tags":["Virtual-DOM"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"type":"article","id":"aeb212c2acdd98406cb97f10c5b66475","appTitle":"","author":"eczn","imgs":[],"time":"2018-01-31T08:30:30.000Z","isDraft":false,"fileDeps":[],"wordCount":6427},{"title":"diff 算法","intro":"怎样写一个虚拟 DOM","date":"Wed Jan 31 2018 17:10:39 GMT+0800 (中国标准时间)","category":"Virutal-DOM","cateIntro":"虚拟 DOM 的原理以及一个可行的实现","tags":["Virtual-DOM"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"type":"article","id":"1b558499fb2239187487ceeb547e8b6a","appTitle":"","author":"eczn","imgs":[],"time":"2018-01-31T09:10:39.000Z","isDraft":false,"fileDeps":[],"wordCount":9808},{"title":"diff 和 patch 操作","intro":"怎样写一个虚拟 DOM","date":"Wed Jan 31 2018 18:06:01 GMT+0800 (中国标准时间)","category":"Virutal-DOM","cateIntro":"虚拟 DOM 的原理以及一个可行的实现","tags":["Virtual-DOM"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"type":"article","id":"11aa2f70ade26f5065684ff8b56c1f58","appTitle":"","author":"eczn","imgs":[],"time":"2018-01-31T10:06:01.000Z","isDraft":false,"fileDeps":[],"wordCount":3507}],"current":{"type":"markdown","meta":{"title":"虚拟 DOM 原理表述","intro":"怎样写一个虚拟 DOM","date":"Wed Jan 31 2018 15:08:04 GMT+0800 (中国标准时间)","category":"Virutal-DOM","cateIntro":"虚拟 DOM 的原理以及一个可行的实现","tags":["Virtual-DOM"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"type":"article","id":"611d0d359900f04749ada071f48d55a1","appTitle":"","author":"eczn","imgs":[],"time":"2018-01-31T07:08:04.000Z","isDraft":false,"fileDeps":[],"wordCount":3667},"nodes":[{"type":"tag","children":[{"type":"text","data":"过去的两周里，有空就看了看虚拟 DOM 的各种，勉勉强强算是有了一个简单的实现："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"https://github.com/eczn/vdom"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"本篇着重介绍为什么要有虚拟 DOM ，以及虚拟 DOM 的一般性原理，接下来的几篇我将陆陆续续的实现一个简单的虚拟 DOM"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#dom-的性能问题","className":"markdownIt-Anchor"}},{"type":"text","data":" DOM 的性能问题"}],"name":"h1","attribs":{"id":"dom-的性能问题"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"观察如下的 HTML 结构"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"id"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"app"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Apple"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Bababa"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Star"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"eczn"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}}],"name":"pre","attribs":{"className":"prismjs html rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"现在要实现这样的功能：点击 p 标签让其置顶，比如点击了 "},{"type":"tag","children":[{"type":"text","data":"Star"}],"name":"code","attribs":{}},{"type":"text","data":" 之后，DOM 变成如下样子："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"id"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"app"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Star"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Apple"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Bababa"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"eczn"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}}],"name":"pre","attribs":{"className":"prismjs html rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"一个简单的实现如下："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"window"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"onload "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" clickTop"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"clickTop"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'Apple'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'Bababa'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'Star'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'eczn'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 容器 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" $app "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" document"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"querySelector"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'#app'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 让第 idx 个元素提前 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"makeFirst"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"idx"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" target "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"splice"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"idx"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"unshift"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"target"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 调用 data2html 将会得到如下结果 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// => "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// &lt;p data-pos=\"0\">Apple&lt;/p>"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// &lt;p data-pos=\"1\">Bababa&lt;/p>"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// &lt;p data-pos=\"2\">Star&lt;/p>"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// &lt;p data-pos=\"3\">eczn&lt;/p>"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"data2html"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"map"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"e"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" idx"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}},{"type":"tag","children":[{"type":"text","data":"&lt;p data-pos=\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"${"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}},{"type":"text","data":"idx"},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}}],"name":"span","attribs":{"className":"token interpolation"}},{"type":"tag","children":[{"type":"text","data":"\">"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"${"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}},{"type":"text","data":"e"},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}}],"name":"span","attribs":{"className":"token interpolation"}},{"type":"tag","children":[{"type":"text","data":"&lt;/p>"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}}],"name":"span","attribs":{"className":"token template-string"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"join"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// render， 渲染 data 到 $app 里 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"23"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"render"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" $app"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"innerHTML "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"data2html"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"24"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"25"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 事件委托处理 p 标签 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"26"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    $app"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"addEventListener"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'click'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"e"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"27"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 被点击的 p 标签以及其下标"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"28"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" $p "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" e"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"srcElement"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"29"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" pos "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parseInt"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"$p"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"dataset"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"pos"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"30"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"31"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 调整并重新皴染"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"32"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"makeFirst"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"pos"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"33"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"render"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"34"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"35"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"36"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 初始渲染 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"37"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"render"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"38"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"显然随着 data 的增长，每次 render 的量会越来越大，性能也会越来越差，每次 render 所花费时间也会越来越多。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"再来看看另外一个实现："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"window"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"onload "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" clickTopV2"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"clickTopV2"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'Apple'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'Bababa'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'Star'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'eczn'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 容器 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" $app "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" document"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"querySelector"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'#app'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 生成 html "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" html "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"map"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"e"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" idx"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}},{"type":"tag","children":[{"type":"text","data":"&lt;p data-pos=\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"${"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}},{"type":"text","data":"idx"},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}}],"name":"span","attribs":{"className":"token interpolation"}},{"type":"tag","children":[{"type":"text","data":"\">"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"${"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}},{"type":"text","data":"e"},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}}],"name":"span","attribs":{"className":"token interpolation"}},{"type":"tag","children":[{"type":"text","data":"&lt;/p>"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}}],"name":"span","attribs":{"className":"token template-string"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"join"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 初始渲染 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    $app"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"innerHTML "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" html"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    $app"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"addEventListener"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'click'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"e"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" $p "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" e"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"srcElement"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" $nowTop "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" $app"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"children"},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// $app.removeChild($p); "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 下一句 insertBefore 会自动去重"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 此步省略 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 感谢 @deswan 纠错 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"23"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        $app"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"insertBefore"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"$p"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" $nowTop"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"24"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"25"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这个实现跟之前的不一样，因为它将元素提升的操作是操作 "},{"type":"tag","children":[{"type":"text","data":"$app"}],"name":"code","attribs":{}},{"type":"text","data":" 的子节点，吧 srcElment 取出来插入到最前面，在这种情况下，即便 data 很大，性能也能保持为 "},{"type":"tag","children":[{"type":"text","data":"O(1)"}],"name":"code","attribs":{}},{"type":"text","data":" (假设 removeChild 和 insertBefore 的复杂度也是常数)"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"此处，没有直接操作 innerHTML 进行 DOM 操作，性能比前者好很多，DOM 是很慢的，毫秒级的，很花费时间，要想要更好的性能，最好都要使用第二种方式来操作 DOM，但这种操作比起前者的实现要更难一些，原因在于：需要找到不同的地方以及相关的 DOM 节点进行位置的变换，而前者仅仅只要赋值 innerHTML 就可以了。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#被忽略的差异-以及不可忽略的差异","className":"markdownIt-Anchor"}},{"type":"text","data":" 被忽略的差异、以及不可忽略的差异"}],"name":"h1","attribs":{"id":"被忽略的差异-以及不可忽略的差异"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"实现如上的例子，有两种思路，一种是忽略差异，一种是不忽略差异，分别对应前述的两种实现："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"id"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"app"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Apple"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Bababa"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Star"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"eczn"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"==> \n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"id"}],"name":"span","attribs":{"className":"token attr-name"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token punctuation attr-equals"}},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"app2"},{"type":"tag","children":[{"type":"text","data":"\""}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token attr-value"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Bababa"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Apple"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"Star"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"eczn"},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"p"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"&lt;/"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"div"}],"name":"span","attribs":{"className":"token tag"}},{"type":"tag","children":[{"type":"text","data":">"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"span","attribs":{"className":"token tag"}}],"name":"pre","attribs":{"className":"prismjs html rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"先谈谈不忽略差异的实现吧："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"$app 的差异在于 Apple 和 Bababa 的位置互换了。"},{"type":"tag","children":[],"name":"br","attribs":{}},{"type":"text","data":"\n因此，要让 $app 变成 $app2 仅需将 $app 里的 Bababa 和 Apple 互换位置即可，这样就可以实现功能。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"而所谓的忽略差异其实就是直接操作 innerHTML 而不管原来的 DOM 树要怎么样才可以变成新的 DOM 树："},{"type":"tag","children":[],"name":"br","attribs":{}},{"type":"text","data":"\n观察到多个 p 标签跟数组的结构是一一对应的，因而很容器得到如下的映射关系："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"$app"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"innerHTML "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'Apple'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'eczn'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"map"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"e"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}},{"type":"tag","children":[{"type":"text","data":"&lt;p>"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"${"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}},{"type":"text","data":"e"},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}}],"name":"span","attribs":{"className":"token interpolation"}},{"type":"tag","children":[{"type":"text","data":"&lt;/p>"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}}],"name":"span","attribs":{"className":"token template-string"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"join"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"''"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"对此进行编程即可实现功能。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"很显然，忽略差异会做更多的事，不忽略差异的本质是：让原 DOM 树走一条路径变成新的 DOM 树。"}],"name":"strong","attribs":{}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#虚拟-dom-应运而生","className":"markdownIt-Anchor"}},{"type":"text","data":" 虚拟 DOM 应运而生"}],"name":"h1","attribs":{"id":"虚拟-dom-应运而生"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"从前面的讨论可以知道，忽略差异的话， DOM 会做很多多余的事，要让性能最好，必须找出那条使得让原树变成新树的路径，这样才可以让 DOM 做少一些事，从而使性能更好。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"那么要怎么样才能知道两颗 DOM 树的差异，以及一条从原树到新树的路径？"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"答案是使用虚拟 DOM："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"虚拟 DOM 技术是指用 JavaScript 来表达 DOM 的数据结构，并由一定的算法来找出虚拟 DOM 变化前后的差异，最后将差异应用到真实的 DOM 上，从而达到性能优化的技术目的。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"}],"name":"blockquote","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"特别说明一下：找出旧树和新树的差异，叫做 diff 操作；把路径应用到旧树使其变成新树，叫做 patch 操作。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"这两个操作是虚拟 DOM 的核心操作，实现了这两个操作，虚拟 DOM 就写的七七八八了。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"}],"rawContent":""}}}},"BlogApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"HomeApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"TimeLineApiState":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"SettingApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}},"LaunchpadApi":{"loaded":false,"loading":false,"error":null,"dataMap":{}}}</script>
<!--SCRIPT-->
</body>
</html>
