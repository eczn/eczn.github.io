{"code":0,"data":{"type":"tsx","meta":{"id":"three-body-emulator","title":"三体运动模拟器","time":"2021-06-16T10:33:00.000Z","author":"eczn","type":"article","appTitle":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},"tsxDistPath":"./three-body-emulator/index.blog.js","ssrContent":"<div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">三体运动没有解析解，这种遵循物理定律的混沌运动很适合用来做屏保，如:</div><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div style=\"height:300px\" class=\"std-window-content\"><canvas style=\"display:block;margin:0 auto\" width=\"320\" height=\"300\"></canvas></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div><h1 id=\"point\" class=\"std-title --fontTitle\"><a href=\"#point\" class=\"markdownIt-Anchor\">#</a> 质点<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">将星球运动简化为质点，有二维坐标及速度向量，最后加上其质量:</div><div class=\"std-code\"><pre class=\"prismjs tsx rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token comment\">// point-static.ts</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PointStatic</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>  <span class=\"token comment\">/** 坐标 x */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>  x<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  <span class=\"token comment\">/** 坐标 y */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  y<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  <span class=\"token comment\">/** 速度向量 x */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span>  dx<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>  <span class=\"token comment\">/** 速度向量 y */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span>  dy<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>  <span class=\"token comment\">/** 质量 */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>  m<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"position\" class=\"std-title --fontTitle\"><a href=\"#position\" class=\"markdownIt-Anchor\">#</a> 速度对坐标, 引力对速度<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">速度对坐标的影响比较容易处理将上面的定义的 PointStatic 结构进行 (p.x += p.dx) 即可, 而引力对速度的影响, 则要计算加速度 (f = ma) 以及展开后在二维上的分量进行累加才行</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">这里有个情况需要注意，因为是质点，所以距离近的时候力会瞬间增大到无穷导致 number 溢出或者除 0 出现的 NaN, 所以要做最小距离处理</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">具体实现如下</div><div class=\"std-code\"><pre class=\"prismjs tsx rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token comment\">// point.ts</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PointStatic <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./point-static'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Point</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">PointStatic</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span>  <span class=\"token keyword\">public</span> x<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  <span class=\"token keyword\">public</span> y<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  <span class=\"token keyword\">public</span> dx<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span>  <span class=\"token keyword\">public</span> dy<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>  <span class=\"token keyword\">public</span> m<span class=\"token operator\">!</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">:</span> PointStatic<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>    Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">13</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">14</span>  <span class=\"token comment\">/** 当前速度对坐标的影响 */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">15</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">16</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dx<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">17</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dy<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">18</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">19</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">20</span>  <span class=\"token comment\">/**\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">21</span>   * p 和 this 间的引力对 this 速度影响\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">22</span>   * @param p 其他点\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">23</span>   * @param g 引力常数\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">24</span>   */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">25</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">effect</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">:</span> Point<span class=\"token punctuation\">,</span> g<span class=\"token operator\">:</span> number<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">26</span>    <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">distance</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">27</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">28</span>    <span class=\"token keyword\">const</span> distanceX <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">29</span>    <span class=\"token keyword\">const</span> distanceY <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">30</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">31</span>    <span class=\"token comment\">// f = ma 展开后可以得到 a = g * p.m / (r * r)</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">32</span>    <span class=\"token comment\">// 这个 a 是带方向的，它的方向跟 this -> p 练成的线的方向是一致的</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">33</span>    <span class=\"token comment\">// 根据这个来做 x y 方向的分量拆解得到 k 最后得到各分量 ax ay</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">34</span>    <span class=\"token keyword\">const</span> k <span class=\"token operator\">=</span> g <span class=\"token operator\">*</span> p<span class=\"token punctuation\">.</span>m <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">*</span> r <span class=\"token operator\">*</span> r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">35</span>    <span class=\"token keyword\">const</span> ax <span class=\"token operator\">=</span> k <span class=\"token operator\">*</span> distanceX<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">36</span>    <span class=\"token keyword\">const</span> ay <span class=\"token operator\">=</span> k <span class=\"token operator\">*</span> distanceY<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">37</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">38</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dx <span class=\"token operator\">+=</span> ax<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">39</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dy <span class=\"token operator\">+=</span> ay<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">40</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">41</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">42</span>  <span class=\"token comment\">/** 求与 p1 的距离 */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">43</span>  <span class=\"token keyword\">private</span> <span class=\"token function\">distance</span><span class=\"token punctuation\">(</span>p1<span class=\"token operator\">:</span> Point<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> number <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">44</span>    <span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> p1<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">45</span>    <span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> p1<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">46</span>    <span class=\"token keyword\">const</span> yy <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> y<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">47</span>    <span class=\"token keyword\">const</span> xx <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">48</span>    <span class=\"token keyword\">const</span> rr <span class=\"token operator\">=</span> yy <span class=\"token operator\">+</span> xx<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">49</span>    <span class=\"token comment\">// 最小距离</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">50</span>    <span class=\"token keyword\">const</span> min <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">51</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rr <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>min <span class=\"token operator\">*</span> min<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">52</span>    <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>rr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">53</span>    <span class=\"token keyword\">return</span> r<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">54</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">55</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">56</span>  <span class=\"token comment\">/** 根据 m 给一个合适的半径 方便绘图 */</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">57</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">getPointRadius</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> number <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">58</span>    <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">59</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">&lt;=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 最小值 免得太小了看不到了</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">60</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r <span class=\"token operator\">>=</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 免得太大了</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">61</span>    <span class=\"token keyword\">return</span> r <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">62</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">63</span><span class=\"token punctuation\">}</span></pre></div><h1 id=\"draw-and-multi-points\" class=\"std-title --fontTitle\"><a href=\"#draw-and-multi-points\" class=\"markdownIt-Anchor\">#</a> 绘图控制 &amp; 多质点<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-code\"><pre class=\"prismjs tsx rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span><span class=\"token comment\">// gravity.tsx</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">01</span><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PointStatic <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./point-static'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">02</span><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Point <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./point'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">03</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">04</span><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">GravityOptions</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">05</span>  points<span class=\"token operator\">:</span> PointStatic<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 各个点的实例</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">06</span>  g<span class=\"token operator\">?</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 引力常数</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">07</span><span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">08</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">09</span><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Gravity</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">10</span>  <span class=\"token keyword\">public</span> $dom<span class=\"token operator\">!</span><span class=\"token operator\">:</span> HTMLCanvasElement<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">11</span>  <span class=\"token keyword\">public</span> c2d<span class=\"token operator\">!</span><span class=\"token operator\">:</span> CanvasRenderingContext2D<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">12</span>  <span class=\"token keyword\">public</span> g<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">13</span>  <span class=\"token keyword\">public</span> points<span class=\"token operator\">:</span> Point<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">14</span>  <span class=\"token keyword\">public</span> timer<span class=\"token operator\">:</span> ReturnType<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> requestAnimationFrame<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">15</span>  <span class=\"token keyword\">public</span> drawLine <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">16</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">17</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>opts<span class=\"token operator\">:</span> GravityOptions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">18</span>    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> points<span class=\"token punctuation\">,</span> g <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> opts<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">19</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>g <span class=\"token operator\">=</span> g <span class=\"token operator\">||</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">20</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initFromPoints</span><span class=\"token punctuation\">(</span>points<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">21</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">22</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">23</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">initFromPoints</span><span class=\"token punctuation\">(</span>points<span class=\"token operator\">:</span> PointStatic<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">24</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points <span class=\"token operator\">=</span> points<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">25</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">26</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">27</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">addPoint</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">:</span> PointStatic<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">28</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">29</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">30</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">31</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">setDom</span><span class=\"token punctuation\">(</span>$dom<span class=\"token operator\">:</span> HTMLCanvasElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">32</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$dom <span class=\"token operator\">=</span> $dom<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">33</span>    <span class=\"token keyword\">const</span> c2d <span class=\"token operator\">=</span> $dom<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">34</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>c2d<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'no 2d context'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">35</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d <span class=\"token operator\">=</span> c2d<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">36</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">37</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">38</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">updatePointsInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">39</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">40</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>otherP <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">41</span>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>otherP <span class=\"token operator\">===</span> p<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 排除自己</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">42</span>        p<span class=\"token punctuation\">.</span><span class=\"token function\">effect</span><span class=\"token punctuation\">(</span>otherP<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>g<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">43</span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">44</span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">45</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">46</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">47</span>      p<span class=\"token punctuation\">.</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">48</span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">49</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">50</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">51</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">drawPoints</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">52</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$dom<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$dom<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">53</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'rgba(77, 77, 77, 1)'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">54</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">55</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">56</span>      <span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span><span class=\"token function\">getPointRadius</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">57</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">58</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">59</span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">60</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">61</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>drawLine<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">62</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">63</span>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">lineTo</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">64</span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">65</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">66</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">lineTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>points<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">67</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'rgba(77, 77, 77, 0.3)'</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">68</span>      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>c2d<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">69</span>    <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">70</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">71</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">72</span>  <span class=\"token keyword\">public</span> <span class=\"token function\">toggleDrawLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">73</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>drawLine <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>drawLine<span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">74</span>  <span class=\"token punctuation\">}</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">75</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">76</span>  <span class=\"token keyword\">public</span> <span class=\"token function-variable function\">start</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">77</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">78</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">79</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">80</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">81</span>  <span class=\"token keyword\">public</span> <span class=\"token function-variable function\">stop</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">82</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">83</span>    <span class=\"token function\">cancelAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">84</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">85</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">86</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">87</span>  <span class=\"token keyword\">public</span> <span class=\"token function-variable function\">render</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">88</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updatePointsInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">89</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">drawPoints</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">90</span>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer <span class=\"token operator\">=</span> <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">91</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"line-numbers-rows\" style=\"user-select: none;\">92</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></pre></div><h1 id=\"playground\" class=\"std-title --fontTitle\"><a href=\"#playground\" class=\"markdownIt-Anchor\">#</a> playground<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">调整参数控制, 建议保持动量和为 0, 不然会跑到画布之外</div><div><textarea style=\"font-family:consolas, Menlo;width:100%;height:300px\">[\n  {\n    &quot;x&quot;: 150,\n    &quot;y&quot;: 80,\n    &quot;m&quot;: 100,\n    &quot;dx&quot;: 6,\n    &quot;dy&quot;: 0\n  },\n  {\n    &quot;x&quot;: 150,\n    &quot;y&quot;: 150,\n    &quot;m&quot;: 100,\n    &quot;dx&quot;: -6,\n    &quot;dy&quot;: 0\n  },\n  {\n    &quot;x&quot;: 150,\n    &quot;y&quot;: 200,\n    &quot;m&quot;: 100,\n    &quot;dx&quot;: 0,\n    &quot;dy&quot;: 0\n  }\n]</textarea></div><div class=\"std-window mode-windowed\"><div class=\"std-window-menus\"><div class=\"std-window-title\"></div><div class=\"std-window-btns\"><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div><div class=\"std-icon std-window-menu-btn\" style=\"overflow:hidden;border-radius:1em;box-sizing:border-box\"></div></div></div><div style=\"height:300px\" class=\"std-window-content\"><canvas style=\"display:block;margin:0 auto\" width=\"320\" height=\"300\"></canvas></div></div><div style=\"display:none;height:0px;background:#BBB\">placeholder</div>","props":{"codePointStatic":"// point-static.ts\nexport interface PointStatic {\n  /** 坐标 x */\n  x: number;\n  /** 坐标 y */\n  y: number;\n  /** 速度向量 x */\n  dx: number;\n  /** 速度向量 y */\n  dy: number;\n  /** 质量 */\n  m: number;\n}\n","codePoint":"// point.ts\nimport { PointStatic } from './point-static';\n\nexport class Point implements PointStatic {\n  public x!: number;\n  public y!: number;\n  public dx!: number;\n  public dy!: number;\n  public m!: number;\n\n  public constructor(data: PointStatic) {\n    Object.assign(this, data);\n  }\n\n  /** 当前速度对坐标的影响 */\n  public move() {\n    this.x += this.dx;\n    this.y += this.dy;\n  }\n\n  /**\n   * p 和 this 间的引力对 this 速度影响\n   * @param p 其他点\n   * @param g 引力常数\n   */\n  public effect(p: Point, g: number) {\n    const r = this.distance(p);\n\n    const distanceX = p.x - this.x;\n    const distanceY = p.y - this.y;\n\n    // f = ma 展开后可以得到 a = g * p.m / (r * r)\n    // 这个 a 是带方向的，它的方向跟 this -> p 练成的线的方向是一致的\n    // 根据这个来做 x y 方向的分量拆解得到 k 最后得到各分量 ax ay\n    const k = g * p.m / (r * r * r);\n    const ax = k * distanceX;\n    const ay = k * distanceY;\n\n    this.dx += ax;\n    this.dy += ay;\n  }\n\n  /** 求与 p1 的距离 */\n  private distance(p1: Point): number {\n    const y = this.y - p1.y;\n    const x = this.x - p1.x;\n    const yy = y * y;\n    const xx = x * x;\n    const rr = yy + xx;\n    // 最小距离\n    const min = 100;\n    if (rr <= (min * min)) return 100;\n    const r = Math.sqrt(rr);\n    return r;\n  }\n\n  /** 根据 m 给一个合适的半径 方便绘图 */\n  public getPointRadius(): number {\n    const r = Math.sqrt(this.m);\n    if (r <= 4) return 2; // 最小值 免得太小了看不到了\n    if (r >= 24) return 12; // 免得太大了\n    return r / 2;\n  }\n}\n","codeGravity":"// gravity.tsx\nimport { PointStatic } from './point-static';\nimport { Point } from './point';\n\nexport interface GravityOptions {\n  points: PointStatic[]; // 各个点的实例\n  g?: number; // 引力常数\n}\n\nexport class Gravity {\n  public $dom!: HTMLCanvasElement;\n  public c2d!: CanvasRenderingContext2D;\n  public g: number;\n  public points: Point[] = [];\n  public timer: ReturnType<typeof requestAnimationFrame> | null = null;\n  public drawLine = false;\n\n  public constructor(opts: GravityOptions) {\n    const { points, g } = opts;\n    this.g = g || 1;\n    this.initFromPoints(points);\n  }\n\n  public initFromPoints(points: PointStatic[]) {\n    this.points = points.map(p => new Point(p));\n  }\n\n  public addPoint(p: PointStatic) {\n    this.points.push(new Point(p));\n  }\n\n  public setDom($dom: HTMLCanvasElement) {\n    this.$dom = $dom;\n    const c2d = $dom.getContext('2d')!;\n    if (!c2d) throw new Error('no 2d context');\n    this.c2d = c2d;\n  }\n\n  public updatePointsInfo() {\n    this.points.forEach(p => {\n      this.points.forEach(otherP => {\n        if (otherP === p) return; // 排除自己\n        p.effect(otherP, this.g);\n      });\n    });\n\n    this.points.forEach(p => {\n      p.move();\n    });\n  }\n\n  public drawPoints() {\n    this.c2d.clearRect(0, 0, this.$dom.width, this.$dom.height);\n    this.c2d.fillStyle = 'rgba(77, 77, 77, 1)';\n    this.points.forEach(p => {\n      this.c2d.beginPath();\n      const r = p.getPointRadius();\n      this.c2d.arc(p.x, p.y, r, 0, Math.PI * 2);\n      this.c2d.fill();\n    });\n\n    if (this.drawLine) {\n      this.points.forEach((p, idx) => {\n        this.c2d.lineTo(p.x, p.y);\n      });\n\n      this.c2d.lineTo(this.points[0].x, this.points[0].y);\n      this.c2d.fillStyle = 'rgba(77, 77, 77, 0.3)';\n      this.c2d.fill();\n    }\n  }\n\n  public toggleDrawLine() {\n    this.drawLine = !this.drawLine;\n  }\n\n  public start = () => {\n    if (this.timer) return;\n    this.render();\n  };\n\n  public stop = () => {\n    if (!this.timer) return;\n    cancelAnimationFrame(this.timer);\n    this.timer = null;\n  };\n\n  public render = () => {\n    this.updatePointsInfo();\n    this.drawPoints();\n    this.timer = requestAnimationFrame(this.render);\n  };\n};"},"tocStack":[{"id":"point","level":1,"text":"质点"},{"id":"position","level":1,"text":"速度对坐标, 引力对速度"},{"id":"draw-and-multi-points","level":1,"text":"绘图控制 & 多质点"},{"id":"playground","level":1,"text":"playground"}]}}