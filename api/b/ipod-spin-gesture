{"code":0,"data":{"type":"tsx","meta":{"id":"ipod-spin-gesture","title":"iPod 转盘手势","author":"eczn","time":"2023-11-19T17:20:00.000Z","type":"article","appTitle":"","appIcon":"","intro":"未定义 intro","category":"未分类标题","cateIntro":"该分类暂无介绍 ~","imgs":[],"tags":[],"isDraft":false,"fileDeps":[],"wordCount":0},"tsxDistPath":"./ipod-spin-gesture/index.blog.js","ssrContent":"<style>.clickwheel-demo {\n  margin-left: auto;\n  margin-right: auto;\n  margin-bottom: 1em;\n  text-align: center;\n}\n\n/* .clickwheel-demo > * {\n  display: inline-block;\n  margin: 0 1em;\n  vertical-align: middle;\n} */\n\n.clickwheel-circle {\n  position: relative;\n  display: inline-block;\n  width: 20em;\n  height: 20em;\n  background-color: #DDD;\n  border-radius: 100%;\n  touch-action: none;\n}\n\n.clickwheel-circle::after {\n  content: \"\";\n  display: block;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  height: 0.5em;\n  width: 0.5em;\n  background: #B66;\n  border-radius: 100%;\n}\n</style><div class=\"std-img-dynamic-wrapper --fontArticle\" style=\"width:28%;float:left;margin-right:1.5em;margin-bottom:1em\"><div class=\"std-img-dynamic\" data-minimap=\"Rect\" style=\"padding-bottom:164.58%\"><img class=\"std-img-dymanic-main r-link __mosaic __loading\" src=\"/tsxs-esm/ipod6g.4fa04433927f6bd3.png.mosaic.png\"/><img class=\"std-img-dymanic-main\" src=\"/tsxs-esm/ipod6g.4fa04433927f6bd3.png\"/></div></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\"><span class=\"std-sinking --fontTitle\">i</span>Pod 最伟大的设计即是它提供的 ClickWheel 转盘交互，它是 iPod 的核心竞争力。<br/>在近年智能手机流行后, iPod 就逐渐淡出大众了, 但是它所代表的产品精神 / 体验让我着迷，因此我决定在屏幕上也实现一个 ClickWheel 交互手势。</div><h1 id=\"polar-coordinate-system\" class=\"std-title --fontTitle\"><a href=\"#polar-coordinate-system\" class=\"markdownIt-Anchor\">#</a> 极坐标系<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">很显然，屏幕上的鼠标/手指操作是 ClickWheel 的超集, 也就是说 touch 和 mouse 事件组完全能模拟出转盘手势，为了后续方便处理，首先我们需要抹平两个事件组的差异 —— 需要数抹平 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">MouseEvent</div> 和 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">TouchEvent</div> 的差异并从中取出点击的位置坐标：</div><div class=\"std-code\"><pre  class=\"prismjs ts rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span>__NO_CODE__</pre></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">考虑到转盘手势核心参数是 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">转动角度</div>, 此概念在二维坐标系中不能直接描述, 需要取出 x y 进行计算得到，为了实现的简洁和外部使用方便，最好使用 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">极坐标系</div> 来实现和构造 ClickWheel 手势。</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">极坐标系如下左图所示, 从 P1 转动到 P2, 如下左图所示，其中 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">(∠A, r1)</div> 代表 P1 点相对于圆心 x 轴的角度, r1 代表离圆心的距离。</div><div class=\"col-main\" style=\"display:flex;margin-bottom:16px\"><div style=\"width:50%;text-align:justify;box-sizing:border-box;padding-left:8px;padding-right:8px\"><div class=\"std-img-dynamic-wrapper --fontArticle\"><div class=\"std-img-dynamic\" data-minimap=\"Rect\" style=\"padding-bottom:100.00%\"><div class=\"std-img-dymanic-main __texttip __loading\">loading...</div><img class=\"std-img-dymanic-main\" src=\"data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3C!DOCTYPE%20svg%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20SVG%201.1%2F%2FEN%22%20%22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11.dtd%22%3E%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20version%3D%221.1%22%20width%3D%22643px%22%20height%3D%22643px%22%20viewBox%3D%22-0.5%20-0.5%20643%20643%22%3E%3Cdefs%2F%3E%3Cg%3E%3Cellipse%20cx%3D%22320%22%20cy%3D%22320%22%20rx%3D%22240%22%20ry%3D%22240%22%20fill%3D%22none%22%20stroke%3D%22%23b8b8b8%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Crect%20x%3D%22346%22%20y%3D%22306%22%20width%3D%2280%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20168px%3B%20margin-left%3A%20193px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3E%E2%88%A0B%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22193%22%20y%3D%22172%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3E%E2%88%A0B%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Crect%20x%3D%22322%22%20y%3D%22268%22%20width%3D%2280%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20149px%3B%20margin-left%3A%20181px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3E%E2%88%A0A%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22181%22%20y%3D%22153%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3E%E2%88%A0A%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Cpath%20d%3D%22M%20320%20640%20L%20320%200%22%20fill%3D%22none%22%20stroke%3D%22%23b8b8b8%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%200%20320%20L%20640%20320%22%20fill%3D%22none%22%20stroke%3D%22%23b8b8b8%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%20320%20320%20L%20480%2060%22%20fill%3D%22none%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%20320%20320%20L%20580%20480%22%20fill%3D%22none%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%20468.48%20236%20L%20496.48%20255.48%20L%20468.48%20274.96%20L%20468.48%20261.56%20C%20415.2%20261.56%20372%20308.1%20372%20365.52%20C%20372%20301.39%20415.2%20249.4%20468.48%20249.4%20Z%22%20fill%3D%22%23b8b8b8%22%20stroke%3D%22none%22%20transform%3D%22rotate%28120%2C434.24%2C300.76%29%22%20pointer-events%3D%22all%22%2F%3E%3Crect%20x%3D%22442%22%20y%3D%2274%22%20width%3D%22180%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%2052px%3B%20margin-left%3A%20266px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3EP1%3A%20%28%E2%88%A0A%2C%20r1%29%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22266%22%20y%3D%2256%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3EP1%3A%20%28%E2%88%A0A%2C%20r1%29%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Crect%20x%3D%22404%22%20y%3D%22468%22%20width%3D%22180%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20249px%3B%20margin-left%3A%20247px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3EP2%3A%20%28%E2%88%A0B%2C%20r2%29%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22247%22%20y%3D%22253%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3EP2%3A%20%28%E2%88%A0B%2C%20r2%29%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Cellipse%20cx%3D%22479%22%20cy%3D%2261%22%20rx%3D%225%22%20ry%3D%225%22%20fill%3D%22%230d0d0d%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Cellipse%20cx%3D%22581%22%20cy%3D%22479%22%20rx%3D%225%22%20ry%3D%225%22%20fill%3D%22%230d0d0d%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3C%2Fg%3E%3Cswitch%3E%3Cg%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%2F%3E%3Ca%20transform%3D%22translate%280%2C-5%29%22%20xlink%3Ahref%3D%22https%3A%2F%2Fwww.diagrams.net%2Fdoc%2Ffaq%2Fsvg-export-text-problems%22%20target%3D%22_blank%22%3E%3Ctext%20text-anchor%3D%22middle%22%20font-size%3D%2210px%22%20x%3D%2250%25%22%20y%3D%22100%25%22%3EText%20is%20not%20SVG%20-%20cannot%20display%3C%2Ftext%3E%3C%2Fa%3E%3C%2Fswitch%3E%3C%2Fsvg%3E\"/></div></div></div><div style=\"width:50%;text-align:justify;box-sizing:border-box;padding-left:8px;padding-right:8px\"><div class=\"std-img-dynamic-wrapper --fontArticle\"><div class=\"std-img-dynamic\" data-minimap=\"Rect\" style=\"padding-bottom:100.00%\"><div class=\"std-img-dymanic-main __texttip __loading\">loading...</div><img class=\"std-img-dymanic-main\" src=\"data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3C!DOCTYPE%20svg%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20SVG%201.1%2F%2FEN%22%20%22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11.dtd%22%3E%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20version%3D%221.1%22%20width%3D%22643px%22%20height%3D%22643px%22%20viewBox%3D%22-0.5%20-0.5%20643%20643%22%3E%3Cdefs%2F%3E%3Cg%3E%3Cellipse%20cx%3D%22320%22%20cy%3D%22320%22%20rx%3D%22240%22%20ry%3D%22240%22%20fill%3D%22none%22%20stroke%3D%22%23c4c4c4%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Cpath%20d%3D%22M%20320%20640%20L%20320%200%22%20fill%3D%22none%22%20stroke%3D%22%23c4c4c4%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%200%20320%20L%20640%20320%22%20fill%3D%22none%22%20stroke%3D%22%23c9c9c9%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%20320%20320%20L%20480%2060%22%20fill%3D%22none%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%20320%20320%20L%20584%20444%22%20fill%3D%22none%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%20468.48%20236%20L%20496.48%20255.48%20L%20468.48%20274.96%20L%20468.48%20261.56%20C%20415.2%20261.56%20372%20308.1%20372%20365.52%20C%20372%20301.39%20415.2%20249.4%20468.48%20249.4%20Z%22%20fill%3D%22%23c4c4c4%22%20stroke%3D%22none%22%20transform%3D%22rotate%28120%2C434.24%2C300.76%29%22%20pointer-events%3D%22all%22%2F%3E%3Cellipse%20cx%3D%22479%22%20cy%3D%2261%22%20rx%3D%225%22%20ry%3D%225%22%20fill%3D%22%230d0d0d%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Cellipse%20cx%3D%22583%22%20cy%3D%22443%22%20rx%3D%225%22%20ry%3D%225%22%20fill%3D%22%230d0d0d%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Cpath%20d%3D%22M%20317.2%20285.19%20C%20299.28%20274.1%20276.59%20276.3%20260.91%20290.64%20C%20245.23%20304.99%20240.09%20328.25%20248.16%20348.35%20C%20256.23%20368.46%20275.69%20380.88%20296.44%20379.17%20C%20317.19%20377.46%20334.56%20362.01%20339.53%20340.83%22%20fill%3D%22none%22%20stroke%3D%22%23c4c4c4%22%20stroke-width%3D%228%22%20stroke-miterlimit%3D%2210%22%20transform%3D%22rotate%2820.7%2C294%2C328.68%29%22%20pointer-events%3D%22all%22%2F%3E%3Cpath%20d%3D%22M%20334.71%20340.83%20L%20341.94%20328.18%20L%20344%20343.35%20Z%22%20fill%3D%22%23c4c4c4%22%20stroke%3D%22%23c4c4c4%22%20stroke-width%3D%228%22%20stroke-miterlimit%3D%2210%22%20transform%3D%22rotate%2820.7%2C294%2C328.68%29%22%20pointer-events%3D%22all%22%2F%3E%3Crect%20x%3D%22360%22%20y%3D%22264%22%20width%3D%22120%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%2058px%3B%20height%3A%201px%3B%20padding-top%3A%20147px%3B%20margin-left%3A%20181px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20normal%3B%20overflow-wrap%3A%20normal%3B%22%3E%E9%94%90%E8%A7%92%3F%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22210%22%20y%3D%22151%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3E%E9%94%90%E8%A7%92%3F%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Crect%20x%3D%22156%22%20y%3D%22340%22%20width%3D%22120%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20185px%3B%20margin-left%3A%20108px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3E%E9%92%9D%E8%A7%92%EF%BC%9F%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22108%22%20y%3D%22189%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3E%E9%92%9D%E8%A7%92%EF%BC%9F%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Crect%20x%3D%22460%22%20y%3D%2274%22%20width%3D%2280%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%2052px%3B%20margin-left%3A%20250px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3EP1%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22250%22%20y%3D%2256%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3EP1%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Crect%20x%3D%22506%22%20y%3D%22436%22%20width%3D%2280%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20233px%3B%20margin-left%3A%20273px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3EP2%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22273%22%20y%3D%22237%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3EP2%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3C%2Fg%3E%3Cswitch%3E%3Cg%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%2F%3E%3Ca%20transform%3D%22translate%280%2C-5%29%22%20xlink%3Ahref%3D%22https%3A%2F%2Fwww.diagrams.net%2Fdoc%2Ffaq%2Fsvg-export-text-problems%22%20target%3D%22_blank%22%3E%3Ctext%20text-anchor%3D%22middle%22%20font-size%3D%2210px%22%20x%3D%2250%25%22%20y%3D%22100%25%22%3EText%20is%20not%20SVG%20-%20cannot%20display%3C%2Ftext%3E%3C%2Fa%3E%3C%2Fswitch%3E%3C%2Fsvg%3E\"/></div></div></div></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">上右图也表明了，由于圆的周期性质，从 P1 到 P2 可以有无数种方式，比如转三圈后再转一个锐角这样，或者逆时针转一个钝角，这样的周期性质还会导致反三角函数求不出大于 180 度的角，需要手动去加一个半圆</div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">下图描述了从 P0 转到 P1 再到 P2 的过程, 由于周期性的原因，用反三角函数计算 P2 的极坐标角度的时候 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">∠1+∠2</div> 的计算结果跟 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">∠1</div> 一样 (其实算出来的结果就是 ∠3)，因此需要在代码里额外判断当 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">y&lt;0</div> 的时候计算 ∠3 的补角。</div><div class=\"col-main\" style=\"display:flex;margin-bottom:16px\"><div style=\"width:25%;text-align:justify;box-sizing:border-box;padding-left:8px;padding-right:8px\"><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\"></div></div><div style=\"width:50%;text-align:justify;box-sizing:border-box;padding-left:8px;padding-right:8px\"><div class=\"std-img-dynamic-wrapper --fontArticle\"><div class=\"std-img-dynamic\" data-minimap=\"Rect\" style=\"padding-bottom:98.02%\"><div class=\"std-img-dymanic-main __texttip __loading\">loading...</div><img class=\"std-img-dymanic-main\" src=\"data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3C!DOCTYPE%20svg%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20SVG%201.1%2F%2FEN%22%20%22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11.dtd%22%3E%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20version%3D%221.1%22%20width%3D%22656px%22%20height%3D%22643px%22%20viewBox%3D%22-0.5%20-0.5%20656%20643%22%3E%3Cdefs%2F%3E%3Cg%3E%3Cellipse%20cx%3D%22320%22%20cy%3D%22320%22%20rx%3D%22239.99999999999997%22%20ry%3D%22239.99999999999997%22%20fill%3D%22none%22%20stroke%3D%22%23c4c4c4%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Cpath%20d%3D%22M%20320%20640%20L%20320%200%22%20fill%3D%22none%22%20stroke%3D%22%23c4c4c4%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%200%20320%20L%20640%20320%22%20fill%3D%22none%22%20stroke%3D%22%23c9c9c9%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%20320%20320%20L%2070%20186%22%20fill%3D%22none%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cpath%20d%3D%22M%20320%20320%20L%2068%20416%22%20fill%3D%22none%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Cellipse%20cx%3D%2269%22%20cy%3D%22185%22%20rx%3D%225%22%20ry%3D%225%22%20fill%3D%22%230d0d0d%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Cellipse%20cx%3D%2269%22%20cy%3D%22415%22%20rx%3D%225%22%20ry%3D%225%22%20fill%3D%22%230d0d0d%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Crect%20x%3D%2260%22%20y%3D%22134%22%20width%3D%22160%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%2082px%3B%20margin-left%3A%2070px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3EP1%3A%20%28%E2%88%A01%2C%20r%29%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%2270%22%20y%3D%2286%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3EP1%3A%20%28%E2%88%A01%2C%20r%29%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Crect%20x%3D%2248%22%20y%3D%22408%22%20width%3D%22200%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20219px%3B%20margin-left%3A%2074px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3EP2%3A%20%28%E2%88%A01%2B%E2%88%A02%2C%20r%29%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%2274%22%20y%3D%22223%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3EP2%3A%20%28%E2%88%A01%2B%E2%88%A02%2C%20r%29%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Cpath%20d%3D%22M%20348.24%20222%20L%20376.24%20241.48%20L%20348.24%20260.96%20L%20348.24%20247.56%20C%20307.24%20247.56%20274%20285.37%20274%20332%20C%20274%20278.65%20307.24%20235.4%20348.24%20235.4%20Z%22%20fill%3D%22%23c4c4c4%22%20stroke%3D%22none%22%20transform%3D%22translate%280%2C277%29scale%281%2C-1%29translate%280%2C-277%29rotate%28195%2C325.12%2C277%29%22%20pointer-events%3D%22all%22%2F%3E%3Cpath%20d%3D%22M%20166.32%20270.66%20L%20194.32%20290.14%20L%20166.32%20309.62%20L%20166.32%20296.22%20C%20126.56%20296.22%2094.32%20325.07%2094.32%20360.66%20C%2094.32%20318.35%20126.56%20284.06%20166.32%20284.06%20Z%22%20fill%3D%22%23c4c4c4%22%20stroke%3D%22none%22%20transform%3D%22translate%28144.32%2C0%29scale%28-1%2C1%29translate%28-144.32%2C0%29rotate%28140%2C144.32%2C315.66%29%22%20pointer-events%3D%22all%22%2F%3E%3Cpath%20d%3D%22M%20600%20320%20L%20320%20320%22%20fill%3D%22none%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20stroke-miterlimit%3D%2210%22%20pointer-events%3D%22stroke%22%2F%3E%3Crect%20x%3D%22514%22%20y%3D%22264%22%20width%3D%22140%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20147px%3B%20margin-left%3A%20292px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3EP0%3A%20%280%2C%20r%29%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22292%22%20y%3D%22151%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3EP0%3A%20%280%2C%20r%29%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Cellipse%20cx%3D%22601%22%20cy%3D%22321%22%20rx%3D%225%22%20ry%3D%225%22%20fill%3D%22%230d0d0d%22%20stroke%3D%22rgb%280%2C%200%2C%200%29%22%20stroke-width%3D%222%22%20pointer-events%3D%22all%22%2F%3E%3Crect%20x%3D%22276%22%20y%3D%22316%22%20width%3D%2280%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20173px%3B%20margin-left%3A%20158px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3E%E2%88%A03%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22158%22%20y%3D%22177%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3E%E2%88%A03%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Crect%20x%3D%22286%22%20y%3D%22264%22%20width%3D%2280%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20147px%3B%20margin-left%3A%20163px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3E%E2%88%A01%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22163%22%20y%3D%22151%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3E%E2%88%A01%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3Crect%20x%3D%22206%22%20y%3D%22290%22%20width%3D%2280%22%20height%3D%2260%22%20fill%3D%22none%22%20stroke%3D%22none%22%20pointer-events%3D%22all%22%2F%3E%3Cg%20transform%3D%22translate%28-0.5%20-0.5%29scale%282%29%22%3E%3Cswitch%3E%3CforeignObject%20pointer-events%3D%22none%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%20style%3D%22overflow%3A%20visible%3B%20text-align%3A%20left%3B%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22display%3A%20flex%3B%20align-items%3A%20unsafe%20center%3B%20justify-content%3A%20unsafe%20center%3B%20width%3A%201px%3B%20height%3A%201px%3B%20padding-top%3A%20160px%3B%20margin-left%3A%20123px%3B%22%3E%3Cdiv%20data-drawio-colors%3D%22color%3A%20rgb%280%2C%200%2C%200%29%3B%20%22%20style%3D%22box-sizing%3A%20border-box%3B%20font-size%3A%200px%3B%20text-align%3A%20center%3B%22%3E%3Cdiv%20style%3D%22display%3A%20inline-block%3B%20font-size%3A%2012px%3B%20font-family%3A%20Helvetica%3B%20color%3A%20rgb%280%2C%200%2C%200%29%3B%20line-height%3A%201.2%3B%20pointer-events%3A%20all%3B%20white-space%3A%20nowrap%3B%22%3E%E2%88%A02%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3Ctext%20x%3D%22123%22%20y%3D%22164%22%20fill%3D%22rgb%280%2C%200%2C%200%29%22%20font-family%3D%22Helvetica%22%20font-size%3D%2212px%22%20text-anchor%3D%22middle%22%3E%E2%88%A02%3C%2Ftext%3E%3C%2Fswitch%3E%3C%2Fg%3E%3C%2Fg%3E%3Cswitch%3E%3Cg%20requiredFeatures%3D%22http%3A%2F%2Fwww.w3.org%2FTR%2FSVG11%2Ffeature%23Extensibility%22%2F%3E%3Ca%20transform%3D%22translate%280%2C-5%29%22%20xlink%3Ahref%3D%22https%3A%2F%2Fwww.diagrams.net%2Fdoc%2Ffaq%2Fsvg-export-text-problems%22%20target%3D%22_blank%22%3E%3Ctext%20text-anchor%3D%22middle%22%20font-size%3D%2210px%22%20x%3D%2250%25%22%20y%3D%22100%25%22%3EText%20is%20not%20SVG%20-%20cannot%20display%3C%2Ftext%3E%3C%2Fa%3E%3C%2Fswitch%3E%3C%2Fsvg%3E\"/></div></div></div><div style=\"width:25%;text-align:justify;box-sizing:border-box;padding-left:8px;padding-right:8px\"><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\"></div></div></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">从上面的讨论中，可以得到极坐标系的类型定义 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">PolarPoint</div> 以及转换：</div><div class=\"std-code\"><pre  class=\"prismjs ts rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span>__NO_CODE__</pre></div><h1 id=\"jotai\" class=\"std-title --fontTitle\"><a href=\"#jotai\" class=\"markdownIt-Anchor\">#</a> 状态定义<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">先设计类型，由上面的分析决定使用极坐标系来描述 ClickWheel 手势，基于 ADT 的思想进行设计可得：</div><div class=\"std-code\"><pre  class=\"prismjs ts rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span>__NO_CODE__</pre></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">为了方便调试, 还需要有一个打印 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">ClickWheelState</div> 的组件:</div><div class=\"std-code\"><pre  class=\"prismjs ts rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span>__NO_CODE__</pre></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">在上述 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">RenderClickWheelState</div> 中, 当状态变化, current 移动角度增大后, 对于渲染会顺序循环选择 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">DICT</div> 中的元素来展示</div><h1 id=\"demo\" class=\"std-title --fontTitle\"><a href=\"#demo\" class=\"markdownIt-Anchor\">#</a> 完整实现 &amp; Demo<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\"><div class=\"clickwheel-demo\"><div class=\"clickwheel-circle\"></div><div><div>移动角度: 0</div><div style=\"font-size:2rem\">当前选中: A</div></div></div></div><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">完整实现如下, 注意其中换圈的逻辑 (不过我感觉有更好的办法, 目前还不够简洁)</div><div class=\"std-code\"><pre  class=\"prismjs tsx rally-runner  \" ><span class=\"line-numbers-rows\" style=\"user-select: none;\">00</span>__NO_CODE__</pre></div><h1 id=\"end\" class=\"std-title --fontTitle\"><a href=\"#end\" class=\"markdownIt-Anchor\">#</a> 结尾<i data-minimap=\"Ignore\"> ↵ </i></h1><div class=\"std-para --fontArticle\" data-minimap-color=\"#CCCCCC\">至此实现了一个基本的 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">ClickWheel</div> 转盘架子, 就完成度来说还差一点, 还缺一些能力, 比如提供 <div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">onClick</div>、<div class=\"std-inline-code\" data-minimap-color=\"#f5e9e9\">防误触</div> 等等，不过这些倒不是最核心的就是了。</div>","props":{"codePolarPoint":"// polar-point.ts\nimport { Point2D } from './get-event-point';\n\n/** 极坐标系中的点 */\nexport interface PolarPoint {\n  angle: number;\n  radius: number;\n}\n\n/** 将二维坐标 Point2D 转为以原点 (0,0) 为中心的极坐标系 */\nexport function toPolarPoint(p: Point2D) {\n  const { x, y } = p;\n\n  // 三角函数计算构造极坐标点\n  const radius = Math.sqrt(x * x + y * y);\n  const pp: PolarPoint = {\n    angle: (Math.acos(x / radius) * 180 / Math.PI),\n    radius,\n  }\n\n  // 圆的周期性质会导致在第三第四象限计算的角度始终在 0,180 度内\n  // 这种情况应该计算补角\n  if (y < 0) pp.angle = 360 - pp.angle\n\n  // 保证顺时针方向为正\n  pp.angle = 360 - pp.angle;\n  return pp;\n}\n","codeGetEventPoint":"// get-event-point.ts\n\n/** 二维坐标系中的点 */\nexport interface Point2D {\n  x: number;\n  y: number;\n}\n\nexport type FingerEvent = TouchEvent | MouseEvent;\n\n/**\n * 抹平 touch 和 mouse 事件\n * 统一返回事件发生的 Point2D 坐标点\n */\nexport function getEventPoint(e: FingerEvent): Point2D {\n  e.preventDefault();\n  if (e instanceof TouchEvent) {\n    return {\n      x: e.touches[0].clientX,\n      y: e.touches[0].clientY,\n    }\n  }\n\n  return {\n    x: e.clientX,\n    y: e.clientY,\n  };\n}\n\n/**\n * 从 touch 或者 mouse 事件中解析出 Point2D 出来\n * 这个 Point2D 是以 div 的中心点为原点的\n */\nexport function getDivPoint(div: HTMLElement, ep: Point2D) {\n  const rect = div.getBoundingClientRect();\n  // 算出相对位置\n  const offsetX = ep.x - rect.x;\n  const offsetY = ep.y - rect.y;\n\n  // 需要以 div 的中心点为原点, 这样才方便调用 toPolarPoint\n  const x = offsetX - (rect.width / 2);\n  // 为什么是负数呢, 因为浏览器坐标系左上角是原点\n  const y = - (offsetY - (rect.height / 2));\n\n  return { x, y }\n}\n\n","codeClickWHeelState":"// clickwheel-state.tsx\nimport { PolarPoint } from './polar-point';\n\nexport type ClickWheelState =\n  // 未激活\n  | null\n  // 滑动中\n  | {\n    type: 'dragging';\n    /** 起始点 */\n    start: PolarPoint;\n    /** 结束点 */\n    current: PolarPoint;\n  }\n","codeRenderClickWheelState":"import React from 'react';\nimport { ClickWheelState } from './clickwheel-state';\n\nexport function RenderClickWheelState(\n  props: { state: ClickWheelState }\n) {\n  const { state } = props;\n  const dangle = state\n    ? state.current.angle - state.start.angle\n    : 0;\n  \n  const t1 = `移动角度: ${dangle}`;\n  const t2 = `当前选中: ${renderSelect(dangle)}`;\n\n  return (\n    <div>\n      <div>{t1}</div>\n      <div style={{ fontSize: '2rem' }}>{t2}</div>\n    </div>\n  )\n}\n\nconst DICT = `ABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890`\nfunction renderSelect(angle: number) {\n  const n = Math.floor(angle / 30);\n  const idx = n % DICT.length;\n  if (idx < 0) return DICT[DICT.length + idx];\n  return DICT[idx]\n}\n","codeUseClickWheel":"// use-clickwheel.tsx\nimport React from 'react';\nimport { toPolarPoint } from './polar-point';\nimport { ClickWheelState } from './clickwheel-state';\nimport {\n  getEventPoint,\n  getDivPoint,\n  FingerEvent,\n} from './get-event-point';\n\n/**\n * 为 elemRef 处理 clickWheel 相关事件状态\n * @param elemRef 比如一个正方形 div ref\n * @param onSubmit 当 touchend/mouseup 结束事件的时候传出最后一次状态\n * @returns \n */\nexport function useClickWheel(\n  elemRef: React.RefObject<HTMLElement>,\n  onSubmit: (state: ClickWheelState) => void\n) {\n  const [state, setState] = React.useState<ClickWheelState>(null);\n\n  React.useEffect(() => {\n    const elem = elemRef.current;\n    if (!elem) return;\n\n    // 记录当前转了多少圈\n    let circle = 0;\n\n    const onStart = (e: FingerEvent) => {\n      const ep = getEventPoint(e);\n      const p = getDivPoint(elem, ep);\n      const pp = toPolarPoint(p);\n\n      // 重置状态\n      circle = 0;\n      setState({\n        type: 'dragging',\n        start: pp,\n        current: pp,\n      });\n    }\n\n    const onMove = (e: FingerEvent) => {\n      const ep = getEventPoint(e);\n      const p = getDivPoint(elem, ep);\n      const pp = toPolarPoint(p);\n\n      setState(prev => {\n        if (!prev) return null;\n\n        // 圈数多的时候 prev.current.angle 将会大于 360\n        // 需要划定在 [0,360) 之间\n        let prevCurrentAngle = prev.current.angle % 360;\n        if (prevCurrentAngle < 0) prevCurrentAngle += 360;\n\n        // 经过极坐标系 0 度的时候会突变, 此时需要记录圈数\n        let dangle = pp.angle - prevCurrentAngle;\n        let dcircle = 0;\n\n        // 说明是顺时针过 0 点\n        if (dangle <= -330) {\n          dcircle = 1;\n          console.log('+1'); // 方便调试\n        }\n\n        // 说明是逆时针过 0 点\n        if (dangle >= 330) {\n          dcircle = -1;\n          console.log('-1'); // 方便调试\n        }\n\n        const nextCircle = circle + dcircle;\n        circle = nextCircle;\n        // 最新值写入, 下次 onMove 会用\n        pp.angle = nextCircle * 360 + pp.angle;\n\n        return {\n          type: 'dragging',\n          start: prev.start,\n          current: pp,\n        }\n      })\n    }\n\n    const onEnd = (e: FingerEvent) => {\n      setState((prev) => {\n        // 将最后一次状态提交出去\n        onSubmit(prev);\n        return null;\n      });\n    }\n\n    // 需要禁用 passive\n    const options = { passive: false }\n    elem.addEventListener('touchstart', onStart, options);\n    elem.addEventListener('touchmove', onMove, options);\n    elem.addEventListener('touchend', onEnd, options);\n    elem.addEventListener('touchcancel', onEnd, options);\n\n    // mouse 事件组\n    elem.addEventListener('mousedown', onStart, options);\n    elem.addEventListener('mousemove', onMove, options);\n    elem.addEventListener('mouseup', onEnd, options);\n    elem.addEventListener('mouseleave', onEnd, options);\n\n    // 取消副作用\n    return () => {\n      elem.removeEventListener('mousedown', onStart);\n      elem.removeEventListener('mousemove', onMove);\n      elem.removeEventListener('mouseup', onEnd);\n      elem.removeEventListener('touchstart', onStart);\n      elem.removeEventListener('touchmove', onMove);\n      elem.removeEventListener('touchend', onEnd);\n    }\n  }, [elemRef.current]);\n\n  return {\n    state,\n  }\n}\n"},"tocStack":[{"id":"polar-coordinate-system","level":1,"text":"极坐标系"},{"id":"jotai","level":1,"text":"状态定义"},{"id":"demo","level":1,"text":"完整实现 & Demo"},{"id":"end","level":1,"text":"结尾"}]}}