{"code":0,"data":{"categoryId":"Nightive","list":[{"title":"关于音乐播放器的前后端实现的思考","intro":"最近在做音乐播放器，遇到了些有趣的问题。","date":"Sat Sep 23 2017 15:36:57 GMT+0800 (中国标准时间)","category":"Nightive","cateIntro":"Nightive 里面有很多坑 ... 一一实现它们可以学到很多东西","tags":["MP3","ID3"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"type":"article","id":"9a985c5c3746b2145458fd5ce30fb9a6","appTitle":"","author":"eczn","imgs":[],"time":"2017-09-23T07:36:57.000Z","isDraft":false,"fileDeps":["/images/wx-player-ab.png","/images/wx-player-cd.png","/images/wx-player-ef.png"],"wordCount":9773}],"current":{"type":"markdown","meta":{"title":"关于音乐播放器的前后端实现的思考","intro":"最近在做音乐播放器，遇到了些有趣的问题。","date":"Sat Sep 23 2017 15:36:57 GMT+0800 (中国标准时间)","category":"Nightive","cateIntro":"Nightive 里面有很多坑 ... 一一实现它们可以学到很多东西","tags":["MP3","ID3"],"head":false,"headerStyle":["line-height: 314px;"],"headPic":false,"type":"article","id":"9a985c5c3746b2145458fd5ce30fb9a6","appTitle":"","author":"eczn","imgs":[],"time":"2017-09-23T07:36:57.000Z","isDraft":false,"fileDeps":["/images/wx-player-ab.png","/images/wx-player-cd.png","/images/wx-player-ef.png"],"wordCount":9773},"nodes":[{"type":"tag","children":[{"type":"text","data":"自打编程以来，经常性的一个活动就是做音频播放器，以前用 C 做的时候很痛苦，需要管理很多内存和数据结构，也没有图形，后来稍微学了点前端之后就开始做网页版的，收获很多，也做了梦寐以求的时域和频域的音频波谱图，之后学 Java 的时候也做了一个当作课程设计交了上去，最近我琢磨着把播放器搞到小程序上面去。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#方案分析","className":"markdownIt-Anchor"}},{"type":"text","data":" 方案分析"}],"name":"h1","attribs":{"id":"方案分析"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"小程序在音频上的处理并不是很强大，没有提供 Audio 对象做各种音频二进制数据的处理，只提供了一些简单操作，比如暂停，快进之类。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"此外，小程序有两种播放音乐的方式，一种是利用 "},{"type":"tag","children":[{"type":"text","data":"&lt;audio&gt;"}],"name":"code","attribs":{}},{"type":"text","data":" 标签，一种是利用微信背景音乐这类接口。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"一开始我使用了 audio 标签来做，后来我发现，audio 那个并没有提供获取音频时长的 API 可以用，而背景音乐的 "},{"type":"tag","children":[{"type":"text","data":"wx.getBackgroundAudioPlayerState"}],"name":"code","attribs":{}},{"type":"text","data":" 可以获取音频的一些元数据。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"而且，也没有办法在前端获取到音频的专辑封面，因此这方面的工作只能交由后台来做。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"MP3 的音频元数据标准规范是 "},{"type":"tag","children":[{"type":"text","data":"ID1/2/3"}],"name":"code","attribs":{}},{"type":"text","data":", 现在通常我们看到的 MP3 文件都是 ID3 或者 ID3V2 的，我在 NPM 上寻找了一番，最后选择了 "},{"type":"tag","children":[{"type":"text","data":"npm - jsmediatags"}],"name":"a","attribs":{"href":"https://www.npmjs.com/package/jsmediatags"}},{"type":"text","data":" 用于解析 ID3 元数据, 原因如下:"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"支持解析 URL 形式的 MP3 文件 主要是这点"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"它是 "},{"type":"tag","children":[{"type":"text","data":"JavaScript-ID3-Reader"}],"name":"code","attribs":{}},{"type":"text","data":" 的下一代，我之前做的播放器用的就是这个，完全继承了语法，因此看起来不会蛋疼"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"可能有人会问我为什么不在小程序上用 "},{"type":"tag","children":[{"type":"text","data":"JavaScript-ID3-Reader"}],"name":"code","attribs":{}},{"type":"text","data":" ？原因很简单，它是基于 XHR 的，小程序上屏蔽了 XHR 因此无法使用。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[],"name":"hr","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"最后我拟定的方案是："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"前端用户输入音频 URL"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"服务器处理它，得到专辑封面"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"将封面传到七牛静态存储上"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"最后把数据保存在 Mongo 里"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"而且做好缓存，对于同一个 URL 的音频，将首先从数据库中调用，而不是重新处理一遍上面的流程"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#路由设计","className":"markdownIt-Anchor"}},{"type":"text","data":" 路由设计"}],"name":"h1","attribs":{"id":"路由设计"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"拟定路由两个:"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"GET /api/mp3"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"POST /api/mp3"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"第一个用于获取服务器上保存的音乐，第二个则要求用户输入 src 然后服务器处理后续。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"前端需要两个页面："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"/pages/musicList/musicList"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"/pages/music/music?_id=$(MUSIC_ID)"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"一个是列表，一个是音乐播放"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#数据库设计","className":"markdownIt-Anchor"}},{"type":"text","data":" 数据库设计"}],"name":"h1","attribs":{"id":"数据库设计"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"直接上 Mongoose Schemas"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"schemas"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"mp3 "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" mongoose"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"Schema"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"url"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"type"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" String"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"required"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"true"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"picture"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"type"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" String"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"required"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"true"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"info"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"type"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" Object\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"who"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"type"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" mongoose"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"Schema"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"Types"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"ObjectId"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"ref"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'user'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"required"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"true"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"created_at"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"type"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" Date"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"default"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" Date"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"now\n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#readerjs","className":"markdownIt-Anchor"}},{"type":"text","data":" reader.js"}],"name":"h1","attribs":{"id":"readerjs"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"reader.js 暴露函数 "},{"type":"tag","children":[{"type":"text","data":"reader"}],"name":"code","attribs":{}},{"type":"text","data":" ，需要参数 "},{"type":"tag","children":[{"type":"text","data":"src"}],"name":"code","attribs":{}},{"type":"text","data":", 读取 URL 并返回相关数据，这里面有很多异步流程，分别是："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"查询 src 是否在表 mp3 里面，如果有，则直接返回结果，否则走下一步"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"利用 "},{"type":"tag","children":[{"type":"text","data":"jsmediatags"}],"name":"code","attribs":{}},{"type":"text","data":" 读取 ID3 文件头, 得到文件头对象 "},{"type":"tag","children":[{"type":"text","data":"id3"}],"name":"code","attribs":{}}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"从 "},{"type":"tag","children":[{"type":"text","data":"id3"}],"name":"code","attribs":{}},{"type":"text","data":" 里面抽出图片数据（以数组的形式），并转为 "},{"type":"tag","children":[{"type":"text","data":"Buffer"}],"name":"code","attribs":{}},{"type":"text","data":" 最后存储到磁盘上得到该图片路径路径 "},{"type":"tag","children":[{"type":"text","data":"picLocal"}],"name":"code","attribs":{}},{"type":"text","data":", 在此期间，利用 "},{"type":"tag","children":[{"type":"text","data":"uuid"}],"name":"code","attribs":{}},{"type":"text","data":" 生成该图片的名字 "},{"type":"tag","children":[{"type":"text","data":"picName"}],"name":"code","attribs":{}}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"将图片上传到七牛得到图片远程链接 "},{"type":"tag","children":[{"type":"text","data":"img"}],"name":"code","attribs":{}}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"拼接以上过程中的数据得到形如下面的这个对象并返回:"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"url"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" src"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"picture"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" img"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"info"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" id3\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"详细实现（已折叠）："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"代码较长 已折叠"}],"name":"summary","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// id3/reader.js"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" jsmediatags "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"\"jsmediatags\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" fs "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'then-fs'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" path "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'path'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" url "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'url'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" mp3Model "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'../../tools/db'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" qnx "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'../../tools/qnx'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" uuid "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'uuid/v1'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" mkdir "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'../mkdir'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// 创建临时文件夹 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"mkdir"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"path"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"join"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"__dirname"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'pic'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"reader"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"src"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" isCache "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"false"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" mp3Model"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"findOne"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"url"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" src\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"mp3"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"mp3"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            isCache "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"true"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'From Cache'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" Promise"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"resolve"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"mp3"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"23"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"24"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            isCache "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"false"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"25"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"readMp3From"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"src"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"26"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"27"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"28"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"29"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"30"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"readMp3From"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"src"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"31"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" picData"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" picName"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" picLocal"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" _id3"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"32"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"33"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"new"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"Promise"}],"name":"span","attribs":{"className":"token class-name"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"res"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" rej"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"34"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// Try To Parsing ID3 File Meta Data "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"35"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"new"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"jsmediatags"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"Reader"}],"name":"span","attribs":{"className":"token class-name"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"src"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"36"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// Target Fields "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"37"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"setTagsToRead"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"\"title\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"\"artist\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"\"album\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"\"picture\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"\"track\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"\"genre\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"\"TLE\""}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"38"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"read"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"39"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"onSuccess"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"tag"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"40"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                    "},{"type":"tag","children":[{"type":"text","data":"res"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"tag"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"41"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"42"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"onError"}],"name":"span","attribs":{"className":"token function-variable function"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"error"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"43"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                    "},{"type":"tag","children":[{"type":"text","data":"rej"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"error"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"44"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"45"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"46"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"id3"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"// Parse Success "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"47"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// Basic Value "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"48"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        _id3 "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" id3"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"49"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        picData "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"new"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"Buffer"}],"name":"span","attribs":{"className":"token class-name"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"id3"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"tags"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"picture"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"50"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        picName "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"uuid"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'.jpg'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"51"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        picLocal "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" path"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"join"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"__dirname"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'pic'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" picName"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"52"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"53"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// Write File To Local "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"54"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" fs"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"writeFile"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"55"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            picLocal"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"56"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            picData\n"},{"type":"tag","children":[{"type":"text","data":"57"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"58"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"suc"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"// After Parsing, And Have Picture Saved To Local "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"59"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// Try To Upload File To Qiniu "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"60"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" qnx"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"upload"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"picLocal"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'album-pic/'"}],"name":"span","attribs":{"className":"token string"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" picName"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"61"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"qiniuResponse"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"62"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" hash"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" key"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" img "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" qiniuResponse"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"63"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"64"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        _id3"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"tags"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"picture"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"65"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"66"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"67"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"url"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" src"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"68"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"picture"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" img"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"69"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"info"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" _id3\n"},{"type":"tag","children":[{"type":"text","data":"70"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"71"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"catch"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"err"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"72"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"err"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"73"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" Promise"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"reject"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"74"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"err"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" err"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"75"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"msg"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'Error When Reading ID3'"}],"name":"span","attribs":{"className":"token string"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"76"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"77"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"78"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"79"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"80"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"module"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"exports "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" reader"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"}],"name":"details","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#异步争用","className":"markdownIt-Anchor"}},{"type":"text","data":" 异步争用"}],"name":"h1","attribs":{"id":"异步争用"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"我在前端封装的 "},{"type":"tag","children":[{"type":"text","data":"http.client.js"}],"name":"code","attribs":{}},{"type":"text","data":" 设置了 HTTP 超时重传（5 秒重传），如果当用户发送音频 URL 供后台处理的一瞬间到完全处理完毕（即数据入库，生成缓存的时候）这段时间超过 5 秒，则会引发重传，而重传的时候由于数据并未生成缓存，因此会出现一次提交变出好多音频出来，这样显然不行。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"解决以上的问题有很多解决方案："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"取消前端超时重传机制"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"数据入库前先检查看看有没有同名的再入库"}],"name":"li","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"每次发来的 URL 先扔进队列，由后台慢慢的一个接着一个慢慢处理"}],"name":"li","attribs":{}},{"type":"text","data":"\n"}],"name":"ol","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"第一种方案绝不可行，在使用移动网络的时候很影响体验，因此否决。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"如果时间比较赶可以采用第二种方式，唯一的缺憾就是会做多余的操作（走多几遍 reader.js）"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"第三种应该是比较切实可行的方案，它可以完全杜绝上面的事情发生，不过在编码的时候看起来有些别扭。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"现在来分析一下第三种方案的逻辑："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"处理机有两种状态，一种是忙碌，一种是空闲。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"用户触发路由的时候，如果空闲则将其入队然后立即出队处理 URL，否则将 URL 入队，然后轮询数据库。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"出队一次完成一次音频解析，然后看看队伍情况，如果为空转为空闲态，否则重新执行这一步。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"考虑到以上三点的编码为："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"代码长 已折叠"}],"name":"summary","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"const"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" express "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'express'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" router "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" express"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"Router"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" rps "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'../tools/responser'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" ID3Reader "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'../tools/id3/reader'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" mp3Model "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'../tools/db'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" wait "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"require"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'../tools/wait'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// 队列 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token constant"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"["}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"]"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// 是否忙  "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" pending "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"false"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"store"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"req"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" res"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" src"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"length "},{"type":"tag","children":[{"type":"text","data":"!=="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 队列非空 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"!"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":"pending"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 不忙 出队到 src 并设置为忙 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            src "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"pop"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            pending "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"true"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 走一遍 toRead "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"23"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"toRead"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"src"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" req"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" res"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"suc"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"24"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"// 成功的时候，再走一次 store "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"25"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"store"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"req"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" res"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"26"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"27"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"28"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 忙 等待 100 毫秒后递归执行本函数 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"29"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"wait"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"100"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"suc"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"30"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"store"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"req"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" res"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"31"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"32"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"33"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"34"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 队列空 直接 resolved 并设置为 pending "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"35"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        pending "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"false"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"36"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" Promise"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"resolved"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"true"}],"name":"span","attribs":{"className":"token boolean"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"37"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"38"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"39"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"40"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"// 读取 src "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"41"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"toRead"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"src"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" req"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" res"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"42"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 读取并缓存 并设置 pending "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"43"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'toRead'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" src"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"44"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"45"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"ID3Reader"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"src"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"mp3"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"46"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// Set Who "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"47"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        mp3"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"who "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" req"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"user_id"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"48"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"49"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// New Data And Save It "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"50"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" data "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"new"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"mp3Model"}],"name":"span","attribs":{"className":"token class-name"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"mp3"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"51"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"52"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"save"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"53"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"mp3"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"54"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        rps"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"send2000"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"res"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" mp3"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"55"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"catch"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"err"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"56"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        rps"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"send5006"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"res"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" err"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"toString"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"57"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"58"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"59"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"60"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"reload"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"query"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"61"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"wait"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"100"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"suc"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"62"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" mp3Model"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"findOne"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"query"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"mp3"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"63"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"mp3"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"64"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" mp3"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"65"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"66"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"                "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"reload"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"query"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"67"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"68"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"69"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"70"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"71"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"72"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"router"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"post"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'/'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"req"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" res"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"73"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 入队 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"74"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"Q"}],"name":"span","attribs":{"className":"token constant"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"unshift"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"req"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"body"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"src"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"75"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"76"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"!"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":"pending"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"77"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 空闲才做事"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"78"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'处理中 ... '"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"79"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"store"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"req"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" res"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"80"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"81"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 否则 轮询 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"82"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"reload"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"83"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"url"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" req"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"body"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"src\n"},{"type":"tag","children":[{"type":"text","data":"84"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"mp3"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"85"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            rps"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"send2000"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"res"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" mp3"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"86"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"87"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"88"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"}],"name":"details","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#前端部分","className":"markdownIt-Anchor"}},{"type":"text","data":" 前端部分"}],"name":"h1","attribs":{"id":"前端部分"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"截图"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/wx-player-ab.png","alt":"musicList 可以从左滑到右边 "}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/wx-player-cd.png","alt":"music 音频播放"}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"谈一些有趣的地方"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#添加音乐页的背景","className":"markdownIt-Anchor"}},{"type":"text","data":" 添加音乐页的背景"}],"name":"h2","attribs":{"id":"添加音乐页的背景"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"musicList 里面添加音乐那里的背景 一张图宽 250rpx 高 250rpx , background 全部属性均使用 JavaScript 动态求出:"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"setSty"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" a "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" sys"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"width_px "},{"type":"tag","children":[{"type":"text","data":"/"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"3"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 将 list 重复多次以填充屏幕 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" repeat "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"list"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"concat"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"list"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"concat"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"list"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"concat"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"list"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"concat"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"list"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"concat"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"data"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"list"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// url "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" urls "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" repeat"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"reduce"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"acc"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" item"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" img "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" item"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"picture"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" acc "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}},{"type":"tag","children":[{"type":"text","data":"url("}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"${"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}},{"type":"text","data":"img"},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}}],"name":"span","attribs":{"className":"token interpolation"}},{"type":"tag","children":[{"type":"text","data":"),"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}}],"name":"span","attribs":{"className":"token template-string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'background-image: '"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"slice"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"-"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"';'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// position-x "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" posix "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" repeat"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"reduce"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"acc"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" item"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" idx"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" r "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" idx "},{"type":"tag","children":[{"type":"text","data":"%"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"3"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" acc "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"${"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}},{"type":"text","data":"r "},{"type":"tag","children":[{"type":"text","data":"*"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" a"},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}}],"name":"span","attribs":{"className":"token interpolation"}},{"type":"tag","children":[{"type":"text","data":"px,"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}}],"name":"span","attribs":{"className":"token template-string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'background-position-x: '"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"slice"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"-"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"';'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// position-y "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" posiy "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" repeat"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"reduce"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"acc"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" item"},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" idx"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"let"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" r "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"parseInt"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"idx "},{"type":"tag","children":[{"type":"text","data":"/"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"3"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"20"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" acc "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"${"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}},{"type":"text","data":"r "},{"type":"tag","children":[{"type":"text","data":"*"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" a"},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token interpolation-punctuation punctuation"}}],"name":"span","attribs":{"className":"token interpolation"}},{"type":"tag","children":[{"type":"text","data":"px,"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":"`"}],"name":"span","attribs":{"className":"token template-punctuation string"}}],"name":"span","attribs":{"className":"token template-string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"21"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"'background-position-y: '"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"slice"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"0"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"-"}],"name":"span","attribs":{"className":"token operator"}},{"type":"tag","children":[{"type":"text","data":"1"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"';'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"22"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"23"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// 加起来 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"24"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"setData"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"25"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"allUrlSty"}],"name":"span","attribs":{"className":"token literal-property property"}},{"type":"tag","children":[{"type":"text","data":":"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" urls "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" posix "},{"type":"tag","children":[{"type":"text","data":"+"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" posiy\n"},{"type":"tag","children":[{"type":"text","data":"26"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"27"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#后台播放","className":"markdownIt-Anchor"}},{"type":"text","data":" 后台播放"}],"name":"h2","attribs":{"id":"后台播放"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"音乐是后台播放的。因此可以在主屏幕那边看到音乐，如图："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[],"name":"img","attribs":{"src":"/images/wx-player-ef.png","alt":"后台播放"}}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"应该是调用了苹果提供的原生的 API 进行播放，因此才有这些效果。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#promise-递归链","className":"markdownIt-Anchor"}},{"type":"text","data":" Promise 递归链"}],"name":"h2","attribs":{"id":"promise-递归链"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"当播放音乐的一瞬间， "},{"type":"tag","children":[{"type":"text","data":"wx.getBackgroundAudioPlayerState"}],"name":"code","attribs":{}},{"type":"text","data":" 是无效的，在 wx.playMusic 之后的一瞬间的时候调用它是不行的，因为 play 的一瞬间还需要从网络上下载音乐 "},{"type":"tag","children":[{"type":"text","data":"需要一定时间"}],"name":"code","attribs":{}},{"type":"text","data":" 因此调用 getBackgroundAudioPlayerState 会直接失败 ( 即 Rejected )，而且，据我观察，即使成功了，返回的 state 里面不一定会有 duration，而还要再等等才会有 duration 。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"那么所谓的 "},{"type":"tag","children":[{"type":"text","data":"一定时间"}],"name":"code","attribs":{}},{"type":"text","data":" 又是多少呢？"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"不知道，这时候只能利用 Promise 进行递归轮询了。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"function"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"getMusicInfo"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// wait 等待 200 毫秒后执行 _.getBackgroundAudioPlayerState()"}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" _"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"wait"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"200"}],"name":"span","attribs":{"className":"token number"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"$$$$"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"03"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" _"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"getBackgroundAudioPlayerState"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"04"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"state"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"05"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"if"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"state"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"duration"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"06"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 如果 state 有 duration 字段 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"07"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 则转入 resolved 状态 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"08"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            state"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"duration_min "},{"type":"tag","children":[{"type":"text","data":"="}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"sec2min"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"state"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"duration"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"09"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" state"},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"10"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"else"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"11"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"// 还是不行 递归自己 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"12"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"            "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"getMusicInfo"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"13"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"14"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"err"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"15"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"// 失败了，递归自己 "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"16"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        console"},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"log"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"'Get Music Info 失败'"}],"name":"span","attribs":{"className":"token string"}},{"type":"tag","children":[{"type":"text","data":","}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" err"},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":" \n"},{"type":"tag","children":[{"type":"text","data":"17"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"        "},{"type":"tag","children":[{"type":"text","data":"return"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"getMusicInfo"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"18"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"19"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"调用的时候就很爽了。。 反正这条链将会是 Resolved 的 Promise 实例："}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"00"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"this"}],"name":"span","attribs":{"className":"token keyword"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"getMusicInfo"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"."}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"then"}],"name":"span","attribs":{"className":"token function"}},{"type":"tag","children":[{"type":"text","data":"("}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":"state"}],"name":"span","attribs":{"className":"token parameter"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"=>"}],"name":"span","attribs":{"className":"token operator"}},{"type":"text","data":" "},{"type":"tag","children":[{"type":"text","data":"{"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"01"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"text","data":"    "},{"type":"tag","children":[{"type":"text","data":"// do some thing ... "}],"name":"span","attribs":{"className":"token comment"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"02"}],"name":"span","attribs":{"style":{"userSelect":"none"},"className":"line-numbers-rows"}},{"type":"tag","children":[{"type":"text","data":"}"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":")"}],"name":"span","attribs":{"className":"token punctuation"}},{"type":"tag","children":[{"type":"text","data":";"}],"name":"span","attribs":{"className":"token punctuation"}}],"name":"pre","attribs":{"className":"prismjs js rally-runner  "}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"tag","children":[{"type":"text","data":"#"}],"name":"a","attribs":{"href":"#全栈开发的出路","className":"markdownIt-Anchor"}},{"type":"text","data":" 全栈开发的出路"}],"name":"h1","attribs":{"id":"全栈开发的出路"}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"随着对 Nightive 的深入开发，我越来越感觉，前后端都要懂的意义了。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"不要求学的面面俱到、秒天秒地，但基本的数据库查询，http 生命周期这些总该有个认识，不然前端这边出的 bug 难道要后台帮你调？"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"如果前端不学学后台，很难对 HTTP，数据库，异步争用这些问题有深刻的理解；也不知道开发中经常遇到的所谓 "},{"type":"tag","children":[{"type":"text","data":"token"}],"name":"code","attribs":{}},{"type":"text","data":" 是什么？还有如何生成它？还有其背后的密码学原理等等，又谈何理解前端安全？"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"反过来，如果后台不学学前端，可能出的接口牛马不相及，不清楚前端渲染的需求，也难以理解前端工程化的意义，这样最终的结果就是经常性地鄙视前端、鄙视前端技术…"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"唯有把前后端的知识通串起来才算是一个合格的 Web 工程师，也只有这样才具备独立开发复杂网站的能力。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"},{"type":"tag","children":[{"type":"text","data":"毫不夸张地说，全栈开发将很可能是很多前端认为的最终宿命。"}],"name":"p","attribs":{}},{"type":"text","data":"\n"}],"rawContent":""}}}